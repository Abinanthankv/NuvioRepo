/**
 * moviesda - Built from src/moviesda/
 * Generated: 2026-01-11T05:23:23.691Z
 */
var Y=Object.defineProperty,H=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(t,r,o)=>r in t?Y(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,R=(t,r)=>{for(var o in r||(r={}))j.call(r,o)&&A(t,o,r[o]);if(b)for(var o of b(r))G.call(r,o)&&A(t,o,r[o]);return t},S=(t,r)=>H(t,I(r));var p=(t,r,o)=>new Promise((l,e)=>{var n=s=>{try{c(o.next(s))}catch(u){e(u)}},i=s=>{try{c(o.throw(s))}catch(u){e(u)}},c=s=>s.done?l(s.value):Promise.resolve(s.value).then(n,i);c((o=o.apply(t,r)).next())});var x=require("cheerio-without-node-native"),W="1b3113663c9004682ed61086cf967c44",N="https://api.themoviedb.org/3",m="https://moviesda15.com",$={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${m}/`};function v(l){return p(this,arguments,function*(t,r={},o=1e4){let e=new AbortController,n=setTimeout(()=>e.abort(),o);try{let i=yield fetch(t,S(R({},r),{signal:e.signal}));return clearTimeout(n),i}catch(i){throw clearTimeout(n),i.name==="AbortError"?new Error(`Request timeout after ${o}ms`):i}})}function B(t){return t?t.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function Q(t,r){let o=B(t),l=B(r);if(o===l)return 1;if(o.includes(l)||l.includes(o))return .9;let e=new Set(o.split(/\s+/).filter(s=>s.length>2)),n=new Set(l.split(/\s+/).filter(s=>s.length>2));if(e.size===0||n.size===0)return 0;let i=new Set([...e].filter(s=>n.has(s))),c=new Set([...e,...n]);return i.size/c.size}function J(t,r,o,l){for(;o--;)if(l[o]){let e=o.toString(r);t=t.replace(new RegExp("\\b"+e+"\\b","g"),l[o])}return t}function V(t,r){if(!r||r.length===0)return null;let o=t.year?parseInt(t.year):null,l=null,e=0;for(let n of r){let i=Q(t.title,n.title);o&&(n.title.includes(o.toString())?i+=.3:(n.title.includes((o+1).toString())||n.title.includes((o-1).toString()))&&(i+=.1)),i>e&&(e=i,l=n)}return l&&e>.4?(console.log(`[Moviesda] Best match: "${l.title}" (score: ${e.toFixed(2)})`),l):null}function X(t,r){return p(this,null,function*(){let l=`${N}/${r==="movie"?"movie":"tv"}/${t}?api_key=${W}`;try{let n=yield(yield v(l,{},8e3)).json(),i={title:n.title||n.name,year:(n.release_date||n.first_air_date||"").split("-")[0]};return console.log(`[Moviesda] TMDB Info: "${i.title}" (${i.year||"N/A"})`),i}catch(e){throw console.error("[Moviesda] Error fetching TMDB metadata:",e.message),e}})}function Z(t,r){return p(this,null,function*(){let l=`${N}/search/${r==="movie"?"movie":"tv"}?api_key=${W}&query=${encodeURIComponent(t)}`;try{console.log(`[Moviesda] Searching TMDB for: "${t}"`);let n=yield(yield v(l,{},8e3)).json();if(n.results&&n.results.length>0){let i=n.results[0],c={title:i.title||i.name,year:(i.release_date||i.first_air_date||"").split("-")[0]};return console.log(`[Moviesda] TMDB Search Result: "${c.title}" (${c.year||"N/A"})`),c}return console.log(`[Moviesda] No TMDB results found for "${t}"`),null}catch(e){return console.error("[Moviesda] Error searching TMDB:",e.message),null}})}function ee(t,r=null){return p(this,null,function*(){console.log(`[Moviesda] Searching for: "${t}" (year: ${r||"any"})`);try{let o=[],l=[];if(r)l.push(`${m}/tamil-${r}-movies/`);else{let e=new Date().getFullYear();for(let n=e;n>=e-2;n--)l.push(`${m}/tamil-${n}-movies/`)}console.log(`[Moviesda] Checking ${l.length} category pages`);for(let e of l)try{let i=yield(yield v(e,{headers:$},8e3)).text(),c=x.load(i);c('a[href*="-tamil-movie"], a[href*="-movie/"]').each((s,u)=>{let d=c(u).attr("href"),a=c(u).text().trim();if(!d||d.includes("/tamil-movies/")||d==="#"||a.length<3)return;let h=a.match(/^(.+?)\s*(?:\((\d{4})\))?$/);if(h){let f=h[1].trim(),g=h[2]||null,y=d.startsWith("http")?d:`${m}${d}`;o.push({title:a,cleanTitle:f,year:g,href:y})}})}catch(n){console.error(`[Moviesda] Error browsing ${e}: ${n.message}`)}return console.log(`[Moviesda] Found ${o.length} total movies in categories`),o}catch(o){return console.error("[Moviesda] Search error:",o.message),[]}})}function te(t,r){return p(this,null,function*(){try{let o=new URL(t).origin,e=yield(yield v(t,{headers:S(R({},$),{Referer:m})},5e3)).text(),n=e.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s"));if(n){console.log(`[Moviesda] Detected Packer obfuscation on ${r}, unpacking...`);let u=n[1].trim().match(new RegExp("^'(.*)',\\s*(\\d+),\\s*(\\d+),\\s*'(.*?)'\\.split\\(","s"));if(u){let d=J(u[1],parseInt(u[2]),parseInt(u[3]),u[4].split("|"));e+=`
`+d}}let i=[/["']hls[2-4]["']\s*:\s*["']([^"']+)["']/gi,/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/gi,/https?:\/\/[^\s"']+\.m3u8[^\s"']*/gi,/["'](\/[^\s"']+\.m3u8[^\s"']*)["']/gi,/https?:\/\/[^\s"']+\.mp4[^\s"']*/gi,/(?:source|file|src)\s*[:=]\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/gi],c=[];for(let s of i){let u=e.match(s);if(u&&u.length>0)for(let d of u){let a=d,h=d.match(/["']:[ ]*["']([^"']+)["']/);if(h)a=h[1];else{let g=d.match(/["']([^"']+)["']/);g&&(a=g[1])}let f=a.match(/https?:\/\/[^\s"']+/);f&&(a=f[0]),a=a.replace(/[\\"'\)\]]+$/,""),!(!a||a.length<5||a.includes("google.com")||a.includes("youtube.com"))&&(a.startsWith("/")&&!a.startsWith("//")&&(a=o+a),c.push(a))}}if(c.length>0){c.sort((u,d)=>{let a=u.toLowerCase().includes(".m3u8"),h=d.toLowerCase().includes(".m3u8");return a!==h?h?1:-1:u.length-d.length});let s=c[0];return console.log(`[Moviesda] Found direct URL from ${r}: ${s}`),s}return console.log(`[Moviesda] No direct URL found in ${r}, skipping`),null}catch(o){return console.error(`[Moviesda] Error extracting from ${r}: ${o.message}`),null}})}function oe(t){return p(this,null,function*(){try{console.log(`[Moviesda] Extracting from embed: ${t}`);let o=new URL(t).hostname.toLowerCase();return o.includes("onestream.watch")?yield T(t):yield te(t,o)}catch(r){return console.error(`[Moviesda] Extraction error: ${r.message}`),null}})}function T(t){return p(this,null,function*(){console.log(`[Moviesda] Extracting from onestream.watch: ${t}`);try{let o=yield(yield v(t,{headers:S(R({},$),{Referer:m})},8e3)).text(),l=x.load(o),e=[];if(l("video source").each((c,s)=>{let u=l(s).attr("src"),d=l(s).attr("type");u&&e.push({src:u,type:d})}),e.length>0){let c=e[0].src;return console.log(`[Moviesda] Found direct URL from onestream: ${c}`),c}let n=o.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(n)return console.log(`[Moviesda] Found m3u8 URL: ${n[0]}`),n[0];let i=o.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);return i?(console.log(`[Moviesda] Found mp4 URL: ${i[0]}`),i[0]):(console.log("[Moviesda] No direct URL found in onestream page"),null)}catch(r){return console.error(`[Moviesda] Onestream extraction error: ${r.message}`),null}})}function P(t){return p(this,null,function*(){console.log(`[Moviesda] Parsing movie page: ${t}`);try{let o=yield(yield v(t,{headers:$},8e3)).text(),l=x.load(o),e=[],n=l('a[href*="-original-movie"]');if(n.length>0){let s=n.attr("href"),u=s.startsWith("http")?s:`${m}${s}`;return console.log(`[Moviesda] Found original page link: ${u}`),yield re(u)}let i=[];if(l("a").each((s,u)=>{let d=l(u).attr("href"),a=l(u).text().trim();if(d&&a.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let h=a.match(/\b(360p|480p|720p|1080p|4K)\b/i),f=h?h[0]:"Unknown",g=d.startsWith("http")?d:`${m}${d}`;i.push({url:g,quality:f})}}),i.length>0){console.log(`[Moviesda] Found ${i.length} quality pages`);for(let s of i){let u=yield z(s.url,s.quality);e.push(...u)}return e}let c=[];return l("a").each((s,u)=>{let d=l(u).attr("href"),a=l(u).text().trim();if(d&&d.includes("/download/")){let h=d.startsWith("http")?d:`${m}${d}`;c.push({url:h,text:a})}}),c.length>0&&(console.log(`[Moviesda] Found ${c.length} download links on quality page`),c.forEach(s=>{e.push({url:s.url,quality:"Unknown",type:"download"})})),console.log(`[Moviesda] Found ${e.length} streams on page`),e}catch(r){return console.error("[Moviesda] Movie page parse error:",r.message),[]}})}function re(t){return p(this,null,function*(){console.log(`[Moviesda] Parsing original page: ${t}`);try{let o=yield(yield v(t,{headers:$},8e3)).text(),l=x.load(o),e=[];l("a").each((i,c)=>{let s=l(c).attr("href"),u=l(c).text().trim();if(s&&u.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let d=u.match(/\b(360p|480p|720p|1080p|4K)\b/i),a=d?d[0]:"Unknown",h=s.startsWith("http")?s:`${m}${s}`;e.push({url:h,quality:a,type:"quality_page"})}}),console.log(`[Moviesda] Found ${e.length} quality pages on original page`);let n=[];for(let i of e){let c=yield z(i.url,i.quality);n.push(...c)}return n}catch(r){return console.error("[Moviesda] Original page parse error:",r.message),[]}})}function z(t,r){return p(this,null,function*(){console.log(`[Moviesda] Parsing quality page (${r}): ${t}`);try{let l=yield(yield v(t,{headers:$},8e3)).text(),e=x.load(l),n=[];return e("a").each((i,c)=>{let s=e(c).attr("href"),u=e(c).text().trim();if(s&&s.includes("/download/")){let d=s.startsWith("http")?s:`${m}${s}`;n.push({url:d,quality:r,type:"download"})}}),console.log(`[Moviesda] Found ${n.length} download links for ${r}`),n}catch(o){return console.error(`[Moviesda] Quality page parse error (${r}): ${o.message}`),[]}})}function _(t){return p(this,null,function*(){console.log(`[Moviesda] Extracting final URL from: ${t}`);try{let o=yield(yield v(t,{headers:$},8e3)).text(),l=x.load(o),e=[];if(l("a").each((n,i)=>{let c=l(i).attr("href"),s=l(i).text().trim().toLowerCase();if(c&&!c.includes("moviesda15.com")&&!c.includes("/tamil-movies/")&&!c.startsWith("#")&&(s.includes("download")||s.includes("server"))){let u=c.startsWith("http")?c:`https:${c}`;e.push(u)}}),e.length>0){let n=e[0];if(console.log(`[Moviesda] Found download URL: ${n}`),n.includes("download.moviespage.xyz/download/file/")){let i=n.match(/\/file\/(\d+)/);if(i){let s=`https://play.onestream.watch/stream/page/${i[1]}`;return console.log(`[Moviesda] Converted to onestream URL: ${s}`),{url:s,needsExtraction:!0}}}return{url:n,needsExtraction:!1}}return console.log("[Moviesda] No final download URL found on page"),null}catch(r){return console.error(`[Moviesda] Error extracting final URL: ${r.message}`),null}})}function C(t,r="movie",o=null,l=null){return p(this,null,function*(){console.log(`[Moviesda] Processing ${r} ${t}`);try{let e;if(/^\d+$/.test(t))try{e=yield X(t,r)}catch(a){console.log(`[Moviesda] TMDB fetch failed, using "${t}" as search query`),e={title:t,year:null}}else{console.log(`[Moviesda] Using "${t}" as search query`);try{let a=yield Z(t,r);a&&a.year?e=a:e={title:t,year:null}}catch(a){console.log(`[Moviesda] TMDB search failed: ${a.message}`),e={title:t,year:null}}}console.log(`[Moviesda] Looking for: "${e.title}" (${e.year||"N/A"})`);let i=yield ee(e.title,e.year),c=V(e,i);if(!c){console.warn("[Moviesda] No matching title found in category pages");let a=new Date().getFullYear(),h=e.year?[e.year,a,a-1]:[a,a-1,a+1,a-2,a-3,a-4];for(let f of h){let g=e.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-"),y=`${m}/${g}-${f}-tamil-movie/`;console.log(`[Moviesda] Trying direct URL: ${y}`);try{let w=yield v(y,{headers:$},5e3);if(w.ok){let q=yield w.text();if(q.includes("entry-title")||q.includes("movie")){console.log(`[Moviesda] \u2713 Direct URL found: ${y}`);let D=yield P(y);if(D.length>0){let O=D.slice(0,5),E=[];for(let U of O){let k=U.url;if(U.type==="download")try{let M=yield Promise.race([_(U.url),new Promise((L,F)=>setTimeout(()=>F(new Error("Extraction timeout")),5e3))]);if(!M)continue;if(M.needsExtraction)try{let L=yield Promise.race([T(M.url),new Promise((F,K)=>setTimeout(()=>K(new Error("Onestream extraction timeout")),5e3))]);if(!L)continue;k=L}catch(L){console.error(`[Moviesda] Onestream extraction failed: ${L.message}`);continue}else k=M.url}catch(M){console.error(`[Moviesda] Download URL extraction failed: ${M.message}`);continue}E.push({name:"Moviesda",title:`${e.title} (${e.year||"N/A"}) - ${U.quality}`,url:k,quality:U.quality||"Unknown",headers:{Referer:m,"User-Agent":$["User-Agent"]},provider:"Moviesda"})}return console.log(`[Moviesda] Successfully extracted ${E.length} streams`),E}}}}catch(w){console.log(`[Moviesda] Direct URL failed for ${f}: ${w.message}`)}}return console.warn("[Moviesda] No results found via category search or direct URL"),[]}console.log(`[Moviesda] Processing match: ${c.title}`);let s=yield P(c.href);if(s.length===0)return console.warn("[Moviesda] No streams found on movie page"),[];let u=s.slice(0,5);s.length>5&&console.log(`[Moviesda] Limiting to first 5 streams out of ${s.length}`);let d=[];for(let a of u){let h=a.url;if(a.type==="download")try{let f=yield Promise.race([_(a.url),new Promise((g,y)=>setTimeout(()=>y(new Error("Extraction timeout")),5e3))]);if(!f){console.log("[Moviesda] Failed to extract final URL from download page, skipping");continue}if(f.needsExtraction){console.log("[Moviesda] URL needs extraction from onestream");try{let g=yield Promise.race([T(f.url),new Promise((y,w)=>setTimeout(()=>w(new Error("Onestream extraction timeout")),5e3))]);if(!g){console.log("[Moviesda] Failed to extract from onestream, skipping");continue}h=g}catch(g){console.error(`[Moviesda] Onestream extraction failed: ${g.message}`);continue}}else h=f.url}catch(f){console.error(`[Moviesda] Download URL extraction failed: ${f.message}`);continue}else if(a.type==="embed")try{let f=yield Promise.race([oe(a.url),new Promise((g,y)=>setTimeout(()=>y(new Error("Extraction timeout")),5e3))]);if(!f){console.log("[Moviesda] Failed to extract from embed, skipping");continue}h=f}catch(f){console.error(`[Moviesda] Embed extraction failed: ${f.message}`);continue}d.push({name:"Moviesda",title:`${e.title} (${e.year||"N/A"}) - ${a.quality}`,url:h,quality:a.quality,headers:{Referer:m,"User-Agent":$["User-Agent"]},provider:"Moviesda"})}return console.log(`[Moviesda] Successfully extracted ${d.length} streams`),d}catch(e){return console.error("[Moviesda] getStreams failed:",e.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:C}:global.getStreams={getStreams:C};
