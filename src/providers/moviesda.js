/**
 * moviesda - Built from src/moviesda/
 * Generated: 2026-01-11T08:03:52.998Z
 */
var H=Object.defineProperty,I=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var F=(t,o,r)=>o in t?H(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,R=(t,o)=>{for(var r in o||(o={}))j.call(o,r)&&F(t,r,o[r]);if(B)for(var r of B(o))Q.call(o,r)&&F(t,r,o[r]);return t},k=(t,o)=>I(t,G(o));var p=(t,o,r)=>new Promise((l,e)=>{var s=n=>{try{a(r.next(n))}catch(u){e(u)}},c=n=>{try{a(r.throw(n))}catch(u){e(u)}},a=n=>n.done?l(n.value):Promise.resolve(n.value).then(s,c);a((r=r.apply(t,o)).next())});var x=require("cheerio-without-node-native"),N="1b3113663c9004682ed61086cf967c44",z="https://api.themoviedb.org/3",m="https://moviesda15.com",w={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${m}/`};function v(l){return p(this,arguments,function*(t,o={},r=1e4){let e=new AbortController,s=setTimeout(()=>e.abort(),r);try{let c=yield fetch(t,k(R({},o),{signal:e.signal}));return clearTimeout(s),c}catch(c){throw clearTimeout(s),c.name==="AbortError"?new Error(`Request timeout after ${r}ms`):c}})}function A(t){return t?t.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function V(t,o){let r=A(t),l=A(o);if(r===l)return 1;if(r.includes(l)||l.includes(r))return .9;let e=new Set(r.split(/\s+/).filter(n=>n.length>2)),s=new Set(l.split(/\s+/).filter(n=>n.length>2));if(e.size===0||s.size===0)return 0;let c=new Set([...e].filter(n=>s.has(n))),a=new Set([...e,...s]);return c.size/a.size}function J(t,o,r,l){for(;r--;)if(l[r]){let e=r.toString(o);t=t.replace(new RegExp("\\b"+e+"\\b","g"),l[r])}return t}function X(t,o){if(!o||o.length===0)return null;let r=t.year?parseInt(t.year):null,l=null,e=0;for(let s of o){let c=V(t.title,s.title);r&&(s.title.includes(r.toString())?c+=.3:(s.title.includes((r+1).toString())||s.title.includes((r-1).toString()))&&(c+=.1)),c>e&&(e=c,l=s)}return l&&e>.4?(console.log(`[Moviesda] Best match: "${l.title}" (score: ${e.toFixed(2)})`),l):null}function P(t,o){let r=o.quality||"Unknown",l=t.title||"Unknown",e=t.year||"N/A",s="Unknown",c=o.text?o.text.match(/(\d+(?:\.\d+)?\s*(?:GB|MB))/i):null;c&&(s=c[1]);let a="WEB-DL";return o.text&&(o.text.toLowerCase().includes("bluray")?a="BluRay":o.text.toLowerCase().includes("hdrip")?a="HDRip":o.text.toLowerCase().includes("dvdrip")&&(a="DVDRip")),`Moviesda (Instant) (${r})
\u{1F4FA}: ${a}
\u{1F4FC}: ${l} (${e}) - ${r}
\u{1F4BE}: ${s} | \u{1F69C}: moviesda
\u{1F310}: TAMIL
\u{1F4E6}: Direct | \u{1F331}: N/A`}function Z(t,o){return p(this,null,function*(){let l=`${z}/${o==="movie"?"movie":"tv"}/${t}?api_key=${N}`;try{let s=yield(yield v(l,{},8e3)).json(),c={title:s.title||s.name,year:(s.release_date||s.first_air_date||"").split("-")[0]};return console.log(`[Moviesda] TMDB Info: "${c.title}" (${c.year||"N/A"})`),c}catch(e){throw console.error("[Moviesda] Error fetching TMDB metadata:",e.message),e}})}function ee(t,o){return p(this,null,function*(){let l=`${z}/search/${o==="movie"?"movie":"tv"}?api_key=${N}&query=${encodeURIComponent(t)}`;try{console.log(`[Moviesda] Searching TMDB for: "${t}"`);let s=yield(yield v(l,{},8e3)).json();if(s.results&&s.results.length>0){let c=s.results[0],a={title:c.title||c.name,year:(c.release_date||c.first_air_date||"").split("-")[0]};return console.log(`[Moviesda] TMDB Search Result: "${a.title}" (${a.year||"N/A"})`),a}return console.log(`[Moviesda] No TMDB results found for "${t}"`),null}catch(e){return console.error("[Moviesda] Error searching TMDB:",e.message),null}})}function te(t,o=null){return p(this,null,function*(){console.log(`[Moviesda] Searching for: "${t}" (year: ${o||"any"})`);try{let r=[],l=[];if(o)l.push(`${m}/tamil-${o}-movies/`);else{let e=new Date().getFullYear();for(let s=e;s>=e-2;s--)l.push(`${m}/tamil-${s}-movies/`)}console.log(`[Moviesda] Checking ${l.length} category pages`);for(let e of l)try{let c=yield(yield v(e,{headers:w},8e3)).text(),a=x.load(c);a('a[href*="-tamil-movie"], a[href*="-movie/"]').each((n,u)=>{let d=a(u).attr("href"),i=a(u).text().trim();if(!d||d.includes("/tamil-movies/")||d==="#"||i.length<3)return;let f=i.match(/^(.+?)\s*(?:\((\d{4})\))?$/);if(f){let h=f[1].trim(),g=f[2]||null,y=d.startsWith("http")?d:`${m}${d}`;r.push({title:i,cleanTitle:h,year:g,href:y})}})}catch(s){console.error(`[Moviesda] Error browsing ${e}: ${s.message}`)}return console.log(`[Moviesda] Found ${r.length} total movies in categories`),r}catch(r){return console.error("[Moviesda] Search error:",r.message),[]}})}function oe(t,o){return p(this,null,function*(){try{let r=new URL(t).origin,e=yield(yield v(t,{headers:k(R({},w),{Referer:m})},5e3)).text(),s=e.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s"));if(s){console.log(`[Moviesda] Detected Packer obfuscation on ${o}, unpacking...`);let u=s[1].trim().match(new RegExp("^'(.*)',\\s*(\\d+),\\s*(\\d+),\\s*'(.*?)'\\.split\\(","s"));if(u){let d=J(u[1],parseInt(u[2]),parseInt(u[3]),u[4].split("|"));e+=`
`+d}}let c=[/["']hls[2-4]["']\s*:\s*["']([^"']+)["']/gi,/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/gi,/https?:\/\/[^\s"']+\.m3u8[^\s"']*/gi,/["'](\/[^\s"']+\.m3u8[^\s"']*)["']/gi,/https?:\/\/[^\s"']+\.mp4[^\s"']*/gi,/(?:source|file|src)\s*[:=]\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/gi],a=[];for(let n of c){let u=e.match(n);if(u&&u.length>0)for(let d of u){let i=d,f=d.match(/["']:[ ]*["']([^"']+)["']/);if(f)i=f[1];else{let g=d.match(/["']([^"']+)["']/);g&&(i=g[1])}let h=i.match(/https?:\/\/[^\s"']+/);h&&(i=h[0]),i=i.replace(/[\\"'\)\]]+$/,""),!(!i||i.length<5||i.includes("google.com")||i.includes("youtube.com"))&&(i.startsWith("/")&&!i.startsWith("//")&&(i=r+i),a.push(i))}}if(a.length>0){a.sort((u,d)=>{let i=u.toLowerCase().includes(".m3u8"),f=d.toLowerCase().includes(".m3u8");return i!==f?f?1:-1:u.length-d.length});let n=a[0];return console.log(`[Moviesda] Found direct URL from ${o}: ${n}`),n}return console.log(`[Moviesda] No direct URL found in ${o}, skipping`),null}catch(r){return console.error(`[Moviesda] Error extracting from ${o}: ${r.message}`),null}})}function re(t){return p(this,null,function*(){try{console.log(`[Moviesda] Extracting from embed: ${t}`);let r=new URL(t).hostname.toLowerCase();return r.includes("onestream.watch")?yield T(t):yield oe(t,r)}catch(o){return console.error(`[Moviesda] Extraction error: ${o.message}`),null}})}function T(t){return p(this,null,function*(){console.log(`[Moviesda] Extracting from onestream.watch: ${t}`);try{let r=yield(yield v(t,{headers:k(R({},w),{Referer:m})},8e3)).text(),l=x.load(r),e=[];if(l("video source").each((a,n)=>{let u=l(n).attr("src"),d=l(n).attr("type");u&&e.push({src:u,type:d})}),e.length>0){let a=e[0].src;return console.log(`[Moviesda] Found direct URL from onestream: ${a}`),a}let s=r.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(s)return console.log(`[Moviesda] Found m3u8 URL: ${s[0]}`),s[0];let c=r.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);return c?(console.log(`[Moviesda] Found mp4 URL: ${c[0]}`),c[0]):(console.log("[Moviesda] No direct URL found in onestream page"),null)}catch(o){return console.error(`[Moviesda] Onestream extraction error: ${o.message}`),null}})}function _(t){return p(this,null,function*(){console.log(`[Moviesda] Parsing movie page: ${t}`);try{let r=yield(yield v(t,{headers:w},8e3)).text(),l=x.load(r),e=[],s=l('a[href*="-original-movie"]');if(s.length>0){let n=s.attr("href"),u=n.startsWith("http")?n:`${m}${n}`;return console.log(`[Moviesda] Found original page link: ${u}`),yield se(u)}let c=[];if(l("a").each((n,u)=>{let d=l(u).attr("href"),i=l(u).text().trim();if(d&&i.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let f=i.match(/\b(360p|480p|720p|1080p|4K)\b/i),h=f?f[0]:"Unknown",g=d.startsWith("http")?d:`${m}${d}`;c.push({url:g,quality:h})}}),c.length>0){console.log(`[Moviesda] Found ${c.length} quality pages`);for(let n of c){let u=yield O(n.url,n.quality);u.forEach(d=>{d.text||(d.text=n.text||"")}),e.push(...u)}return e}let a=[];return l("a").each((n,u)=>{let d=l(u).attr("href"),i=l(u).text().trim();if(d&&d.includes("/download/")){let f=d.startsWith("http")?d:`${m}${d}`;a.push({url:f,text:i})}}),a.length>0&&(console.log(`[Moviesda] Found ${a.length} download links on quality page`),a.forEach(n=>{e.push({url:n.url,quality:"Unknown",type:"download"})})),console.log(`[Moviesda] Found ${e.length} streams on page`),e}catch(o){return console.error("[Moviesda] Movie page parse error:",o.message),[]}})}function se(t){return p(this,null,function*(){console.log(`[Moviesda] Parsing original page: ${t}`);try{let r=yield(yield v(t,{headers:w},8e3)).text(),l=x.load(r),e=[];l("a").each((c,a)=>{let n=l(a).attr("href"),u=l(a).text().trim();if(n&&u.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let d=u.match(/\b(360p|480p|720p|1080p|4K)\b/i),i=d?d[0]:"Unknown",f=n.startsWith("http")?n:`${m}${n}`;e.push({url:f,quality:i,type:"quality_page"})}}),console.log(`[Moviesda] Found ${e.length} quality pages on original page`);let s=[];for(let c of e){let a=yield O(c.url,c.quality);s.push(...a)}return s}catch(o){return console.error("[Moviesda] Original page parse error:",o.message),[]}})}function O(t,o){return p(this,null,function*(){console.log(`[Moviesda] Parsing quality page (${o}): ${t}`);try{let l=yield(yield v(t,{headers:w},8e3)).text(),e=x.load(l),s=[];return e("a").each((c,a)=>{let n=e(a).attr("href"),u=e(a).text().trim();if(n&&n.includes("/download/")){let d=n.startsWith("http")?n:`${m}${n}`;s.push({url:d,quality:o,type:"download",text:u})}}),console.log(`[Moviesda] Found ${s.length} download links for ${o}`),s}catch(r){return console.error(`[Moviesda] Quality page parse error (${o}): ${r.message}`),[]}})}function C(t){return p(this,null,function*(){console.log(`[Moviesda] Extracting final URL from: ${t}`);try{let r=yield(yield v(t,{headers:w},8e3)).text(),l=x.load(r),e=[];if(l("a").each((s,c)=>{let a=l(c).attr("href"),n=l(c).text().trim().toLowerCase();if(a&&!a.includes("moviesda15.com")&&!a.includes("/tamil-movies/")&&!a.startsWith("#")&&(n.includes("download")||n.includes("server"))){let u=a.startsWith("http")?a:`https:${a}`;e.push(u)}}),e.length>0){let s=e[0];if(console.log(`[Moviesda] Found download URL: ${s}`),s.includes("download.moviespage.xyz/download/file/")){let c=s.match(/\/file\/(\d+)/);if(c){let n=`https://play.onestream.watch/stream/page/${c[1]}`;return console.log(`[Moviesda] Converted to onestream URL: ${n}`),{url:n,needsExtraction:!0}}}return{url:s,needsExtraction:!1}}return console.log("[Moviesda] No final download URL found on page"),null}catch(o){return console.error(`[Moviesda] Error extracting final URL: ${o.message}`),null}})}function W(t,o="movie",r=null,l=null){return p(this,null,function*(){console.log(`[Moviesda] Processing ${o} ${t}`);try{let e;if(/^\d+$/.test(t))try{e=yield Z(t,o)}catch(i){console.log(`[Moviesda] TMDB fetch failed, using "${t}" as search query`),e={title:t,year:null}}else{console.log(`[Moviesda] Using "${t}" as search query`);try{let i=yield ee(t,o);i&&i.year?e=i:e={title:t,year:null}}catch(i){console.log(`[Moviesda] TMDB search failed: ${i.message}`),e={title:t,year:null}}}console.log(`[Moviesda] Looking for: "${e.title}" (${e.year||"N/A"})`);let c=yield te(e.title,e.year),a=X(e,c);if(!a){console.warn("[Moviesda] No matching title found in category pages");let i=new Date().getFullYear(),f=e.year?[e.year,i,i-1]:[i,i-1,i+1,i-2,i-3,i-4];for(let h of f){let g=e.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-"),y=`${m}/${g}-${h}-tamil-movie/`;console.log(`[Moviesda] Trying direct URL: ${y}`);try{let $=yield v(y,{headers:w},5e3);if($.ok){let D=yield $.text();if(D.includes("entry-title")||D.includes("movie")){console.log(`[Moviesda] \u2713 Direct URL found: ${y}`);let q=yield _(y);if(q.length>0){let K=q.slice(0,5),E=[];for(let U of K){let S=U.url;if(U.type==="download")try{let M=yield Promise.race([C(U.url),new Promise((L,b)=>setTimeout(()=>b(new Error("Extraction timeout")),5e3))]);if(!M)continue;if(M.needsExtraction)try{let L=yield Promise.race([T(M.url),new Promise((b,Y)=>setTimeout(()=>Y(new Error("Onestream extraction timeout")),5e3))]);if(!L)continue;S=L}catch(L){console.error(`[Moviesda] Onestream extraction failed: ${L.message}`);continue}else S=M.url}catch(M){console.error(`[Moviesda] Download URL extraction failed: ${M.message}`);continue}E.push({name:"Moviesda",title:P(e,U),url:S,quality:U.quality||"Unknown",headers:{Referer:m,"User-Agent":w["User-Agent"]},provider:"Moviesda"})}return console.log(`[Moviesda] Successfully extracted ${E.length} streams`),E}}}}catch($){console.log(`[Moviesda] Direct URL failed for ${h}: ${$.message}`)}}return console.warn("[Moviesda] No results found via category search or direct URL"),[]}console.log(`[Moviesda] Processing match: ${a.title}`);let n=yield _(a.href);if(n.length===0)return console.warn("[Moviesda] No streams found on movie page"),[];let u=n.slice(0,5);n.length>5&&console.log(`[Moviesda] Limiting to first 5 streams out of ${n.length}`);let d=[];for(let i of u){let f=i.url;if(i.type==="download")try{let h=yield Promise.race([C(i.url),new Promise((g,y)=>setTimeout(()=>y(new Error("Extraction timeout")),5e3))]);if(!h){console.log("[Moviesda] Failed to extract final URL from download page, skipping");continue}if(h.needsExtraction){console.log("[Moviesda] URL needs extraction from onestream");try{let g=yield Promise.race([T(h.url),new Promise((y,$)=>setTimeout(()=>$(new Error("Onestream extraction timeout")),5e3))]);if(!g){console.log("[Moviesda] Failed to extract from onestream, skipping");continue}f=g}catch(g){console.error(`[Moviesda] Onestream extraction failed: ${g.message}`);continue}}else f=h.url}catch(h){console.error(`[Moviesda] Download URL extraction failed: ${h.message}`);continue}else if(i.type==="embed")try{let h=yield Promise.race([re(i.url),new Promise((g,y)=>setTimeout(()=>y(new Error("Extraction timeout")),5e3))]);if(!h){console.log("[Moviesda] Failed to extract from embed, skipping");continue}f=h}catch(h){console.error(`[Moviesda] Embed extraction failed: ${h.message}`);continue}d.push({name:"Moviesda",title:P(e,i),url:f,quality:i.quality,headers:{Referer:m,"User-Agent":w["User-Agent"]},provider:"Moviesda"})}return console.log(`[Moviesda] Successfully extracted ${d.length} streams`),d}catch(e){return console.error("[Moviesda] getStreams failed:",e.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:W}:global.getStreams={getStreams:W};
