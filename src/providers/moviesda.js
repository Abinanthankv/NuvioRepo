/**
 * moviesda - Built from src/moviesda/
 * Generated: 2026-01-10T11:05:49.348Z
 */
var b=Object.defineProperty,F=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var L=(t,r,o)=>r in t?b(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,M=(t,r)=>{for(var o in r||(r={}))A.call(r,o)&&L(t,o,r[o]);if(U)for(var o of U(r))D.call(r,o)&&L(t,o,r[o]);return t},x=(t,r)=>F(t,T(r));var m=(t,r,o)=>new Promise((a,e)=>{var n=s=>{try{i(o.next(s))}catch(l){e(l)}},c=s=>{try{i(o.throw(s))}catch(l){e(l)}},i=s=>s.done?a(s.value):Promise.resolve(s.value).then(n,c);i((o=o.apply(t,r)).next())});var y=require("cheerio-without-node-native"),P="1b3113663c9004682ed61086cf967c44",W="https://api.themoviedb.org/3",p="https://moviesda15.com",$={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${p}/`};function v(a){return m(this,arguments,function*(t,r={},o=1e4){let e=new AbortController,n=setTimeout(()=>e.abort(),o);try{let c=yield fetch(t,x(M({},r),{signal:e.signal}));return clearTimeout(n),c}catch(c){throw clearTimeout(n),c.name==="AbortError"?new Error(`Request timeout after ${o}ms`):c}})}function k(t){return t?t.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function _(t,r){let o=k(t),a=k(r);if(o===a)return 1;if(o.includes(a)||a.includes(o))return .9;let e=new Set(o.split(/\s+/).filter(s=>s.length>2)),n=new Set(a.split(/\s+/).filter(s=>s.length>2));if(e.size===0||n.size===0)return 0;let c=new Set([...e].filter(s=>n.has(s))),i=new Set([...e,...n]);return c.size/i.size}function B(t,r,o,a){for(;o--;)if(a[o]){let e=o.toString(r);t=t.replace(new RegExp("\\b"+e+"\\b","g"),a[o])}return t}function C(t,r){if(!r||r.length===0)return null;let o=t.year?parseInt(t.year):null,a=null,e=0;for(let n of r){let c=_(t.title,n.title);o&&(n.title.includes(o.toString())?c+=.3:(n.title.includes((o+1).toString())||n.title.includes((o-1).toString()))&&(c+=.1)),c>e&&(e=c,a=n)}return a&&e>.4?(console.log(`[Moviesda] Best match: "${a.title}" (score: ${e.toFixed(2)})`),a):null}function N(t,r){return m(this,null,function*(){let a=`${W}/${r==="movie"?"movie":"tv"}/${t}?api_key=${P}`;try{let n=yield(yield v(a,{},8e3)).json(),c={title:n.title||n.name,year:(n.release_date||n.first_air_date||"").split("-")[0]};return console.log(`[Moviesda] TMDB Info: "${c.title}" (${c.year||"N/A"})`),c}catch(e){throw console.error("[Moviesda] Error fetching TMDB metadata:",e.message),e}})}function z(t,r=null){return m(this,null,function*(){console.log(`[Moviesda] Searching for: "${t}" (year: ${r||"any"})`);try{let o=[],a=[];if(r)a.push(`${p}/tamil-${r}-movies/`);else{let e=new Date().getFullYear();for(let n=e;n>=e-2;n--)a.push(`${p}/tamil-${n}-movies/`)}console.log(`[Moviesda] Checking ${a.length} category pages`);for(let e of a)try{let c=yield(yield v(e,{headers:$},8e3)).text(),i=y.load(c);i('a[href*="-tamil-movie"], a[href*="-movie/"]').each((s,l)=>{let u=i(l).attr("href"),d=i(l).text().trim();if(!u||u.includes("/tamil-movies/")||u==="#"||d.length<3)return;let h=d.match(/^(.+?)\s*(?:\((\d{4})\))?$/);if(h){let g=h[1].trim(),f=h[2]||null,w=u.startsWith("http")?u:`${p}${u}`;o.push({title:d,cleanTitle:g,year:f,href:w})}})}catch(n){console.error(`[Moviesda] Error browsing ${e}: ${n.message}`)}return console.log(`[Moviesda] Found ${o.length} total movies in categories`),o}catch(o){return console.error("[Moviesda] Search error:",o.message),[]}})}function K(t,r){return m(this,null,function*(){try{let o=new URL(t).origin,e=yield(yield v(t,{headers:x(M({},$),{Referer:p})},5e3)).text(),n=e.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s"));if(n){console.log(`[Moviesda] Detected Packer obfuscation on ${r}, unpacking...`);let l=n[1].trim().match(new RegExp("^'(.*)',\\s*(\\d+),\\s*(\\d+),\\s*'(.*?)'\\.split\\(","s"));if(l){let u=B(l[1],parseInt(l[2]),parseInt(l[3]),l[4].split("|"));e+=`
`+u}}let c=[/["']hls[2-4]["']\s*:\s*["']([^"']+)["']/gi,/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/gi,/https?:\/\/[^\s"']+\.m3u8[^\s"']*/gi,/["'](\/[^\s"']+\.m3u8[^\s"']*)["']/gi,/https?:\/\/[^\s"']+\.mp4[^\s"']*/gi,/(?:source|file|src)\s*[:=]\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/gi],i=[];for(let s of c){let l=e.match(s);if(l&&l.length>0)for(let u of l){let d=u,h=u.match(/["']:[ ]*["']([^"']+)["']/);if(h)d=h[1];else{let f=u.match(/["']([^"']+)["']/);f&&(d=f[1])}let g=d.match(/https?:\/\/[^\s"']+/);g&&(d=g[0]),d=d.replace(/[\\"'\)\]]+$/,""),!(!d||d.length<5||d.includes("google.com")||d.includes("youtube.com"))&&(d.startsWith("/")&&!d.startsWith("//")&&(d=o+d),i.push(d))}}if(i.length>0){i.sort((l,u)=>{let d=l.toLowerCase().includes(".m3u8"),h=u.toLowerCase().includes(".m3u8");return d!==h?h?1:-1:l.length-u.length});let s=i[0];return console.log(`[Moviesda] Found direct URL from ${r}: ${s}`),s}return console.log(`[Moviesda] No direct URL found in ${r}, skipping`),null}catch(o){return console.error(`[Moviesda] Error extracting from ${r}: ${o.message}`),null}})}function O(t){return m(this,null,function*(){try{console.log(`[Moviesda] Extracting from embed: ${t}`);let o=new URL(t).hostname.toLowerCase();return o.includes("onestream.watch")?yield S(t):yield K(t,o)}catch(r){return console.error(`[Moviesda] Extraction error: ${r.message}`),null}})}function S(t){return m(this,null,function*(){console.log(`[Moviesda] Extracting from onestream.watch: ${t}`);try{let o=yield(yield v(t,{headers:x(M({},$),{Referer:p})},8e3)).text(),a=y.load(o),e=[];if(a("video source").each((i,s)=>{let l=a(s).attr("src"),u=a(s).attr("type");l&&e.push({src:l,type:u})}),e.length>0){let i=e[0].src;return console.log(`[Moviesda] Found direct URL from onestream: ${i}`),i}let n=o.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(n)return console.log(`[Moviesda] Found m3u8 URL: ${n[0]}`),n[0];let c=o.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);return c?(console.log(`[Moviesda] Found mp4 URL: ${c[0]}`),c[0]):(console.log("[Moviesda] No direct URL found in onestream page"),null)}catch(r){return console.error(`[Moviesda] Onestream extraction error: ${r.message}`),null}})}function I(t){return m(this,null,function*(){console.log(`[Moviesda] Parsing movie page: ${t}`);try{let o=yield(yield v(t,{headers:$},8e3)).text(),a=y.load(o),e=[],n=a('a[href*="-original-movie"]');if(n.length>0){let s=n.attr("href"),l=s.startsWith("http")?s:`${p}${s}`;return console.log(`[Moviesda] Found original page link: ${l}`),yield Y(l)}let c=[];if(a("a").each((s,l)=>{let u=a(l).attr("href"),d=a(l).text().trim();if(u&&d.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let h=d.match(/\b(360p|480p|720p|1080p|4K)\b/i),g=h?h[0]:"Unknown",f=u.startsWith("http")?u:`${p}${u}`;c.push({url:f,quality:g})}}),c.length>0){console.log(`[Moviesda] Found ${c.length} quality pages`);for(let s of c){let l=yield q(s.url,s.quality);e.push(...l)}return e}let i=[];return a("a").each((s,l)=>{let u=a(l).attr("href"),d=a(l).text().trim();if(u&&u.includes("/download/")){let h=u.startsWith("http")?u:`${p}${u}`;i.push({url:h,text:d})}}),i.length>0&&(console.log(`[Moviesda] Found ${i.length} download links on quality page`),i.forEach(s=>{e.push({url:s.url,quality:"Unknown",type:"download"})})),console.log(`[Moviesda] Found ${e.length} streams on page`),e}catch(r){return console.error("[Moviesda] Movie page parse error:",r.message),[]}})}function Y(t){return m(this,null,function*(){console.log(`[Moviesda] Parsing original page: ${t}`);try{let o=yield(yield v(t,{headers:$},8e3)).text(),a=y.load(o),e=[];a("a").each((c,i)=>{let s=a(i).attr("href"),l=a(i).text().trim();if(s&&l.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let u=l.match(/\b(360p|480p|720p|1080p|4K)\b/i),d=u?u[0]:"Unknown",h=s.startsWith("http")?s:`${p}${s}`;e.push({url:h,quality:d,type:"quality_page"})}}),console.log(`[Moviesda] Found ${e.length} quality pages on original page`);let n=[];for(let c of e){let i=yield q(c.url,c.quality);n.push(...i)}return n}catch(r){return console.error("[Moviesda] Original page parse error:",r.message),[]}})}function q(t,r){return m(this,null,function*(){console.log(`[Moviesda] Parsing quality page (${r}): ${t}`);try{let a=yield(yield v(t,{headers:$},8e3)).text(),e=y.load(a),n=[];return e("a").each((c,i)=>{let s=e(i).attr("href"),l=e(i).text().trim();if(s&&s.includes("/download/")){let u=s.startsWith("http")?s:`${p}${s}`;n.push({url:u,quality:r,type:"download"})}}),console.log(`[Moviesda] Found ${n.length} download links for ${r}`),n}catch(o){return console.error(`[Moviesda] Quality page parse error (${r}): ${o.message}`),[]}})}function H(t){return m(this,null,function*(){console.log(`[Moviesda] Extracting final URL from: ${t}`);try{let o=yield(yield v(t,{headers:$},8e3)).text(),a=y.load(o),e=[];if(a("a").each((n,c)=>{let i=a(c).attr("href"),s=a(c).text().trim().toLowerCase();if(i&&!i.includes("moviesda15.com")&&!i.includes("/tamil-movies/")&&!i.startsWith("#")&&(s.includes("download")||s.includes("server"))){let l=i.startsWith("http")?i:`https:${i}`;e.push(l)}}),e.length>0){let n=e[0];if(console.log(`[Moviesda] Found download URL: ${n}`),n.includes("download.moviespage.xyz/download/file/")){let c=n.match(/\/file\/(\d+)/);if(c){let s=`https://play.onestream.watch/stream/page/${c[1]}`;return console.log(`[Moviesda] Converted to onestream URL: ${s}`),{url:s,needsExtraction:!0}}}return{url:n,needsExtraction:!1}}return console.log("[Moviesda] No final download URL found on page"),null}catch(r){return console.error(`[Moviesda] Error extracting final URL: ${r.message}`),null}})}function E(t,r="movie",o=null,a=null){return m(this,null,function*(){console.log(`[Moviesda] Processing ${r} ${t}`);try{let e;if(/^\d+$/.test(t))try{e=yield N(t,r)}catch(d){console.log(`[Moviesda] TMDB fetch failed, using "${t}" as search query`),e={title:t,year:null}}else console.log(`[Moviesda] Using "${t}" as search query directly`),e={title:t,year:null};console.log(`[Moviesda] Looking for: "${e.title}" (${e.year||"N/A"})`);let c=yield z(e.title,e.year),i=C(e,c);if(!i)return console.warn("[Moviesda] No matching title found"),[];console.log(`[Moviesda] Processing match: ${i.title}`);let s=yield I(i.href);if(s.length===0)return console.warn("[Moviesda] No streams found on movie page"),[];let l=s.slice(0,5);s.length>5&&console.log(`[Moviesda] Limiting to first 5 streams out of ${s.length}`);let u=[];for(let d of l){let h=d.url;if(d.type==="download")try{let g=yield Promise.race([H(d.url),new Promise((f,w)=>setTimeout(()=>w(new Error("Extraction timeout")),5e3))]);if(!g){console.log("[Moviesda] Failed to extract final URL from download page, skipping");continue}if(g.needsExtraction){console.log("[Moviesda] URL needs extraction from onestream");try{let f=yield Promise.race([S(g.url),new Promise((w,R)=>setTimeout(()=>R(new Error("Onestream extraction timeout")),5e3))]);if(!f){console.log("[Moviesda] Failed to extract from onestream, skipping");continue}h=f}catch(f){console.error(`[Moviesda] Onestream extraction failed: ${f.message}`);continue}}else h=g.url}catch(g){console.error(`[Moviesda] Download URL extraction failed: ${g.message}`);continue}else if(d.type==="embed")try{let g=yield Promise.race([O(d.url),new Promise((f,w)=>setTimeout(()=>w(new Error("Extraction timeout")),5e3))]);if(!g){console.log("[Moviesda] Failed to extract from embed, skipping");continue}h=g}catch(g){console.error(`[Moviesda] Embed extraction failed: ${g.message}`);continue}u.push({name:"Moviesda",title:`${e.title} (${e.year||"N/A"}) - ${d.quality}`,url:h,quality:d.quality,headers:{Referer:p,"User-Agent":$["User-Agent"]},provider:"Moviesda"})}return console.log(`[Moviesda] Successfully extracted ${u.length} streams`),u}catch(e){return console.error("[Moviesda] getStreams failed:",e.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:E}:global.getStreams={getStreams:E};
