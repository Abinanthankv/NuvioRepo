/**
 * moviesda - Built from src/moviesda/
 * Generated: 2026-01-10T11:32:05.421Z
 */
var Y=Object.defineProperty,H=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(t,s,r)=>s in t?Y(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,R=(t,s)=>{for(var r in s||(s={}))j.call(s,r)&&A(t,r,s[r]);if(b)for(var r of b(s))G.call(s,r)&&A(t,r,s[r]);return t},S=(t,s)=>H(t,I(s));var p=(t,s,r)=>new Promise((l,e)=>{var a=n=>{try{c(r.next(n))}catch(u){e(u)}},i=n=>{try{c(r.throw(n))}catch(u){e(u)}},c=n=>n.done?l(n.value):Promise.resolve(n.value).then(a,i);c((r=r.apply(t,s)).next())});var x=require("cheerio-without-node-native"),W="1b3113663c9004682ed61086cf967c44",N="https://api.themoviedb.org/3",m="https://moviesda15.com",$={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${m}/`};function v(l){return p(this,arguments,function*(t,s={},r=1e4){let e=new AbortController,a=setTimeout(()=>e.abort(),r);try{let i=yield fetch(t,S(R({},s),{signal:e.signal}));return clearTimeout(a),i}catch(i){throw clearTimeout(a),i.name==="AbortError"?new Error(`Request timeout after ${r}ms`):i}})}function B(t){return t?t.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function Q(t,s){let r=B(t),l=B(s);if(r===l)return 1;if(r.includes(l)||l.includes(r))return .9;let e=new Set(r.split(/\s+/).filter(n=>n.length>2)),a=new Set(l.split(/\s+/).filter(n=>n.length>2));if(e.size===0||a.size===0)return 0;let i=new Set([...e].filter(n=>a.has(n))),c=new Set([...e,...a]);return i.size/c.size}function J(t,s,r,l){for(;r--;)if(l[r]){let e=r.toString(s);t=t.replace(new RegExp("\\b"+e+"\\b","g"),l[r])}return t}function V(t,s){if(!s||s.length===0)return null;let r=t.year?parseInt(t.year):null,l=null,e=0;for(let a of s){let i=Q(t.title,a.title);r&&(a.title.includes(r.toString())?i+=.3:(a.title.includes((r+1).toString())||a.title.includes((r-1).toString()))&&(i+=.1)),i>e&&(e=i,l=a)}return l&&e>.4?(console.log(`[Moviesda] Best match: "${l.title}" (score: ${e.toFixed(2)})`),l):null}function X(t,s){return p(this,null,function*(){let l=`${N}/${s==="movie"?"movie":"tv"}/${t}?api_key=${W}`;try{let a=yield(yield v(l,{},8e3)).json(),i={title:a.title||a.name,year:(a.release_date||a.first_air_date||"").split("-")[0]};return console.log(`[Moviesda] TMDB Info: "${i.title}" (${i.year||"N/A"})`),i}catch(e){throw console.error("[Moviesda] Error fetching TMDB metadata:",e.message),e}})}function Z(t,s){return p(this,null,function*(){let l=`${N}/search/${s==="movie"?"movie":"tv"}?api_key=${W}&query=${encodeURIComponent(t)}`;try{console.log(`[Moviesda] Searching TMDB for: "${t}"`);let a=yield(yield v(l,{},8e3)).json();if(a.results&&a.results.length>0){let i=a.results[0],c={title:i.title||i.name,year:(i.release_date||i.first_air_date||"").split("-")[0]};return console.log(`[Moviesda] TMDB Search Result: "${c.title}" (${c.year||"N/A"})`),c}return console.log(`[Moviesda] No TMDB results found for "${t}"`),null}catch(e){return console.error("[Moviesda] Error searching TMDB:",e.message),null}})}function ee(t,s=null){return p(this,null,function*(){console.log(`[Moviesda] Searching for: "${t}" (year: ${s||"any"})`);try{let r=[],l=[];if(s)l.push(`${m}/tamil-${s}-movies/`);else{let e=new Date().getFullYear();for(let a=e;a>=e-2;a--)l.push(`${m}/tamil-${a}-movies/`)}console.log(`[Moviesda] Checking ${l.length} category pages`);for(let e of l)try{let i=yield(yield v(e,{headers:$},8e3)).text(),c=x.load(i);c('a[href*="-tamil-movie"], a[href*="-movie/"]').each((n,u)=>{let d=c(u).attr("href"),o=c(u).text().trim();if(!d||d.includes("/tamil-movies/")||d==="#"||o.length<3)return;let h=o.match(/^(.+?)\s*(?:\((\d{4})\))?$/);if(h){let f=h[1].trim(),g=h[2]||null,y=d.startsWith("http")?d:`${m}${d}`;r.push({title:o,cleanTitle:f,year:g,href:y})}})}catch(a){console.error(`[Moviesda] Error browsing ${e}: ${a.message}`)}return console.log(`[Moviesda] Found ${r.length} total movies in categories`),r}catch(r){return console.error("[Moviesda] Search error:",r.message),[]}})}function te(t,s){return p(this,null,function*(){try{let r=new URL(t).origin,e=yield(yield v(t,{headers:S(R({},$),{Referer:m})},5e3)).text(),a=e.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s"));if(a){console.log(`[Moviesda] Detected Packer obfuscation on ${s}, unpacking...`);let u=a[1].trim().match(new RegExp("^'(.*)',\\s*(\\d+),\\s*(\\d+),\\s*'(.*?)'\\.split\\(","s"));if(u){let d=J(u[1],parseInt(u[2]),parseInt(u[3]),u[4].split("|"));e+=`
`+d}}let i=[/["']hls[2-4]["']\s*:\s*["']([^"']+)["']/gi,/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/gi,/https?:\/\/[^\s"']+\.m3u8[^\s"']*/gi,/["'](\/[^\s"']+\.m3u8[^\s"']*)["']/gi,/https?:\/\/[^\s"']+\.mp4[^\s"']*/gi,/(?:source|file|src)\s*[:=]\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/gi],c=[];for(let n of i){let u=e.match(n);if(u&&u.length>0)for(let d of u){let o=d,h=d.match(/["']:[ ]*["']([^"']+)["']/);if(h)o=h[1];else{let g=d.match(/["']([^"']+)["']/);g&&(o=g[1])}let f=o.match(/https?:\/\/[^\s"']+/);f&&(o=f[0]),o=o.replace(/[\\"'\)\]]+$/,""),!(!o||o.length<5||o.includes("google.com")||o.includes("youtube.com"))&&(o.startsWith("/")&&!o.startsWith("//")&&(o=r+o),c.push(o))}}if(c.length>0){c.sort((u,d)=>{let o=u.toLowerCase().includes(".m3u8"),h=d.toLowerCase().includes(".m3u8");return o!==h?h?1:-1:u.length-d.length});let n=c[0];return console.log(`[Moviesda] Found direct URL from ${s}: ${n}`),n}return console.log(`[Moviesda] No direct URL found in ${s}, skipping`),null}catch(r){return console.error(`[Moviesda] Error extracting from ${s}: ${r.message}`),null}})}function oe(t){return p(this,null,function*(){try{console.log(`[Moviesda] Extracting from embed: ${t}`);let r=new URL(t).hostname.toLowerCase();return r.includes("onestream.watch")?yield T(t):yield te(t,r)}catch(s){return console.error(`[Moviesda] Extraction error: ${s.message}`),null}})}function T(t){return p(this,null,function*(){console.log(`[Moviesda] Extracting from onestream.watch: ${t}`);try{let r=yield(yield v(t,{headers:S(R({},$),{Referer:m})},8e3)).text(),l=x.load(r),e=[];if(l("video source").each((c,n)=>{let u=l(n).attr("src"),d=l(n).attr("type");u&&e.push({src:u,type:d})}),e.length>0){let c=e[0].src;return console.log(`[Moviesda] Found direct URL from onestream: ${c}`),c}let a=r.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(a)return console.log(`[Moviesda] Found m3u8 URL: ${a[0]}`),a[0];let i=r.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);return i?(console.log(`[Moviesda] Found mp4 URL: ${i[0]}`),i[0]):(console.log("[Moviesda] No direct URL found in onestream page"),null)}catch(s){return console.error(`[Moviesda] Onestream extraction error: ${s.message}`),null}})}function P(t){return p(this,null,function*(){console.log(`[Moviesda] Parsing movie page: ${t}`);try{let r=yield(yield v(t,{headers:$},8e3)).text(),l=x.load(r),e=[],a=l('a[href*="-original-movie"]');if(a.length>0){let n=a.attr("href"),u=n.startsWith("http")?n:`${m}${n}`;return console.log(`[Moviesda] Found original page link: ${u}`),yield re(u)}let i=[];if(l("a").each((n,u)=>{let d=l(u).attr("href"),o=l(u).text().trim();if(d&&o.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let h=o.match(/\b(360p|480p|720p|1080p|4K)\b/i),f=h?h[0]:"Unknown",g=d.startsWith("http")?d:`${m}${d}`;i.push({url:g,quality:f})}}),i.length>0){console.log(`[Moviesda] Found ${i.length} quality pages`);for(let n of i){let u=yield z(n.url,n.quality);e.push(...u)}return e}let c=[];return l("a").each((n,u)=>{let d=l(u).attr("href"),o=l(u).text().trim();if(d&&d.includes("/download/")){let h=d.startsWith("http")?d:`${m}${d}`;c.push({url:h,text:o})}}),c.length>0&&(console.log(`[Moviesda] Found ${c.length} download links on quality page`),c.forEach(n=>{e.push({url:n.url,quality:"Unknown",type:"download"})})),console.log(`[Moviesda] Found ${e.length} streams on page`),e}catch(s){return console.error("[Moviesda] Movie page parse error:",s.message),[]}})}function re(t){return p(this,null,function*(){console.log(`[Moviesda] Parsing original page: ${t}`);try{let r=yield(yield v(t,{headers:$},8e3)).text(),l=x.load(r),e=[];l("a").each((i,c)=>{let n=l(c).attr("href"),u=l(c).text().trim();if(n&&u.match(/\b(360p|480p|720p|1080p|4K)\s*HD\b/i)){let d=u.match(/\b(360p|480p|720p|1080p|4K)\b/i),o=d?d[0]:"Unknown",h=n.startsWith("http")?n:`${m}${n}`;e.push({url:h,quality:o,type:"quality_page"})}}),console.log(`[Moviesda] Found ${e.length} quality pages on original page`);let a=[];for(let i of e){let c=yield z(i.url,i.quality);a.push(...c)}return a}catch(s){return console.error("[Moviesda] Original page parse error:",s.message),[]}})}function z(t,s){return p(this,null,function*(){console.log(`[Moviesda] Parsing quality page (${s}): ${t}`);try{let l=yield(yield v(t,{headers:$},8e3)).text(),e=x.load(l),a=[];return e("a").each((i,c)=>{let n=e(c).attr("href"),u=e(c).text().trim();if(n&&n.includes("/download/")){let d=n.startsWith("http")?n:`${m}${n}`;a.push({url:d,quality:s,type:"download"})}}),console.log(`[Moviesda] Found ${a.length} download links for ${s}`),a}catch(r){return console.error(`[Moviesda] Quality page parse error (${s}): ${r.message}`),[]}})}function _(t){return p(this,null,function*(){console.log(`[Moviesda] Extracting final URL from: ${t}`);try{let r=yield(yield v(t,{headers:$},8e3)).text(),l=x.load(r),e=[];if(l("a").each((a,i)=>{let c=l(i).attr("href"),n=l(i).text().trim().toLowerCase();if(c&&!c.includes("moviesda15.com")&&!c.includes("/tamil-movies/")&&!c.startsWith("#")&&(n.includes("download")||n.includes("server"))){let u=c.startsWith("http")?c:`https:${c}`;e.push(u)}}),e.length>0){let a=e[0];if(console.log(`[Moviesda] Found download URL: ${a}`),a.includes("download.moviespage.xyz/download/file/")){let i=a.match(/\/file\/(\d+)/);if(i){let n=`https://play.onestream.watch/stream/page/${i[1]}`;return console.log(`[Moviesda] Converted to onestream URL: ${n}`),{url:n,needsExtraction:!0}}}return{url:a,needsExtraction:!1}}return console.log("[Moviesda] No final download URL found on page"),null}catch(s){return console.error(`[Moviesda] Error extracting final URL: ${s.message}`),null}})}function C(t,s="movie",r=null,l=null){return p(this,null,function*(){console.log(`[Moviesda] Processing ${s} ${t}`);try{let e;if(/^\d+$/.test(t))try{e=yield X(t,s)}catch(o){console.log(`[Moviesda] TMDB fetch failed, using "${t}" as search query`),e={title:t,year:null}}else{console.log(`[Moviesda] Using "${t}" as search query`);try{let o=yield Z(t,s);o&&o.year?e=o:e={title:t,year:null}}catch(o){console.log(`[Moviesda] TMDB search failed: ${o.message}`),e={title:t,year:null}}}console.log(`[Moviesda] Looking for: "${e.title}" (${e.year||"N/A"})`);let i=yield ee(e.title,e.year),c=V(e,i);if(!c){console.warn("[Moviesda] No matching title found in category pages");let o=new Date().getFullYear(),h=e.year?[e.year,o,o-1]:[o,o-1,o+1,o-2,o-3,o-4,o-5,o-6,o-7,o-8,o-9,o-10,o-11,o-12,o-13,o-14,o-15];for(let f of h){let g=e.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-"),y=`${m}/${g}-${f}-tamil-movie/`;console.log(`[Moviesda] Trying direct URL: ${y}`);try{let w=yield v(y,{headers:$},5e3);if(w.ok){let q=yield w.text();if(q.includes("entry-title")||q.includes("movie")){console.log(`[Moviesda] \u2713 Direct URL found: ${y}`);let D=yield P(y);if(D.length>0){let O=D.slice(0,5),E=[];for(let U of O){let k=U.url;if(U.type==="download")try{let M=yield Promise.race([_(U.url),new Promise((L,F)=>setTimeout(()=>F(new Error("Extraction timeout")),5e3))]);if(!M)continue;if(M.needsExtraction)try{let L=yield Promise.race([T(M.url),new Promise((F,K)=>setTimeout(()=>K(new Error("Onestream extraction timeout")),5e3))]);if(!L)continue;k=L}catch(L){console.error(`[Moviesda] Onestream extraction failed: ${L.message}`);continue}else k=M.url}catch(M){console.error(`[Moviesda] Download URL extraction failed: ${M.message}`);continue}E.push({name:"Moviesda",title:`${e.title} (${e.year||"N/A"}) - ${U.quality}`,url:k,quality:U.quality||"Unknown",headers:{Referer:m,"User-Agent":$["User-Agent"]},provider:"Moviesda"})}return console.log(`[Moviesda] Successfully extracted ${E.length} streams`),E}}}}catch(w){console.log(`[Moviesda] Direct URL failed for ${f}: ${w.message}`)}}return console.warn("[Moviesda] No results found via category search or direct URL"),[]}console.log(`[Moviesda] Processing match: ${c.title}`);let n=yield P(c.href);if(n.length===0)return console.warn("[Moviesda] No streams found on movie page"),[];let u=n.slice(0,5);n.length>5&&console.log(`[Moviesda] Limiting to first 5 streams out of ${n.length}`);let d=[];for(let o of u){let h=o.url;if(o.type==="download")try{let f=yield Promise.race([_(o.url),new Promise((g,y)=>setTimeout(()=>y(new Error("Extraction timeout")),5e3))]);if(!f){console.log("[Moviesda] Failed to extract final URL from download page, skipping");continue}if(f.needsExtraction){console.log("[Moviesda] URL needs extraction from onestream");try{let g=yield Promise.race([T(f.url),new Promise((y,w)=>setTimeout(()=>w(new Error("Onestream extraction timeout")),5e3))]);if(!g){console.log("[Moviesda] Failed to extract from onestream, skipping");continue}h=g}catch(g){console.error(`[Moviesda] Onestream extraction failed: ${g.message}`);continue}}else h=f.url}catch(f){console.error(`[Moviesda] Download URL extraction failed: ${f.message}`);continue}else if(o.type==="embed")try{let f=yield Promise.race([oe(o.url),new Promise((g,y)=>setTimeout(()=>y(new Error("Extraction timeout")),5e3))]);if(!f){console.log("[Moviesda] Failed to extract from embed, skipping");continue}h=f}catch(f){console.error(`[Moviesda] Embed extraction failed: ${f.message}`);continue}d.push({name:"Moviesda",title:`${e.title} (${e.year||"N/A"}) - ${o.quality}`,url:h,quality:o.quality,headers:{Referer:m,"User-Agent":$["User-Agent"]},provider:"Moviesda"})}return console.log(`[Moviesda] Successfully extracted ${d.length} streams`),d}catch(e){return console.error("[Moviesda] getStreams failed:",e.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:C}:global.getStreams={getStreams:C};
