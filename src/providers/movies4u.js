/**
 * movies4u - Built from src/movies4u/
 * Generated: 2026-01-11T11:24:34.181Z
 */
var N=Object.defineProperty,k=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var E=(i,s,r)=>s in i?N(i,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[s]=r,M=(i,s)=>{for(var r in s||(s={}))b.call(s,r)&&E(i,r,s[r]);if(T)for(var r of T(s))D.call(s,r)&&E(i,r,s[r]);return i},y=(i,s)=>k(i,R(s));var m=(i,s,r)=>new Promise((a,e)=>{var n=t=>{try{o(r.next(t))}catch(c){e(c)}},l=t=>{try{o(r.throw(t))}catch(c){e(c)}},o=t=>t.done?a(t.value):Promise.resolve(t.value).then(n,l);o((r=r.apply(i,s)).next())});var A=require("cheerio-without-node-native"),C="1b3113663c9004682ed61086cf967c44",W="https://api.themoviedb.org/3",U="https://movies4u.fans",g="https://m4uplay.com",w={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${U}/`};function v(a){return m(this,arguments,function*(i,s={},r=1e4){let e=new AbortController,n=setTimeout(()=>e.abort(),r);try{let l=yield fetch(i,y(M({},s),{signal:e.signal}));return clearTimeout(n),l}catch(l){throw clearTimeout(n),l.name==="AbortError"?new Error(`Request timeout after ${r}ms`):l}})}function q(i){return i?i.replace(/\w\S*/g,s=>s.charAt(0).toUpperCase()+s.substr(1).toLowerCase()):""}function L(i){return i?i.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function B(i,s){let r=L(i),a=L(s);if(r===a)return 1;if(r.includes(a)||a.includes(r))return .9;let e=new Set(r.split(/\s+/).filter(t=>t.length>2)),n=new Set(a.split(/\s+/).filter(t=>t.length>2));if(e.size===0||n.size===0)return 0;let l=new Set([...e].filter(t=>n.has(t))),o=new Set([...e,...n]);return l.size/o.size}function F(i,s){if(!s||s.length===0)return null;let r=i.title.toLowerCase().replace(/[^a-z0-9]/g,""),a=i.year?parseInt(i.year):null,e=null,n=0;for(let l of s){let o=l.title.toLowerCase().replace(/[^a-z0-9]/g,""),t=B(i.title,l.title),c=o.includes(r)||r.includes(o),f=!a||l.title.includes(a.toString())||l.title.includes((a+1).toString())||l.title.includes((a-1).toString());c&&f&&(t+=.5),t>n&&(n=t,e=l)}return e&&n>.4?(console.log(`[Movies4u] Best title match: "${e.title}" (score: ${n.toFixed(2)})`),e):null}function I(i,s){let r=s.quality||"Unknown",a=i.title||"Unknown",e=i.year||"";if(!e||e==="N/A"){let d=(a+" "+(s.text||"")).match(/\b(19|20)\d{2}\b/);d&&(e=d[0])}let n=s.audioInfo||"",l="UNKNOWN",o=s.text?s.text.match(/(\d+(?:\.\d+)?\s*(?:GB|MB))/i):null;o&&(l=o[1].toUpperCase());let t="UNKNOWN",c=((s.text||"")+" "+(s.url||"")+" "+(s.label||"")).toLowerCase();c.includes("bluray")||c.includes("brrip")?t="BluRay":c.includes("web-dl")?t="WEB-DL":c.includes("webrip")?t="WEBRip":c.includes("hdrip")?t="HDRip":c.includes("dvdrip")?t="DVDRip":c.includes("bdrip")?t="BDRip":c.includes("hdtv")&&(t="HDTV");let f=e?` (${e})`:"",u="UNKNOWN";if(n){let d=n.match(/\[Multi Audio: (.*?)\]/i);d?u=d[1].toUpperCase():n.toLowerCase().includes("tamil")?u="TAMIL":u=n.toUpperCase()}let h=t&&t!=="UNKNOWN"?`\u{1F4FA}: ${t}
`:"",p=l&&l!=="UNKNOWN"?`\u{1F4BE}: ${l} | \u{1F69C}: movies4u
`:"";return`Movies4u (Instant) (${r})
${h}\u{1F4FC}: ${a}${f} - ${r}
${p}\u{1F310}: ${u}`}function z(i,s,r,a){for(;r--;)if(a[r]){let e=r.toString(s);i=i.replace(new RegExp("\\b"+e+"\\b","g"),a[r])}return i}function P(i){return m(this,null,function*(){let s={variants:[],audios:[],isMaster:!1};try{console.log(`[Movies4u] Resolving HLS playlist: ${i}`);let r=yield v(i,{headers:y(M({},w),{Referer:g})},5e3);if(!r.ok)return s;let a=yield r.text();if(!a.includes("#EXTM3U"))return s;if(a.includes("#EXT-X-STREAM-INF"))s.isMaster=!0;else if(a.includes("#EXT-X-MEDIA:TYPE=AUDIO")&&!a.includes("#EXT-X-STREAM-INF"))return console.log("[Movies4u] Found audio-only playlist, skipping resolution"),s;let e=a.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO.*?NAME="([^"]+)"(?:.*?CHANNELS="([^"]+)")?/g);for(let l of e){let o=l[1],t=l[2];if(t){let f={1:"1.0",2:"2.0",6:"5.1",8:"7.1"}[t]||t;o+=` (${f})`}s.audios.includes(o)||s.audios.push(o)}let n=a.split(`
`);for(let l=0;l<n.length;l++){let o=n[l].trim();if(o.includes("#EXT-X-STREAM-INF")){let t="Unknown",c=o.match(/RESOLUTION=(\d+)x(\d+)/i);if(c){let u=parseInt(c[2]);u>=2160?t="4K":u>=1080?t="1080p":u>=720?t="720p":u>=480?t="480p":t=`${u}p`}if(t==="Unknown"){let u=o.match(/NAME="([^"]+)"/i);u&&(t=u[1])}let f=l+1;for(;f<n.length&&(n[f].trim().startsWith("#")||!n[f].trim());)f++;if(f<n.length){let u=n[f].trim();if(u){let h=u;h.startsWith("http")||(h=i.substring(0,i.lastIndexOf("/")+1)+h),s.variants.some(p=>p.url===h)||s.variants.push({url:h,quality:t})}}l=f}}return console.log(`[Movies4u] HLS Summary: ${s.variants.length} qualities, ${s.audios.length} audios`),s}catch(r){return console.error(`[Movies4u] HLS resolution error: ${r.message}`),s}})}function H(i){return m(this,null,function*(){try{console.log(`[Movies4u] Extracting from m4uplay: ${i}`);let r=yield(yield v(i,{headers:y(M({},w),{Referer:U})},8e3)).text(),a=r.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s")),e=r;if(a){console.log("[Movies4u] Detected Packer obfuscation on m4uplay");try{let t=a[1].trim().match(new RegExp(`^['"](.*)['"]\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*['"](.*?)['"]\\.split\\(['"]\\|['"]\\)`,"s"));if(t){let c=t[1],f=parseInt(t[2]),u=parseInt(t[3]),h=t[4].split("|"),p=z(c,f,u,h);e+=`
`+p,console.log("[Movies4u] Successfully unpacked script")}}catch(o){console.error(`[Movies4u] Packer unpacking failed: ${o.message}`)}}let n=null,l=e.match(/https?:\/\/[^\s"']+\.(?:m3u8|txt)(?:\?[^\s"']*)?/);if(l&&(console.log(`[Movies4u] Found absolute HLS URL: ${l[0]}`),n=l[0]),!n){let o=e.match(/["']?(\/(?:stream|3o)\/[^"'\s]+\.(?:m3u8|txt))[^\s"']*/);if(o){let t=o[1];t.startsWith("/")&&(t=g+t),console.log(`[Movies4u] Found relative stream URL: ${t}`),n=t}}if(!n){let o=e.match(/["']file["']\s*:\s*["']([^"']+\.(?:m3u8|txt)[^"']*)["']/);if(o){let t=o[1];t.startsWith("/")&&(t=g+t),console.log(`[Movies4u] Found stream URL from JWPlayer file property: ${t}`),n=t}}if(!n){let o=e.match(/https?:\/\/[^\s"']*master\.txt[^\s"']*/);o&&(console.log(`[Movies4u] Found master.txt HLS URL: ${o[0]}`),n=o[0])}if(!n){let o=e.match(new RegExp(`["'](?:playlist|sources)["']\\s*:\\s*\\[\\s*\\{[^}]*["']file["']\\s*:\\s*["']([^"']+)["']`,"s"));if(o){let t=o[1];t.startsWith("/")&&(t=g+t),console.log(`[Movies4u] Found stream URL from playlist/sources: ${t}`),n=t}}if(!n){let o=e.match(/([\/a-zA-Z0-9_\-\.]+\/master\.(?:m3u8|txt))/);if(o){let t=o[1];t.startsWith("/")&&(t=g+t),console.log(`[Movies4u] Found master reference: ${t}`),n=t}}if(n){if(n.includes("master.")){console.log("[Movies4u] Resolving master playlist...");let o=yield P(n);if(o.isMaster){let t="";return o.audios.length>1&&(t=` [Multi Audio: ${o.audios.join(", ")}]`,console.log(`[Movies4u] Found multi-audio: ${o.audios.join(", ")}`)),o.variants.map(c=>({url:c.url,audios:o.audios,audioInfo:t,quality:c.quality}))}}return[{url:n,audios:[],audioInfo:"",quality:"Unknown"}]}return console.log("[Movies4u] Could not extract stream URL from m4uplay embed"),[]}catch(s){return console.error(`[Movies4u] M4UPlay extraction error: ${s.message}`),[]}})}function X(i){return m(this,null,function*(){try{console.log(`[Movies4u] Extracting watch links from: ${i}`);let r=yield(yield v(i,{headers:w},8e3)).text(),a=A.load(r),e=[];return a("a.btn.btn-zip").each((n,l)=>{let o=a(l).attr("href"),t=a(l).text().trim();o&&o.includes("m4uplay.com")&&e.push({url:o,quality:t.includes("1080p")?"1080p":t.includes("720p")?"720p":t.includes("480p")?"480p":t.includes("4K")||t.includes("2160p")?"4K":t.includes("iMAX")?"iMAX":"Unknown",label:t})}),console.log(`[Movies4u] Found ${e.length} watch links`),e}catch(s){return console.error(`[Movies4u] Error extracting watch links: ${s.message}`),[]}})}function K(i,s){return m(this,null,function*(){let a=`${W}/${s==="movie"?"movie":"tv"}/${i}?api_key=${C}`;try{let e=yield v(a,{},8e3);if(!e.ok)throw new Error(`TMDB error: ${e.status}`);let n=yield e.json();if(!n.title&&!n.name)throw new Error("TMDB returned no title");let l={title:n.title||n.name,year:(n.release_date||n.first_air_date||"").split("-")[0]};return console.log(`[Movies4u] TMDB Info: "${l.title}" (${l.year||"N/A"})`),l}catch(e){throw console.error("[Movies4u] Error fetching TMDB metadata:",e.message),e}})}function O(i){return m(this,null,function*(){try{let s=`${U}/?s=${encodeURIComponent(i)}`;console.log(`[Movies4u] Searching: ${s}`);let a=yield(yield v(s,{headers:w},8e3)).text(),e=A.load(a),n=[];return e("h3.entry-title a").each((l,o)=>{let t=e(o).text().trim(),c=e(o).attr("href");t&&c&&n.push({title:t,url:c})}),console.log(`[Movies4u] Found ${n.length} search results`),n}catch(s){return console.error(`[Movies4u] Search error: ${s.message}`),[]}})}function x(i,s="movie",r=null,a=null){return m(this,null,function*(){console.log(`[Movies4u] Processing ${s} ${i}`);try{let e;if(/^\d+$/.test(i))try{e=yield K(i,s)}catch(p){console.log(`[Movies4u] TMDB fetch failed for ${i}, using as search query`),e={title:i,year:null}}else console.log(`[Movies4u] Using "${i}" as search query directly`),e={title:i,year:null};let l=yield O(e.title);if(l.length===0)return console.warn("[Movies4u] No search results found"),[];let o=F(e,l);if(!o)return console.warn("[Movies4u] No matching title found in search results"),[];console.log(`[Movies4u] Found match: ${o.title}`);let c=o.title.split("(")[0].trim(),f=o.title.match(/\((20\d{2}|19\d{2})\)/);e.title.toLowerCase()===i.toLowerCase()||e.title===e.title.toLowerCase()?(e.title=c,f&&(e.year=f[1])):!e.year&&f&&(e.year=f[1]),e.title===e.title.toLowerCase()&&(e.title=q(e.title));let u=yield X(o.url);if(u.length===0)return console.warn("[Movies4u] No watch links found on movie page"),[];let h=[];for(let p of u){let d=yield H(p.url);if(d&&d.length>0){let _=o.title.split("(")[0].trim();for(let $ of d){let S=y(M({},$),{quality:$.quality!=="Unknown"?$.quality:p.quality,text:p.label});h.push({name:"Movies4u",title:I(e,S),url:$.url,quality:S.quality,headers:{Referer:g,"User-Agent":w["User-Agent"]},provider:"Movies4u"})}}}return console.log(`[Movies4u] Extracted ${h.length} streams`),h}catch(e){return console.error("[Movies4u] getStreams failed:",e.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:x}:global.getStreams={getStreams:x};
