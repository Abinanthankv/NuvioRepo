/**
 * movies4u - Built from src/movies4u/
 * Generated: 2026-01-12T02:39:02.612Z
 */
var b=Object.defineProperty,k=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var L=(n,t,r)=>t in n?b(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,w=(n,t)=>{for(var r in t||(t={}))I.call(t,r)&&L(n,r,t[r]);if(S)for(var r of S(t))C.call(t,r)&&L(n,r,t[r]);return n},v=(n,t)=>k(n,D(t));var M=(n,t,r)=>new Promise((c,s)=>{var i=e=>{try{o(r.next(e))}catch(l){s(l)}},a=e=>{try{o(r.throw(e))}catch(l){s(l)}},o=e=>e.done?c(e.value):Promise.resolve(e.value).then(i,a);o((r=r.apply(n,t)).next())});var R=require("cheerio-without-node-native"),q="1b3113663c9004682ed61086cf967c44",B="https://api.themoviedb.org/3",E="https://movies4u.fans",y="https://m4uplay.com",$={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${E}/`};function U(c){return M(this,arguments,function*(n,t={},r=1e4){let s=new AbortController,i=setTimeout(()=>s.abort(),r);try{let a=yield fetch(n,v(w({},t),{signal:s.signal}));return clearTimeout(i),a}catch(a){throw clearTimeout(i),a.name==="AbortError"?new Error(`Request timeout after ${r}ms`):a}})}function O(n){return n?n.replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()):""}function N(n){return n?n.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function W(n,t){let r=N(n),c=N(t);if(r===c)return 1;if(r.includes(c)||c.includes(r))return .9;let s=new Set(r.split(/\s+/).filter(e=>e.length>2)),i=new Set(c.split(/\s+/).filter(e=>e.length>2));if(s.size===0||i.size===0)return 0;let a=new Set([...s].filter(e=>i.has(e))),o=new Set([...s,...i]);return a.size/o.size}function F(n,t){if(!t||t.length===0)return null;let r=n.title.toLowerCase().replace(/[^a-z0-9]/g,""),c=n.year?parseInt(n.year):null,s=null,i=0;for(let a of t){let o=a.title.toLowerCase().replace(/[^a-z0-9]/g,""),e=W(n.title,a.title),l=o.includes(r)||r.includes(o),u=!c||a.title.includes(c.toString())||a.title.includes((c+1).toString())||a.title.includes((c-1).toString());l&&u&&(e+=.5),e>i&&(i=e,s=a)}return s&&i>.4?(console.log(`[Movies4u] Best title match: "${s.title}" (score: ${i.toFixed(2)})`),s):null}function X(n,t){let r=t.quality||"Unknown",c=n.title||"Unknown",s=t.isMaster||!1,i=n.year||"";if(!i||i==="N/A"){let g=(c+" "+(t.text||"")).match(/\b(19|20)\d{2}\b/);g&&(i=g[0])}let a=t.audioInfo||"",o="UNKNOWN",e=t.text?t.text.match(/(\d+(?:\.\d+)?\s*(?:GB|MB))/i):null;e&&(o=e[1].toUpperCase());let l="UNKNOWN",u=((t.text||"")+" "+(t.url||"")+" "+(t.label||"")).toLowerCase();u.includes("bluray")||u.includes("brrip")?l="BluRay":u.includes("web-dl")?l="WEB-DL":u.includes("webrip")?l="WEBRip":u.includes("hdrip")?l="HDRip":u.includes("dvdrip")?l="DVDRip":u.includes("bdrip")?l="BDRip":u.includes("hdtv")&&(l="HDTV");let h=i?` (${i})`:"",f="UNKNOWN",p=t.selectedAudio||"";if(p)f=p.toUpperCase();else if(a){let g=a.match(/\[Multi Audio: (.*?)\]/i),T=a.match(/\[Audio: (.*?)\]/i);g?f=g[1].toUpperCase():T?f=T[1].toUpperCase():a.toLowerCase().includes("tamil")?f="TAMIL":f=a.toUpperCase()}let d=r;s&&(p?d=`${r} (${p})`:d=`${r} (Multi-Audio)`);let A=l&&l!=="UNKNOWN"?`\u{1F4FA}: ${l}
`:"",m=o&&o!=="UNKNOWN"?`\u{1F4BE}: ${o} | \u{1F69C}: movies4u
`:"";return`Movies4u (Instant) (${d})
${A}\u{1F4FC}: ${c}${h} - ${d}
${m}\u{1F310}: ${f}`}function P(n,t,r,c){for(;r--;)if(c[r]){let s=r.toString(t);n=n.replace(new RegExp("\\b"+s+"\\b","g"),c[r])}return n}function z(n){return M(this,null,function*(){let t={masterUrl:n,variants:[],audios:[],isMaster:!1};try{console.log(`[Movies4u] Resolving HLS playlist: ${n}`);let r=yield U(n,{headers:v(w({},$),{Referer:y})},5e3);if(!r.ok)return t;let c=yield r.text();if(!c.includes("#EXTM3U"))return t;if(c.includes("#EXT-X-STREAM-INF"))t.isMaster=!0;else if(c.includes("#EXT-X-MEDIA:TYPE=AUDIO")&&!c.includes("#EXT-X-STREAM-INF"))return console.log("[Movies4u] Found audio-only playlist, skipping resolution"),t;let s=c.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO,.*?NAME="([^"]+)"(?:.*?LANGUAGE="([^"]+)")?(?:.*?CHANNELS="([^"]+)")?(?:.*?URI="([^"]+)")?/g);for(let a of s){let o=a[1],e=a[2],l=a[3],u=a[4];if(u&&!u.startsWith("http")&&(u=n.substring(0,n.lastIndexOf("/")+1)+u),l){let f={1:"1.0",2:"2.0",6:"5.1",8:"7.1"}[l]||l;o+=` (${f})`}t.audios.some(h=>h.name===o)||t.audios.push({name:o,language:e||"unknown",uri:u})}let i=c.split(`
`);for(let a=0;a<i.length;a++){let o=i[a].trim();if(o.includes("#EXT-X-STREAM-INF")){let e="Unknown",l=o.match(/RESOLUTION=(\d+)x(\d+)/i);if(l){let h=parseInt(l[2]);h>=2160?e="4K":h>=1080?e="1080p":h>=720?e="720p":h>=480?e="480p":e=`${h}p`}if(e==="Unknown"){let h=o.match(/NAME="([^"]+)"/i);h&&(e=h[1])}let u=a+1;for(;u<i.length&&(i[u].trim().startsWith("#")||!i[u].trim());)u++;if(u<i.length){let h=i[u].trim();if(h){let f=h;f.startsWith("http")||(f=n.substring(0,n.lastIndexOf("/")+1)+f),t.variants.some(p=>p.url===f)||t.variants.push({url:f,quality:e})}}a=u}}return console.log(`[Movies4u] HLS Summary: ${t.variants.length} qualities, ${t.audios.length} audios found`),t}catch(r){return console.error(`[Movies4u] HLS resolution error: ${r.message}`),t}})}function H(n){return M(this,null,function*(){try{console.log(`[Movies4u] Extracting from m4uplay: ${n}`);let r=yield(yield U(n,{headers:v(w({},$),{Referer:E})},8e3)).text(),c=r.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s")),s=r;if(c){console.log("[Movies4u] Detected Packer obfuscation on m4uplay");try{let e=c[1].trim().match(new RegExp(`^['"](.*)['"]\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*['"](.*?)['"]\\.split\\(['"]\\|['"]\\)`,"s"));if(e){let l=e[1],u=parseInt(e[2]),h=parseInt(e[3]),f=e[4].split("|"),p=P(l,u,h,f);s+=`
`+p,console.log("[Movies4u] Successfully unpacked script")}}catch(o){console.error(`[Movies4u] Packer unpacking failed: ${o.message}`)}}let i=null,a=s.match(/https?:\/\/[^\s"']+\.(?:m3u8|txt)(?:\?[^\s"']*)?/);if(a&&(console.log(`[Movies4u] Found absolute HLS URL: ${a[0]}`),i=a[0]),!i){let o=s.match(/["']?(\/(?:stream|3o)\/[^"'\s]+\.(?:m3u8|txt))[^\s"']*/);if(o){let e=o[1];e.startsWith("/")&&(e=y+e),console.log(`[Movies4u] Found relative stream URL: ${e}`),i=e}}if(!i){let o=s.match(/["']file["']\s*:\s*["']([^"']+\.(?:m3u8|txt)[^"']*)["']/);if(o){let e=o[1];e.startsWith("/")&&(e=y+e),console.log(`[Movies4u] Found stream URL from JWPlayer file property: ${e}`),i=e}}if(!i){let o=s.match(/https?:\/\/[^\s"']*master\.txt[^\s"']*/);o&&(console.log(`[Movies4u] Found master.txt HLS URL: ${o[0]}`),i=o[0])}if(!i){let o=s.match(new RegExp(`["'](?:playlist|sources)["']\\s*:\\s*\\[\\s*\\{[^}]*["']file["']\\s*:\\s*["']([^"']+)["']`,"s"));if(o){let e=o[1];e.startsWith("/")&&(e=y+e),console.log(`[Movies4u] Found stream URL from playlist/sources: ${e}`),i=e}}if(!i){let o=s.match(/([\/a-zA-Z0-9_\-\.]+\/master\.(?:m3u8|txt))/);if(o){let e=o[1];e.startsWith("/")&&(e=y+e),console.log(`[Movies4u] Found master reference: ${e}`),i=e}}if(i){if(i.includes("master.")){console.log("[Movies4u] Resolving master playlist...");let o=yield z(i);if(o.isMaster){let e=[],l=o.audios,u=h=>{let f=`#EXTM3U
`;for(let p of l){let A=p.name===h?"DEFAULT=YES,AUTOSELECT=YES":"DEFAULT=NO,AUTOSELECT=NO";f+=`#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio0",NAME="${p.name}",LANGUAGE="${p.language}",${A},URI="${p.uri}"
`}for(let p of o.variants)f+=`#EXT-X-STREAM-INF:BANDWIDTH=1000000,RESOLUTION=${p.quality.includes("p")?"1280x"+p.quality.replace("p",""):"1280x720"},AUDIO="audio0"
`,f+=`${p.url}
`;try{return`data:application/vnd.apple.mpegurl;base64,${typeof Buffer!="undefined"?Buffer.from(f).toString("base64"):btoa(f)}`}catch(p){return o.masterUrl}};if(l.length>1)for(let h of l){let f=u(h.name);for(let p of o.variants)e.push({url:f,audios:l,audioInfo:`[Audio: ${h.name}]`,quality:p.quality,selectedAudio:h.name,isMaster:!0})}else{let h=l.length>0?`[Audio: ${l[0].name}]`:"";o.variants.forEach(f=>{e.push({url:f.url,audios:l,audioInfo:h,quality:f.quality,isMaster:!1})})}return e}}return[{url:i,audios:[],audioInfo:"",quality:"Unknown"}]}return console.log("[Movies4u] Could not extract stream URL from m4uplay embed"),[]}catch(t){return console.error(`[Movies4u] M4UPlay extraction error: ${t.message}`),[]}})}function K(n){return M(this,null,function*(){try{console.log(`[Movies4u] Extracting watch links from: ${n}`);let r=yield(yield U(n,{headers:$},8e3)).text(),c=R.load(r),s=[];return c("a.btn.btn-zip").each((i,a)=>{let o=c(a).attr("href"),e=c(a).text().trim();o&&o.includes("m4uplay.com")&&s.push({url:o,quality:e.includes("1080p")?"1080p":e.includes("720p")?"720p":e.includes("480p")?"480p":e.includes("4K")||e.includes("2160p")?"4K":e.includes("iMAX")?"iMAX":"Unknown",label:e})}),console.log(`[Movies4u] Found ${s.length} watch links`),s}catch(t){return console.error(`[Movies4u] Error extracting watch links: ${t.message}`),[]}})}function _(n,t){return M(this,null,function*(){let c=`${B}/${t==="movie"?"movie":"tv"}/${n}?api_key=${q}`;try{let s=yield U(c,{},8e3);if(!s.ok)throw new Error(`TMDB error: ${s.status}`);let i=yield s.json();if(!i.title&&!i.name)throw new Error("TMDB returned no title");let a={title:i.title||i.name,year:(i.release_date||i.first_air_date||"").split("-")[0]};return console.log(`[Movies4u] TMDB Info: "${a.title}" (${a.year||"N/A"})`),a}catch(s){throw console.error("[Movies4u] Error fetching TMDB metadata:",s.message),s}})}function Y(n){return M(this,null,function*(){try{let t=`${E}/?s=${encodeURIComponent(n)}`;console.log(`[Movies4u] Searching: ${t}`);let c=yield(yield U(t,{headers:$},8e3)).text(),s=R.load(c),i=[];return s("h3.entry-title a").each((a,o)=>{let e=s(o).text().trim(),l=s(o).attr("href");e&&l&&i.push({title:e,url:l})}),console.log(`[Movies4u] Found ${i.length} search results`),i}catch(t){return console.error(`[Movies4u] Search error: ${t.message}`),[]}})}function x(n,t="movie",r=null,c=null){return M(this,null,function*(){console.log(`[Movies4u] Processing ${t} ${n}`);try{let s;if(/^\d+$/.test(n))try{s=yield _(n,t)}catch(p){console.log(`[Movies4u] TMDB fetch failed for ${n}, using as search query`),s={title:n,year:null}}else console.log(`[Movies4u] Using "${n}" as search query directly`),s={title:n,year:null};let a=yield Y(s.title);if(a.length===0)return console.warn("[Movies4u] No search results found"),[];let o=F(s,a);if(!o)return console.warn("[Movies4u] No matching title found in search results"),[];console.log(`[Movies4u] Found match: ${o.title}`);let l=o.title.split("(")[0].trim(),u=o.title.match(/\((20\d{2}|19\d{2})\)/);s.title.toLowerCase()===n.toLowerCase()||s.title===s.title.toLowerCase()?(s.title=l,u&&(s.year=u[1])):!s.year&&u&&(s.year=u[1]),s.title===s.title.toLowerCase()&&(s.title=O(s.title));let h=yield K(o.url);if(h.length===0)return console.warn("[Movies4u] No watch links found on movie page"),[];let f=[];for(let p of h){let d=yield H(p.url);if(d&&d.length>0){let A=o.title.split("(")[0].trim();for(let m of d){let g=v(w({},m),{quality:m.quality!=="Unknown"?m.quality:p.quality,text:p.label,isMaster:m.isMaster});f.push({name:"Movies4u",title:X(s,g),url:m.url,quality:g.quality,headers:{Referer:y,"User-Agent":$["User-Agent"]},provider:"Movies4u"})}}}return console.log(`[Movies4u] Extracted ${f.length} streams`),f}catch(s){return console.error("[Movies4u] getStreams failed:",s.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:x}:global.getStreams={getStreams:x};
