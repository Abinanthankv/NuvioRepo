/**
 * movies4u - Built from src/movies4u/
 * Generated: 2026-01-11T05:23:23.680Z
 */
var A=Object.defineProperty,E=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var x=(e,s,i)=>s in e?A(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,y=(e,s)=>{for(var i in s||(s={}))R.call(s,i)&&x(e,i,s[i]);if($)for(var i of $(s))b.call(s,i)&&x(e,i,s[i]);return e},w=(e,s)=>E(e,L(s));var h=(e,s,i)=>new Promise((l,o)=>{var n=t=>{try{r(i.next(t))}catch(c){o(c)}},a=t=>{try{r(i.throw(t))}catch(c){o(c)}},r=t=>t.done?l(t.value):Promise.resolve(t.value).then(n,a);r((i=i.apply(e,s)).next())});var S=require("cheerio-without-node-native"),q="1b3113663c9004682ed61086cf967c44",F="https://api.themoviedb.org/3",v="https://movies4u.fans",p="https://m4uplay.com",d={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${v}/`};function M(l){return h(this,arguments,function*(e,s={},i=1e4){let o=new AbortController,n=setTimeout(()=>o.abort(),i);try{let a=yield fetch(e,w(y({},s),{signal:o.signal}));return clearTimeout(n),a}catch(a){throw clearTimeout(n),a.name==="AbortError"?new Error(`Request timeout after ${i}ms`):a}})}function k(e){return e?e.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function D(e,s){let i=k(e),l=k(s);if(i===l)return 1;if(i.includes(l)||l.includes(i))return .9;let o=new Set(i.split(/\s+/).filter(t=>t.length>2)),n=new Set(l.split(/\s+/).filter(t=>t.length>2));if(o.size===0||n.size===0)return 0;let a=new Set([...o].filter(t=>n.has(t))),r=new Set([...o,...n]);return a.size/r.size}function I(e,s){if(!s||s.length===0)return null;let i=e.title.toLowerCase().replace(/[^a-z0-9]/g,""),l=e.year?parseInt(e.year):null,o=null,n=0;for(let a of s){let r=a.title.toLowerCase().replace(/[^a-z0-9]/g,""),t=D(e.title,a.title),c=r.includes(i)||i.includes(r),u=!l||a.title.includes(l.toString())||a.title.includes((l+1).toString())||a.title.includes((l-1).toString());c&&u&&(t+=.5),t>n&&(n=t,o=a)}return o&&n>.4?(console.log(`[Movies4u] Best title match: "${o.title}" (score: ${n.toFixed(2)})`),o):null}function z(e,s,i,l){for(;i--;)if(l[i]){let o=i.toString(s);e=e.replace(new RegExp("\\b"+o+"\\b","g"),l[i])}return e}function B(e){return h(this,null,function*(){let s={variants:[],audios:[],isMaster:!1};try{let i=yield M(e,{headers:w(y({},d),{Referer:p})},5e3);if(!i.ok)return s;let l=yield i.text();if(!l.includes("#EXTM3U"))return s;s.isMaster=!0;let o=l.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO.*?NAME="([^"]+)"/g);for(let a of o)s.audios.push(a[1]);let n=l.split(`
`);for(let a=0;a<n.length;a++){let r=n[a].trim();if(r.includes("#EXT-X-STREAM-INF")){let t="Unknown",c=r.match(/RESOLUTION=(\d+)x(\d+)/i);if(c){let u=parseInt(c[2]);u>=2160?t="4K":u>=1080?t="1080p":u>=720?t="720p":u>=480?t="480p":t=`${u}p`}if(a+1<n.length){let u=n[a+1].trim();if(u&&!u.startsWith("#")){let f=u;f.startsWith("http")||(f=e.substring(0,e.lastIndexOf("/")+1)+f),s.variants.push({url:f,quality:t})}}}}return s.variants.length===0&&s.variants.push({url:e,quality:"Unknown"}),s}catch(i){return console.error(`[Movies4u] HLS resolution error: ${i.message}`),s}})}function W(e){return h(this,null,function*(){try{console.log(`[Movies4u] Extracting from m4uplay: ${e}`);let i=yield(yield M(e,{headers:w(y({},d),{Referer:v})},8e3)).text(),l=i.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s")),o=i;if(l){console.log("[Movies4u] Detected Packer obfuscation on m4uplay");try{let t=l[1].trim().match(new RegExp(`^['"](.*)['"]\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*['"](.*?)['"]\\.split\\(['"]\\|['"]\\)`,"s"));if(t){let c=t[1],u=parseInt(t[2]),f=parseInt(t[3]),g=t[4].split("|"),m=z(c,u,f,g);o+=`
`+m,console.log("[Movies4u] Successfully unpacked script")}}catch(r){console.error(`[Movies4u] Packer unpacking failed: ${r.message}`)}}let n=null,a=o.match(/https?:\/\/[^\s"']+\.(?:m3u8|txt)(?:\?[^\s"']*)?/);if(a&&(console.log(`[Movies4u] Found absolute HLS URL: ${a[0]}`),n=a[0]),!n){let r=o.match(/["']?(\/(?:stream|3o)\/[^"'\s]+\.(?:m3u8|txt))[^\s"']*/);if(r){let t=r[1];t.startsWith("/")&&(t=p+t),console.log(`[Movies4u] Found relative stream URL: ${t}`),n=t}}if(!n){let r=o.match(/["']file["']\s*:\s*["']([^"']+\.(?:m3u8|txt)[^"']*)["']/);if(r){let t=r[1];t.startsWith("/")&&(t=p+t),console.log(`[Movies4u] Found stream URL from JWPlayer file property: ${t}`),n=t}}if(!n){let r=o.match(/https?:\/\/[^\s"']*master\.txt[^\s"']*/);r&&(console.log(`[Movies4u] Found master.txt HLS URL: ${r[0]}`),n=r[0])}if(!n){let r=o.match(new RegExp(`["'](?:playlist|sources)["']\\s*:\\s*\\[\\s*\\{[^}]*["']file["']\\s*:\\s*["']([^"']+)["']`,"s"));if(r){let t=r[1];t.startsWith("/")&&(t=p+t),console.log(`[Movies4u] Found stream URL from playlist/sources: ${t}`),n=t}}if(!n){let r=o.match(/([\/a-zA-Z0-9_\-\.]+\/master\.(?:m3u8|txt))/);if(r){let t=r[1];t.startsWith("/")&&(t=p+t),console.log(`[Movies4u] Found master reference: ${t}`),n=t}}if(n){if(n.includes("master.")){console.log("[Movies4u] Resolving master playlist...");let r=yield B(n);if(r.isMaster){let t="";return r.audios.length>1&&(t=` [Multi Audio: ${r.audios.join(", ")}]`,console.log(`[Movies4u] Found multi-audio: ${r.audios.join(", ")}`)),r.variants.map(c=>({url:c.url,audios:r.audios,audioInfo:t,quality:c.quality}))}}return[{url:n,audios:[],audioInfo:"",quality:"Unknown"}]}return console.log("[Movies4u] Could not extract stream URL from m4uplay embed"),[]}catch(s){return console.error(`[Movies4u] M4UPlay extraction error: ${s.message}`),[]}})}function N(e){return h(this,null,function*(){try{console.log(`[Movies4u] Extracting watch links from: ${e}`);let i=yield(yield M(e,{headers:d},8e3)).text(),l=S.load(i),o=[];return l("a.btn.btn-zip").each((n,a)=>{let r=l(a).attr("href"),t=l(a).text().trim();r&&r.includes("m4uplay.com")&&o.push({url:r,quality:t.includes("1080p")?"1080p":t.includes("720p")?"720p":t.includes("480p")?"480p":t.includes("4K")||t.includes("2160p")?"4K":t.includes("iMAX")?"iMAX":"Unknown",label:t})}),console.log(`[Movies4u] Found ${o.length} watch links`),o}catch(s){return console.error(`[Movies4u] Error extracting watch links: ${s.message}`),[]}})}function P(e,s){return h(this,null,function*(){let l=`${F}/${s==="movie"?"movie":"tv"}/${e}?api_key=${q}`;try{let o=yield M(l,{},8e3);if(!o.ok)throw new Error(`TMDB error: ${o.status}`);let n=yield o.json();if(!n.title&&!n.name)throw new Error("TMDB returned no title");let a={title:n.title||n.name,year:(n.release_date||n.first_air_date||"").split("-")[0]};return console.log(`[Movies4u] TMDB Info: "${a.title}" (${a.year||"N/A"})`),a}catch(o){throw console.error("[Movies4u] Error fetching TMDB metadata:",o.message),o}})}function _(e){return h(this,null,function*(){try{let s=`${v}/?s=${encodeURIComponent(e)}`;console.log(`[Movies4u] Searching: ${s}`);let l=yield(yield M(s,{headers:d},8e3)).text(),o=S.load(l),n=[];return o("h3.entry-title a").each((a,r)=>{let t=o(r).text().trim(),c=o(r).attr("href");t&&c&&n.push({title:t,url:c})}),console.log(`[Movies4u] Found ${n.length} search results`),n}catch(s){return console.error(`[Movies4u] Search error: ${s.message}`),[]}})}function U(e,s="movie",i=null,l=null){return h(this,null,function*(){console.log(`[Movies4u] Processing ${s} ${e}`);try{let o;if(/^\d+$/.test(e))try{o=yield P(e,s)}catch(u){console.log(`[Movies4u] TMDB fetch failed for ${e}, using as search query`),o={title:e,year:null}}else console.log(`[Movies4u] Using "${e}" as search query directly`),o={title:e,year:null};let a=yield _(o.title);if(a.length===0)return console.warn("[Movies4u] No search results found"),[];let r=I(o,a);if(!r)return console.warn("[Movies4u] No matching title found in search results"),[];console.log(`[Movies4u] Found match: ${r.title}`);let t=yield N(r.url);if(t.length===0)return console.warn("[Movies4u] No watch links found on movie page"),[];let c=[];for(let u of t){let f=yield W(u.url);if(f&&f.length>0){let g=r.title.split("(")[0].trim();for(let m of f){let T=m.audioInfo?`${g}${m.audioInfo}`:g;c.push({name:"Movies4u",title:T,url:m.url,quality:m.quality!=="Unknown"?m.quality:u.quality,headers:{Referer:p,"User-Agent":d["User-Agent"]},provider:"Movies4u"})}}}return console.log(`[Movies4u] Extracted ${c.length} streams`),c}catch(o){return console.error("[Movies4u] getStreams failed:",o.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:U}:global.getStreams={getStreams:U};
