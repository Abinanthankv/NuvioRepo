/**
 * movies4u - Built from src/movies4u/
 * Generated: 2026-01-18T09:38:08.107Z
 */
var k=Object.defineProperty,L=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var x=(s,t,n)=>t in s?k(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,m=(s,t)=>{for(var n in t||(t={}))I.call(t,n)&&x(s,n,t[n]);if(S)for(var n of S(t))C.call(t,n)&&x(s,n,t[n]);return s},M=(s,t)=>L(s,R(t));var d=(s,t,n)=>new Promise((l,i)=>{var o=e=>{try{r(n.next(e))}catch(c){i(c)}},a=e=>{try{r(n.throw(e))}catch(c){i(c)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,a);r((n=n.apply(s,t)).next())});var b=require("cheerio-without-node-native"),q="1b3113663c9004682ed61086cf967c44",D="https://api.themoviedb.org/3",$="https://movies4u.fans",U="https://m4uplay.com",y={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${$}/`};function w(l){return d(this,arguments,function*(s,t={},n=1e4){let i=new AbortController,o=setTimeout(()=>i.abort(),n);try{let a=yield fetch(s,M(m({},t),{signal:i.signal}));return clearTimeout(o),a}catch(a){throw clearTimeout(o),a.name==="AbortError"?new Error(`Request timeout after ${n}ms`):a}})}function A(s){return s?s.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function W(s,t){let n=A(s),l=A(t);if(n===l)return 1;if(n.includes(l)||l.includes(n))return .9;let i=new Set(n.split(/\s+/).filter(e=>e.length>2)),o=new Set(l.split(/\s+/).filter(e=>e.length>2));if(i.size===0||o.size===0)return 0;let a=new Set([...i].filter(e=>o.has(e))),r=new Set([...i,...o]);return a.size/r.size}function z(s,t){if(!t||t.length===0)return null;let n=s.title.toLowerCase().replace(/[^a-z0-9]/g,""),l=s.year?parseInt(s.year):null,i=null,o=0;for(let a of t){let r=a.title.toLowerCase().replace(/[^a-z0-9]/g,""),e=W(s.title,a.title),c=r.includes(n)||n.includes(r),u=!l||a.title.includes(l.toString())||a.title.includes((l+1).toString())||a.title.includes((l-1).toString());c&&u&&(e+=.5),e>o&&(o=e,i=a)}return i&&o>.4?(console.log(`[Movies4u] Best title match: "${i.title}" (score: ${o.toFixed(2)})`),i):null}function B(s,t){let n=t.quality||"Unknown",l=s.title||"Unknown",i=t.isMaster||!1,o=s.year||"";if(!o||o==="N/A"){let g=(l+" "+(t.text||"")).match(/\b(19|20)\d{2}\b/);g&&(o=g[0])}let a=t.audioInfo||"",r="UNKNOWN",e=t.text?t.text.match(/(\d+(?:\.\d+)?\s*(?:GB|MB))/i):null;e&&(r=e[1].toUpperCase());let c="UNKNOWN",u=((t.text||"")+" "+(t.url||"")+" "+(t.label||"")).toLowerCase();u.includes("bluray")||u.includes("brrip")?c="BluRay":u.includes("web-dl")?c="WEB-DL":u.includes("webrip")?c="WEBRip":u.includes("hdrip")?c="HDRip":u.includes("dvdrip")?c="DVDRip":u.includes("bdrip")?c="BDRip":u.includes("hdtv")&&(c="HDTV");let f=o?` (${o})`:"",h="UNKNOWN";if(a){let g=a.match(/\[Multi Audio: (.*?)\]/i);if(g)h=g[1].toUpperCase();else{let E=a.match(/\[Audio: (.*?)\]/i);E?h=E[1].toUpperCase():h=a.toUpperCase()}}let p=n,v=c&&c!=="UNKNOWN"?`\u{1F4FA}: ${c}
`:"",T=r&&r!=="UNKNOWN"?`\u{1F4BE}: ${r} | \u{1F69C}: movies4u
`:"";return`Movies4u (Instant) (${p})
${v}\u{1F4FC}: ${l}${f} - ${p}
${T}\u{1F310}: ${h}`}function K(s,t,n,l){for(;n--;)if(l[n]){let i=n.toString(t);s=s.replace(new RegExp("\\b"+i+"\\b","g"),l[n])}return s}function O(s){return d(this,null,function*(){let t={masterUrl:s,variants:[],audios:[],isMaster:!1};try{console.log(`[Movies4u] Resolving HLS playlist: ${s}`);let n=yield w(s,{headers:M(m({},y),{Referer:U})},5e3);if(!n.ok)return t;let l=yield n.text();if(!l.includes("#EXTM3U"))return t;if(l.includes("#EXT-X-STREAM-INF"))t.isMaster=!0;else if(l.includes("#EXT-X-MEDIA:TYPE=AUDIO")&&!l.includes("#EXT-X-STREAM-INF"))return console.log("[Movies4u] Found audio-only playlist, skipping resolution"),t;let i=l.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO,.*?NAME="([^"]+)"(?:.*?LANGUAGE="([^"]+)")?(?:.*?CHANNELS="([^"]+)")?(?:.*?URI="([^"]+)")?/g);for(let a of i){let r=a[1],e=a[2],c=a[3],u=a[4];if(u&&!u.startsWith("http")&&(u=s.substring(0,s.lastIndexOf("/")+1)+u),c){let h={1:"1.0",2:"2.0",6:"5.1",8:"7.1"}[c]||c;r+=` (${h})`}t.audios.some(f=>f.name===r)||t.audios.push({name:r,language:e||"unknown",uri:u})}let o=l.split(`
`);for(let a=0;a<o.length;a++){let r=o[a].trim();if(r.includes("#EXT-X-STREAM-INF")){let e="Unknown",c=r.match(/RESOLUTION=(\d+)x(\d+)/i);if(c){let f=parseInt(c[2]);f>=2160?e="4K":f>=1080?e="1080p":f>=720?e="720p":f>=480?e="480p":e=`${f}p`}if(e==="Unknown"){let f=r.match(/NAME="([^"]+)"/i);f&&(e=f[1])}let u=a+1;for(;u<o.length&&(o[u].trim().startsWith("#")||!o[u].trim());)u++;if(u<o.length){let f=o[u].trim();if(f){let h=f;h.startsWith("http")||(h=s.substring(0,s.lastIndexOf("/")+1)+h),t.variants.some(p=>p.url===h)||t.variants.push({url:h,quality:e})}}a=u}}return console.log(`[Movies4u] HLS Summary: ${t.variants.length} qualities, ${t.audios.length} audios found`),t}catch(n){return console.error(`[Movies4u] HLS resolution error: ${n.message}`),t}})}function X(s){return d(this,null,function*(){try{console.log(`[Movies4u] Extracting from m4uplay: ${s}`);let n=yield(yield w(s,{headers:M(m({},y),{Referer:$})},8e3)).text(),l=n.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s")),i=n;if(l)try{let e=l[1].trim().match(new RegExp(`^['"](.*)['"]\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*['"](.*?)['"]\\.split\\(['"]\\|['"]\\)`,"s"));e&&(i+=`
`+K(e[1],parseInt(e[2]),parseInt(e[3]),e[4].split("|")))}catch(r){}let o=null,a=[/https?:\/\/[^\s"']+\.(?:m3u8|txt)(?:\?[^\s"']*)?/,/["']?(\/(?:stream|3o)\/[^"'\s]+\.(?:m3u8|txt))[^\s"']*/,/["']file["']\s*:\s*["']([^"']+\.(?:m3u8|txt)[^"']*)["']/,/https?:\/\/[^\s"']*master\.txt[^\s"']*/,new RegExp(`["'](?:playlist|sources)["']\\s*:\\s*\\[\\s*\\{[^}]*["']file["']\\s*:\\s*["']([^"']+)["']`,"s"),/([\/a-zA-Z0-9_\-\.]+\/master\.(?:m3u8|txt))/];for(let r of a){let e=i.match(r);if(e){let c=e[1]||e[0];c.startsWith("/")&&(c=U+c),o=c;break}}if(o){if(o.includes("master.")){console.log("[Movies4u] Resolving master playlist...");let r=yield O(o);if(r.isMaster){let e=r.audios.map(h=>h.name),c=e.length>1?` [Multi Audio: ${e.join(", ")}]`:"";e.length>1&&console.log(`[Movies4u] Found multi-audio: ${e.join(", ")}`);let u=r.variants.map(h=>h.quality),f=u.includes("4K")?"4K":u.includes("1080p")?"1080p":u.includes("720p")?"720p":u.includes("480p")?"480p":u[0]||"Unknown";return[{url:r.masterUrl,audios:r.audios,audioInfo:c,quality:f,isMaster:!0}]}}return[{url:o,audios:[],audioInfo:"",quality:"Unknown"}]}return console.log("[Movies4u] Could not extract stream URL from m4uplay embed"),[]}catch(t){return console.error(`[Movies4u] M4UPlay extraction error: ${t.message}`),[]}})}function _(s){return d(this,null,function*(){try{console.log(`[Movies4u] Extracting watch links from: ${s}`);let n=yield(yield w(s,{headers:y},8e3)).text(),l=b.load(n),i=[];return l("a.btn.btn-zip").each((o,a)=>{let r=l(a).attr("href"),e=l(a).text().trim();r&&r.includes("m4uplay.com")&&i.push({url:r,quality:e.includes("1080p")?"1080p":e.includes("720p")?"720p":e.includes("480p")?"480p":e.includes("4K")||e.includes("2160p")?"4K":"Unknown",label:e})}),console.log(`[Movies4u] Found ${i.length} watch links`),i}catch(t){return console.error(`[Movies4u] Error extracting watch links: ${t.message}`),[]}})}function F(s,t){return d(this,null,function*(){let l=`${D}/${t==="movie"?"movie":"tv"}/${s}?api_key=${q}`,i=yield w(l,{},8e3);if(!i.ok)throw new Error(`TMDB error: ${i.status}`);let o=yield i.json();return{title:o.title||o.name,year:(o.release_date||o.first_air_date||"").split("-")[0]}})}function H(s){return d(this,null,function*(){try{let t=`${$}/?s=${encodeURIComponent(s)}`;console.log(`[Movies4u] Searching: ${t}`);let l=yield(yield w(t,{headers:y},8e3)).text(),i=b.load(l),o=[];return i("h3.entry-title a").each((a,r)=>{let e=i(r).text().trim(),c=i(r).attr("href");e&&c&&o.push({title:e,url:c})}),console.log(`[Movies4u] Found ${o.length} search results`),o}catch(t){return console.error(`[Movies4u] Search error: ${t.message}`),[]}})}function N(s,t="movie",n=null,l=null){return d(this,null,function*(){console.log(`[Movies4u] Processing ${t} ${s}`);try{let i;if(/^\d+$/.test(s))try{i=yield F(s,t)}catch(f){i={title:s,year:null}}else i={title:s,year:null};let a=yield H(i.title);if(a.length===0)return[];let r=z(i,a);if(!r)return[];console.log(`[Movies4u] Found match: ${r.title}`);let e=r.title.match(/\((20\d{2}|19\d{2})\)/);i.title.toLowerCase()===s.toLowerCase()&&(i.title=r.title.split("(")[0].trim(),e&&(i.year=e[1]));let c=yield _(r.url);if(c.length===0)return[];let u=[];for(let f of c){let h=yield X(f.url);for(let p of h){let v=M(m({},p),{quality:p.quality!=="Unknown"?p.quality:f.quality,text:f.label,isMaster:p.isMaster});u.push({name:"Movies4u",title:B(i,v),url:p.url,quality:v.quality,headers:{Referer:U,"User-Agent":y["User-Agent"]},provider:"Movies4u"})}}return console.log(`[Movies4u] Extracted ${u.length} streams`),u}catch(i){return console.error("[Movies4u] getStreams failed:",i.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:N}:global.getStreams={getStreams:N};
