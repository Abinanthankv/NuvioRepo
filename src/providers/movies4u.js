/**
 * movies4u - Built from src/movies4u/
 * Generated: 2026-01-12T02:17:21.971Z
 */
var k=Object.defineProperty,R=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var E=(i,e,r)=>e in i?k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,y=(i,e)=>{for(var r in e||(e={}))D.call(e,r)&&E(i,r,e[r]);if(A)for(var r of A(e))C.call(e,r)&&E(i,r,e[r]);return i},w=(i,e)=>R(i,b(e));var M=(i,e,r)=>new Promise((a,o)=>{var n=t=>{try{s(r.next(t))}catch(c){o(c)}},l=t=>{try{s(r.throw(t))}catch(c){o(c)}},s=t=>t.done?a(t.value):Promise.resolve(t.value).then(n,l);s((r=r.apply(i,e)).next())});var N=require("cheerio-without-node-native"),q="1b3113663c9004682ed61086cf967c44",W="https://api.themoviedb.org/3",U="https://movies4u.fans",m="https://m4uplay.com",v={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${U}/`};function $(a){return M(this,arguments,function*(i,e={},r=1e4){let o=new AbortController,n=setTimeout(()=>o.abort(),r);try{let l=yield fetch(i,w(y({},e),{signal:o.signal}));return clearTimeout(n),l}catch(l){throw clearTimeout(n),l.name==="AbortError"?new Error(`Request timeout after ${r}ms`):l}})}function B(i){return i?i.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()):""}function L(i){return i?i.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function I(i,e){let r=L(i),a=L(e);if(r===a)return 1;if(r.includes(a)||a.includes(r))return .9;let o=new Set(r.split(/\s+/).filter(t=>t.length>2)),n=new Set(a.split(/\s+/).filter(t=>t.length>2));if(o.size===0||n.size===0)return 0;let l=new Set([...o].filter(t=>n.has(t))),s=new Set([...o,...n]);return l.size/s.size}function F(i,e){if(!e||e.length===0)return null;let r=i.title.toLowerCase().replace(/[^a-z0-9]/g,""),a=i.year?parseInt(i.year):null,o=null,n=0;for(let l of e){let s=l.title.toLowerCase().replace(/[^a-z0-9]/g,""),t=I(i.title,l.title),c=s.includes(r)||r.includes(s),u=!a||l.title.includes(a.toString())||l.title.includes((a+1).toString())||l.title.includes((a-1).toString());c&&u&&(t+=.5),t>n&&(n=t,o=l)}return o&&n>.4?(console.log(`[Movies4u] Best title match: "${o.title}" (score: ${n.toFixed(2)})`),o):null}function z(i,e){let r=e.quality||"Unknown",a=i.title||"Unknown",o=e.isMaster||!1,n=i.year||"";if(!n||n==="N/A"){let d=(a+" "+(e.text||"")).match(/\b(19|20)\d{2}\b/);d&&(n=d[0])}let l=e.audioInfo||"",s="UNKNOWN",t=e.text?e.text.match(/(\d+(?:\.\d+)?\s*(?:GB|MB))/i):null;t&&(s=t[1].toUpperCase());let c="UNKNOWN",u=((e.text||"")+" "+(e.url||"")+" "+(e.label||"")).toLowerCase();u.includes("bluray")||u.includes("brrip")?c="BluRay":u.includes("web-dl")?c="WEB-DL":u.includes("webrip")?c="WEBRip":u.includes("hdrip")?c="HDRip":u.includes("dvdrip")?c="DVDRip":u.includes("bdrip")?c="BDRip":u.includes("hdtv")&&(c="HDTV");let f=n?` (${n})`:"",h="UNKNOWN";if(l){let d=l.match(/\[Multi Audio: (.*?)\]/i);d?h=d[1].toUpperCase():l.toLowerCase().includes("tamil")?h="TAMIL":h=l.toUpperCase()}let p=r;o&&(p=`${r} (Multi-Audio)`);let g=c&&c!=="UNKNOWN"?`\u{1F4FA}: ${c}
`:"",S=s&&s!=="UNKNOWN"?`\u{1F4BE}: ${s} | \u{1F69C}: movies4u
`:"";return`Movies4u (Instant) (${p})
${g}\u{1F4FC}: ${a}${f} - ${p}
${S}\u{1F310}: ${h}`}function P(i,e,r,a){for(;r--;)if(a[r]){let o=r.toString(e);i=i.replace(new RegExp("\\b"+o+"\\b","g"),a[r])}return i}function H(i){return M(this,null,function*(){let e={masterUrl:i,variants:[],audios:[],isMaster:!1};try{console.log(`[Movies4u] Resolving HLS playlist: ${i}`);let r=yield $(i,{headers:w(y({},v),{Referer:m})},5e3);if(!r.ok)return e;let a=yield r.text();if(!a.includes("#EXTM3U"))return e;if(a.includes("#EXT-X-STREAM-INF"))e.isMaster=!0;else if(a.includes("#EXT-X-MEDIA:TYPE=AUDIO")&&!a.includes("#EXT-X-STREAM-INF"))return console.log("[Movies4u] Found audio-only playlist, skipping resolution"),e;let o=a.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO.*?NAME="([^"]+)"(?:.*?CHANNELS="([^"]+)")?/g);for(let l of o){let s=l[1],t=l[2];if(t){let u={1:"1.0",2:"2.0",6:"5.1",8:"7.1"}[t]||t;s+=` (${u})`}e.audios.includes(s)||e.audios.push(s)}let n=a.split(`
`);for(let l=0;l<n.length;l++){let s=n[l].trim();if(s.includes("#EXT-X-STREAM-INF")){let t="Unknown",c=s.match(/RESOLUTION=(\d+)x(\d+)/i);if(c){let f=parseInt(c[2]);f>=2160?t="4K":f>=1080?t="1080p":f>=720?t="720p":f>=480?t="480p":t=`${f}p`}if(t==="Unknown"){let f=s.match(/NAME="([^"]+)"/i);f&&(t=f[1])}let u=l+1;for(;u<n.length&&(n[u].trim().startsWith("#")||!n[u].trim());)u++;if(u<n.length){let f=n[u].trim();if(f){let h=f;h.startsWith("http")||(h=i.substring(0,i.lastIndexOf("/")+1)+h),e.variants.some(p=>p.url===h)||e.variants.push({url:h,quality:t})}}l=u}}return console.log(`[Movies4u] HLS Summary: ${e.variants.length} qualities, ${e.audios.length} audios`),e}catch(r){return console.error(`[Movies4u] HLS resolution error: ${r.message}`),e}})}function X(i){return M(this,null,function*(){try{console.log(`[Movies4u] Extracting from m4uplay: ${i}`);let r=yield(yield $(i,{headers:w(y({},v),{Referer:U})},8e3)).text(),a=r.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s")),o=r;if(a){console.log("[Movies4u] Detected Packer obfuscation on m4uplay");try{let t=a[1].trim().match(new RegExp(`^['"](.*)['"]\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*['"](.*?)['"]\\.split\\(['"]\\|['"]\\)`,"s"));if(t){let c=t[1],u=parseInt(t[2]),f=parseInt(t[3]),h=t[4].split("|"),p=P(c,u,f,h);o+=`
`+p,console.log("[Movies4u] Successfully unpacked script")}}catch(s){console.error(`[Movies4u] Packer unpacking failed: ${s.message}`)}}let n=null,l=o.match(/https?:\/\/[^\s"']+\.(?:m3u8|txt)(?:\?[^\s"']*)?/);if(l&&(console.log(`[Movies4u] Found absolute HLS URL: ${l[0]}`),n=l[0]),!n){let s=o.match(/["']?(\/(?:stream|3o)\/[^"'\s]+\.(?:m3u8|txt))[^\s"']*/);if(s){let t=s[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found relative stream URL: ${t}`),n=t}}if(!n){let s=o.match(/["']file["']\s*:\s*["']([^"']+\.(?:m3u8|txt)[^"']*)["']/);if(s){let t=s[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found stream URL from JWPlayer file property: ${t}`),n=t}}if(!n){let s=o.match(/https?:\/\/[^\s"']*master\.txt[^\s"']*/);s&&(console.log(`[Movies4u] Found master.txt HLS URL: ${s[0]}`),n=s[0])}if(!n){let s=o.match(new RegExp(`["'](?:playlist|sources)["']\\s*:\\s*\\[\\s*\\{[^}]*["']file["']\\s*:\\s*["']([^"']+)["']`,"s"));if(s){let t=s[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found stream URL from playlist/sources: ${t}`),n=t}}if(!n){let s=o.match(/([\/a-zA-Z0-9_\-\.]+\/master\.(?:m3u8|txt))/);if(s){let t=s[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found master reference: ${t}`),n=t}}if(n){if(n.includes("master.")){console.log("[Movies4u] Resolving master playlist...");let s=yield H(n);if(s.isMaster){let t="";s.audios.length>1&&(t=` [Multi Audio: ${s.audios.join(", ")}]`,console.log(`[Movies4u] Found multi-audio: ${s.audios.join(", ")}`));let c=[];return s.audios.length>1&&c.push({url:s.masterUrl,audios:s.audios,audioInfo:t,quality:"AUTO",isMaster:!0}),s.variants.forEach(u=>{c.push({url:u.url,audios:s.audios,audioInfo:t,quality:u.quality,isMaster:!1})}),c}}return[{url:n,audios:[],audioInfo:"",quality:"Unknown"}]}return console.log("[Movies4u] Could not extract stream URL from m4uplay embed"),[]}catch(e){return console.error(`[Movies4u] M4UPlay extraction error: ${e.message}`),[]}})}function O(i){return M(this,null,function*(){try{console.log(`[Movies4u] Extracting watch links from: ${i}`);let r=yield(yield $(i,{headers:v},8e3)).text(),a=N.load(r),o=[];return a("a.btn.btn-zip").each((n,l)=>{let s=a(l).attr("href"),t=a(l).text().trim();s&&s.includes("m4uplay.com")&&o.push({url:s,quality:t.includes("1080p")?"1080p":t.includes("720p")?"720p":t.includes("480p")?"480p":t.includes("4K")||t.includes("2160p")?"4K":t.includes("iMAX")?"iMAX":"Unknown",label:t})}),console.log(`[Movies4u] Found ${o.length} watch links`),o}catch(e){return console.error(`[Movies4u] Error extracting watch links: ${e.message}`),[]}})}function K(i,e){return M(this,null,function*(){let a=`${W}/${e==="movie"?"movie":"tv"}/${i}?api_key=${q}`;try{let o=yield $(a,{},8e3);if(!o.ok)throw new Error(`TMDB error: ${o.status}`);let n=yield o.json();if(!n.title&&!n.name)throw new Error("TMDB returned no title");let l={title:n.title||n.name,year:(n.release_date||n.first_air_date||"").split("-")[0]};return console.log(`[Movies4u] TMDB Info: "${l.title}" (${l.year||"N/A"})`),l}catch(o){throw console.error("[Movies4u] Error fetching TMDB metadata:",o.message),o}})}function _(i){return M(this,null,function*(){try{let e=`${U}/?s=${encodeURIComponent(i)}`;console.log(`[Movies4u] Searching: ${e}`);let a=yield(yield $(e,{headers:v},8e3)).text(),o=N.load(a),n=[];return o("h3.entry-title a").each((l,s)=>{let t=o(s).text().trim(),c=o(s).attr("href");t&&c&&n.push({title:t,url:c})}),console.log(`[Movies4u] Found ${n.length} search results`),n}catch(e){return console.error(`[Movies4u] Search error: ${e.message}`),[]}})}function x(i,e="movie",r=null,a=null){return M(this,null,function*(){console.log(`[Movies4u] Processing ${e} ${i}`);try{let o;if(/^\d+$/.test(i))try{o=yield K(i,e)}catch(p){console.log(`[Movies4u] TMDB fetch failed for ${i}, using as search query`),o={title:i,year:null}}else console.log(`[Movies4u] Using "${i}" as search query directly`),o={title:i,year:null};let l=yield _(o.title);if(l.length===0)return console.warn("[Movies4u] No search results found"),[];let s=F(o,l);if(!s)return console.warn("[Movies4u] No matching title found in search results"),[];console.log(`[Movies4u] Found match: ${s.title}`);let c=s.title.split("(")[0].trim(),u=s.title.match(/\((20\d{2}|19\d{2})\)/);o.title.toLowerCase()===i.toLowerCase()||o.title===o.title.toLowerCase()?(o.title=c,u&&(o.year=u[1])):!o.year&&u&&(o.year=u[1]),o.title===o.title.toLowerCase()&&(o.title=B(o.title));let f=yield O(s.url);if(f.length===0)return console.warn("[Movies4u] No watch links found on movie page"),[];let h=[];for(let p of f){let g=yield X(p.url);if(g&&g.length>0){let S=s.title.split("(")[0].trim();for(let d of g){let T=w(y({},d),{quality:d.quality!=="Unknown"?d.quality:p.quality,text:p.label,isMaster:d.isMaster});h.push({name:"Movies4u",title:z(o,T),url:d.url,quality:T.quality,headers:{Referer:m,"User-Agent":v["User-Agent"]},provider:"Movies4u"})}}}return console.log(`[Movies4u] Extracted ${h.length} streams`),h}catch(o){return console.error("[Movies4u] getStreams failed:",o.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:x}:global.getStreams={getStreams:x};
