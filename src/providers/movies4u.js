/**
 * movies4u - Built from src/movies4u/
 * Generated: 2026-01-10T16:35:29.094Z
 */
var L=Object.defineProperty,U=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var y=(t,r,i)=>r in t?L(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,M=(t,r)=>{for(var i in r||(r={}))E.call(r,i)&&y(t,i,r[i]);if(w)for(var i of w(r))R.call(r,i)&&y(t,i,r[i]);return t},d=(t,r)=>U(t,A(r));var u=(t,r,i)=>new Promise((l,s)=>{var o=e=>{try{n(i.next(e))}catch(c){s(c)}},a=e=>{try{n(i.throw(e))}catch(c){s(c)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,a);n((i=i.apply(t,r)).next())});var S=require("cheerio-without-node-native"),b="1b3113663c9004682ed61086cf967c44",F="https://api.themoviedb.org/3",v="https://movies4u.fans",f="https://m4uplay.com",g={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${v}/`};function m(l){return u(this,arguments,function*(t,r={},i=1e4){let s=new AbortController,o=setTimeout(()=>s.abort(),i);try{let a=yield fetch(t,d(M({},r),{signal:s.signal}));return clearTimeout(o),a}catch(a){throw clearTimeout(o),a.name==="AbortError"?new Error(`Request timeout after ${i}ms`):a}})}function $(t){return t?t.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function z(t,r){let i=$(t),l=$(r);if(i===l)return 1;if(i.includes(l)||l.includes(i))return .9;let s=new Set(i.split(/\s+/).filter(e=>e.length>2)),o=new Set(l.split(/\s+/).filter(e=>e.length>2));if(s.size===0||o.size===0)return 0;let a=new Set([...s].filter(e=>o.has(e))),n=new Set([...s,...o]);return a.size/n.size}function B(t,r){if(!r||r.length===0)return null;let i=t.title.toLowerCase().replace(/[^a-z0-9]/g,""),l=t.year?parseInt(t.year):null,s=null,o=0;for(let a of r){let n=a.title.toLowerCase().replace(/[^a-z0-9]/g,""),e=z(t.title,a.title),c=n.includes(i)||i.includes(n),h=!l||a.title.includes(l.toString())||a.title.includes((l+1).toString())||a.title.includes((l-1).toString());c&&h&&(e+=.5),e>o&&(o=e,s=a)}return s&&o>.4?(console.log(`[Movies4u] Best title match: "${s.title}" (score: ${o.toFixed(2)})`),s):null}function W(t,r,i,l){for(;i--;)if(l[i]){let s=i.toString(r);t=t.replace(new RegExp("\\b"+s+"\\b","g"),l[i])}return t}function D(t){return u(this,null,function*(){try{let r=yield m(t,{headers:d(M({},g),{Referer:f})},5e3);if(!r.ok)return t;let i=yield r.text();if(!i.includes("#EXTM3U"))return t;let l=i.split(`
`);for(let s=0;s<l.length;s++)if(l[s].includes("#EXT-X-STREAM-INF")&&s+1<l.length){let o=l[s+1].trim();if(o&&!o.startsWith("#"))return o.startsWith("http")?o:t.substring(0,t.lastIndexOf("/")+1)+o}return t}catch(r){return console.error(`[Movies4u] HLS resolution error: ${r.message}`),t}})}function _(t){return u(this,null,function*(){try{console.log(`[Movies4u] Extracting from m4uplay: ${t}`);let i=yield(yield m(t,{headers:d(M({},g),{Referer:v})},8e3)).text(),l=i.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s")),s=i;if(l){console.log("[Movies4u] Detected Packer obfuscation on m4uplay");try{let e=l[1].trim().match(new RegExp(`^['"](.*)['"]\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*['"](.*?)['"]\\.split\\(['"]\\|['"]\\)`,"s"));if(e){let c=e[1],h=parseInt(e[2]),p=parseInt(e[3]),k=e[4].split("|"),T=W(c,h,p,k);s+=`
`+T,console.log("[Movies4u] Successfully unpacked script")}}catch(n){console.error(`[Movies4u] Packer unpacking failed: ${n.message}`)}}let o=null,a=s.match(/https?:\/\/[^\s"']+\.(?:m3u8|txt)(?:\?[^\s"']*)?/);if(a&&(console.log(`[Movies4u] Found absolute HLS URL: ${a[0]}`),o=a[0]),!o){let n=s.match(/["']?(\/(?:stream|3o)\/[^"'\s]+\.(?:m3u8|txt))[^\s"']*/);if(n){let e=n[1];e.startsWith("/")&&(e=f+e),console.log(`[Movies4u] Found relative stream URL: ${e}`),o=e}}if(!o){let n=s.match(/["']file["']\s*:\s*["']([^"']+\.(?:m3u8|txt)[^"']*)["']/);if(n){let e=n[1];e.startsWith("/")&&(e=f+e),console.log(`[Movies4u] Found stream URL from JWPlayer file property: ${e}`),o=e}}if(!o){let n=s.match(/https?:\/\/[^\s"']*master\.txt[^\s"']*/);n&&(console.log(`[Movies4u] Found master.txt HLS URL: ${n[0]}`),o=n[0])}if(!o){let n=s.match(new RegExp(`["'](?:playlist|sources)["']\\s*:\\s*\\[\\s*\\{[^}]*["']file["']\\s*:\\s*["']([^"']+)["']`,"s"));if(n){let e=n[1];e.startsWith("/")&&(e=f+e),console.log(`[Movies4u] Found stream URL from playlist/sources: ${e}`),o=e}}if(!o){let n=s.match(/([\/a-zA-Z0-9_\-\.]+\/master\.(?:m3u8|txt))/);if(n){let e=n[1];e.startsWith("/")&&(e=f+e),console.log(`[Movies4u] Found master reference: ${e}`),o=e}}if(o){if(o.includes("master.")){console.log("[Movies4u] Resolving master playlist...");let n=yield D(o);if(n!==o)return console.log(`[Movies4u] Resolved to variant: ${n}`),n}return o}return console.log("[Movies4u] Could not extract stream URL from m4uplay embed"),null}catch(r){return console.error(`[Movies4u] M4UPlay extraction error: ${r.message}`),null}})}function P(t){return u(this,null,function*(){try{console.log(`[Movies4u] Extracting watch links from: ${t}`);let i=yield(yield m(t,{headers:g},8e3)).text(),l=S.load(i),s=[];return l("a.btn.btn-zip").each((o,a)=>{let n=l(a).attr("href"),e=l(a).text().trim();n&&n.includes("m4uplay.com")&&s.push({url:n,quality:e.includes("1080p")?"1080p":e.includes("720p")?"720p":e.includes("480p")?"480p":e.includes("4K")||e.includes("2160p")?"4K":e.includes("iMAX")?"iMAX":"Unknown",label:e})}),console.log(`[Movies4u] Found ${s.length} watch links`),s}catch(r){return console.error(`[Movies4u] Error extracting watch links: ${r.message}`),[]}})}function N(t,r){return u(this,null,function*(){let l=`${F}/${r==="movie"?"movie":"tv"}/${t}?api_key=${b}`;try{let s=yield m(l,{},8e3);if(!s.ok)throw new Error(`TMDB error: ${s.status}`);let o=yield s.json();if(!o.title&&!o.name)throw new Error("TMDB returned no title");let a={title:o.title||o.name,year:(o.release_date||o.first_air_date||"").split("-")[0]};return console.log(`[Movies4u] TMDB Info: "${a.title}" (${a.year||"N/A"})`),a}catch(s){throw console.error("[Movies4u] Error fetching TMDB metadata:",s.message),s}})}function H(t){return u(this,null,function*(){try{let r=`${v}/?s=${encodeURIComponent(t)}`;console.log(`[Movies4u] Searching: ${r}`);let l=yield(yield m(r,{headers:g},8e3)).text(),s=S.load(l),o=[];return s("h3.entry-title a").each((a,n)=>{let e=s(n).text().trim(),c=s(n).attr("href");e&&c&&o.push({title:e,url:c})}),console.log(`[Movies4u] Found ${o.length} search results`),o}catch(r){return console.error(`[Movies4u] Search error: ${r.message}`),[]}})}function x(t,r="movie",i=null,l=null){return u(this,null,function*(){console.log(`[Movies4u] Processing ${r} ${t}`);try{let s;if(/^\d+$/.test(t))try{s=yield N(t,r)}catch(h){console.log(`[Movies4u] TMDB fetch failed for ${t}, using as search query`),s={title:t,year:null}}else console.log(`[Movies4u] Using "${t}" as search query directly`),s={title:t,year:null};let a=yield H(s.title);if(a.length===0)return console.warn("[Movies4u] No search results found"),[];let n=B(s,a);if(!n)return console.warn("[Movies4u] No matching title found in search results"),[];console.log(`[Movies4u] Found match: ${n.title}`);let e=yield P(n.url);if(e.length===0)return console.warn("[Movies4u] No watch links found on movie page"),[];let c=[];for(let h of e){let p=yield _(h.url);p&&c.push({name:"Movies4u",title:n.title.split("(")[0].trim(),url:p,quality:h.quality,headers:{Referer:f,"User-Agent":g["User-Agent"]},provider:"Movies4u"})}return console.log(`[Movies4u] Extracted ${c.length} streams`),c}catch(s){return console.error("[Movies4u] getStreams failed:",s.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:x}:global.getStreams={getStreams:x};
