/**
 * movies4u - Built from src/movies4u/
 * Generated: 2026-01-10T16:45:48.875Z
 */
var A=Object.defineProperty,E=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var x=(s,o,i)=>o in s?A(s,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[o]=i,M=(s,o)=>{for(var i in o||(o={}))U.call(o,i)&&x(s,i,o[i]);if($)for(var i of $(o))L.call(o,i)&&x(s,i,o[i]);return s},v=(s,o)=>E(s,R(o));var u=(s,o,i)=>new Promise((l,r)=>{var n=t=>{try{e(i.next(t))}catch(c){r(c)}},a=t=>{try{e(i.throw(t))}catch(c){r(c)}},e=t=>t.done?l(t.value):Promise.resolve(t.value).then(n,a);e((i=i.apply(s,o)).next())});var k=require("cheerio-without-node-native"),b="1b3113663c9004682ed61086cf967c44",F="https://api.themoviedb.org/3",w="https://movies4u.fans",m="https://m4uplay.com",g={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${w}/`};function d(l){return u(this,arguments,function*(s,o={},i=1e4){let r=new AbortController,n=setTimeout(()=>r.abort(),i);try{let a=yield fetch(s,v(M({},o),{signal:r.signal}));return clearTimeout(n),a}catch(a){throw clearTimeout(n),a.name==="AbortError"?new Error(`Request timeout after ${i}ms`):a}})}function S(s){return s?s.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function D(s,o){let i=S(s),l=S(o);if(i===l)return 1;if(i.includes(l)||l.includes(i))return .9;let r=new Set(i.split(/\s+/).filter(t=>t.length>2)),n=new Set(l.split(/\s+/).filter(t=>t.length>2));if(r.size===0||n.size===0)return 0;let a=new Set([...r].filter(t=>n.has(t))),e=new Set([...r,...n]);return a.size/e.size}function z(s,o){if(!o||o.length===0)return null;let i=s.title.toLowerCase().replace(/[^a-z0-9]/g,""),l=s.year?parseInt(s.year):null,r=null,n=0;for(let a of o){let e=a.title.toLowerCase().replace(/[^a-z0-9]/g,""),t=D(s.title,a.title),c=e.includes(i)||i.includes(e),f=!l||a.title.includes(l.toString())||a.title.includes((l+1).toString())||a.title.includes((l-1).toString());c&&f&&(t+=.5),t>n&&(n=t,r=a)}return r&&n>.4?(console.log(`[Movies4u] Best title match: "${r.title}" (score: ${n.toFixed(2)})`),r):null}function B(s,o,i,l){for(;i--;)if(l[i]){let r=i.toString(o);s=s.replace(new RegExp("\\b"+r+"\\b","g"),l[i])}return s}function I(s){return u(this,null,function*(){let o={url:s,audios:[],isMaster:!1};try{let i=yield d(s,{headers:v(M({},g),{Referer:m})},5e3);if(!i.ok)return o;let l=yield i.text();if(!l.includes("#EXTM3U"))return o;o.isMaster=!0;let r=l.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO.*?NAME="([^"]+)"/g);for(let a of r)o.audios.push(a[1]);let n=l.split(`
`);for(let a=0;a<n.length;a++)if(n[a].includes("#EXT-X-STREAM-INF")&&a+1<n.length){let e=n[a+1].trim();if(e&&!e.startsWith("#")){if(e.startsWith("http"))o.url=e;else{let t=s.substring(0,s.lastIndexOf("/")+1);o.url=t+e}break}}return o}catch(i){return console.error(`[Movies4u] HLS resolution error: ${i.message}`),o}})}function W(s){return u(this,null,function*(){try{console.log(`[Movies4u] Extracting from m4uplay: ${s}`);let i=yield(yield d(s,{headers:v(M({},g),{Referer:w})},8e3)).text(),l=i.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\s*\\((.*)\\)\\s*\\)","s")),r=i;if(l){console.log("[Movies4u] Detected Packer obfuscation on m4uplay");try{let t=l[1].trim().match(new RegExp(`^['"](.*)['"]\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*['"](.*?)['"]\\.split\\(['"]\\|['"]\\)`,"s"));if(t){let c=t[1],f=parseInt(t[2]),h=parseInt(t[3]),p=t[4].split("|"),y=B(c,f,h,p);r+=`
`+y,console.log("[Movies4u] Successfully unpacked script")}}catch(e){console.error(`[Movies4u] Packer unpacking failed: ${e.message}`)}}let n=null,a=r.match(/https?:\/\/[^\s"']+\.(?:m3u8|txt)(?:\?[^\s"']*)?/);if(a&&(console.log(`[Movies4u] Found absolute HLS URL: ${a[0]}`),n=a[0]),!n){let e=r.match(/["']?(\/(?:stream|3o)\/[^"'\s]+\.(?:m3u8|txt))[^\s"']*/);if(e){let t=e[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found relative stream URL: ${t}`),n=t}}if(!n){let e=r.match(/["']file["']\s*:\s*["']([^"']+\.(?:m3u8|txt)[^"']*)["']/);if(e){let t=e[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found stream URL from JWPlayer file property: ${t}`),n=t}}if(!n){let e=r.match(/https?:\/\/[^\s"']*master\.txt[^\s"']*/);e&&(console.log(`[Movies4u] Found master.txt HLS URL: ${e[0]}`),n=e[0])}if(!n){let e=r.match(new RegExp(`["'](?:playlist|sources)["']\\s*:\\s*\\[\\s*\\{[^}]*["']file["']\\s*:\\s*["']([^"']+)["']`,"s"));if(e){let t=e[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found stream URL from playlist/sources: ${t}`),n=t}}if(!n){let e=r.match(/([\/a-zA-Z0-9_\-\.]+\/master\.(?:m3u8|txt))/);if(e){let t=e[1];t.startsWith("/")&&(t=m+t),console.log(`[Movies4u] Found master reference: ${t}`),n=t}}if(n){if(n.includes("master.")){console.log("[Movies4u] Resolving master playlist...");let e=yield I(n);if(e.isMaster){let t="";if(e.audios.length>1)return t=` [Multi Audio: ${e.audios.join(", ")}]`,console.log(`[Movies4u] Found multi-audio: ${e.audios.join(", ")}`),{url:n,audios:e.audios,audioInfo:t};if(e.url!==n)return console.log(`[Movies4u] Resolved to variant: ${e.url}`),{url:e.url,audios:e.audios,audioInfo:""}}}return{url:n,audios:[],audioInfo:""}}return console.log("[Movies4u] Could not extract stream URL from m4uplay embed"),null}catch(o){return console.error(`[Movies4u] M4UPlay extraction error: ${o.message}`),null}})}function P(s){return u(this,null,function*(){try{console.log(`[Movies4u] Extracting watch links from: ${s}`);let i=yield(yield d(s,{headers:g},8e3)).text(),l=k.load(i),r=[];return l("a.btn.btn-zip").each((n,a)=>{let e=l(a).attr("href"),t=l(a).text().trim();e&&e.includes("m4uplay.com")&&r.push({url:e,quality:t.includes("1080p")?"1080p":t.includes("720p")?"720p":t.includes("480p")?"480p":t.includes("4K")||t.includes("2160p")?"4K":t.includes("iMAX")?"iMAX":"Unknown",label:t})}),console.log(`[Movies4u] Found ${r.length} watch links`),r}catch(o){return console.error(`[Movies4u] Error extracting watch links: ${o.message}`),[]}})}function _(s,o){return u(this,null,function*(){let l=`${F}/${o==="movie"?"movie":"tv"}/${s}?api_key=${b}`;try{let r=yield d(l,{},8e3);if(!r.ok)throw new Error(`TMDB error: ${r.status}`);let n=yield r.json();if(!n.title&&!n.name)throw new Error("TMDB returned no title");let a={title:n.title||n.name,year:(n.release_date||n.first_air_date||"").split("-")[0]};return console.log(`[Movies4u] TMDB Info: "${a.title}" (${a.year||"N/A"})`),a}catch(r){throw console.error("[Movies4u] Error fetching TMDB metadata:",r.message),r}})}function N(s){return u(this,null,function*(){try{let o=`${w}/?s=${encodeURIComponent(s)}`;console.log(`[Movies4u] Searching: ${o}`);let l=yield(yield d(o,{headers:g},8e3)).text(),r=k.load(l),n=[];return r("h3.entry-title a").each((a,e)=>{let t=r(e).text().trim(),c=r(e).attr("href");t&&c&&n.push({title:t,url:c})}),console.log(`[Movies4u] Found ${n.length} search results`),n}catch(o){return console.error(`[Movies4u] Search error: ${o.message}`),[]}})}function T(s,o="movie",i=null,l=null){return u(this,null,function*(){console.log(`[Movies4u] Processing ${o} ${s}`);try{let r;if(/^\d+$/.test(s))try{r=yield _(s,o)}catch(f){console.log(`[Movies4u] TMDB fetch failed for ${s}, using as search query`),r={title:s,year:null}}else console.log(`[Movies4u] Using "${s}" as search query directly`),r={title:s,year:null};let a=yield N(r.title);if(a.length===0)return console.warn("[Movies4u] No search results found"),[];let e=z(r,a);if(!e)return console.warn("[Movies4u] No matching title found in search results"),[];console.log(`[Movies4u] Found match: ${e.title}`);let t=yield P(e.url);if(t.length===0)return console.warn("[Movies4u] No watch links found on movie page"),[];let c=[];for(let f of t){let h=yield W(f.url);if(h&&h.url){let p=e.title.split("(")[0].trim(),y=h.audioInfo?`${p}${h.audioInfo}`:p;c.push({name:"Movies4u",title:y,url:h.url,quality:f.quality,headers:{Referer:m,"User-Agent":g["User-Agent"]},provider:"Movies4u"})}}return console.log(`[Movies4u] Extracted ${c.length} streams`),c}catch(r){return console.error("[Movies4u] getStreams failed:",r.message),[]}})}typeof module!="undefined"&&module.exports?module.exports={getStreams:T}:global.getStreams={getStreams:T};
