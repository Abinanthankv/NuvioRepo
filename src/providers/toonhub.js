/**
 * toonhub - Built from src/toonhub/
 * Generated: 2026-01-14T08:56:43.899Z
 */
var V=Object.defineProperty,Y=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var q=(o,e,t)=>e in o?V(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,v=(o,e)=>{for(var t in e||(e={}))ee.call(e,t)&&q(o,t,e[t]);if(_)for(var t of _(e))te.call(e,t)&&q(o,t,e[t]);return o},R=(o,e)=>Y(o,N(e));var w=(o,e,t)=>new Promise((s,n)=>{var r=i=>{try{d(t.next(i))}catch(f){n(f)}},u=i=>{try{d(t.throw(i))}catch(f){n(f)}},d=i=>i.done?s(i.value):Promise.resolve(i.value).then(r,u);d((t=t.apply(o,e)).next())});var F=require("cheerio-without-node-native"),G="1b3113663c9004682ed61086cf967c44",J="https://api.themoviedb.org/3",L="https://toonhub4u.co",T={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${L}/`};function $(s){return w(this,arguments,function*(o,e={},t=1e4){let n=new AbortController,r=setTimeout(()=>n.abort(),t);try{let u=yield fetch(o,R(v({},e),{signal:n.signal,redirect:"follow"}));return clearTimeout(r),u}catch(u){throw clearTimeout(r),u.name==="AbortError"?new Error(`Request timeout after ${t}ms`):u}})}function oe(t){return w(this,arguments,function*(o,e={}){try{let s=yield $(o,{method:"GET",headers:R(v({},e),{Range:"bytes=0-0"})},5e3);return s.ok||s.status===206}catch(s){return!1}})}function z(o){return o?o.toLowerCase().replace(/[-:]/g," ").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function ne(o){return o?o.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function j(o,e){let t=z(o),s=z(e);if(t===s)return 1;if(t.length>5&&s.length>5&&(s.includes(t)||t.includes(s)))return .9;let n=new Set(t.split(/\s+/).filter(i=>i.length>2)),r=new Set(s.split(/\s+/).filter(i=>i.length>2));if(n.size===0||r.size===0)return 0;let u=new Set([...n].filter(i=>r.has(i))),d=new Set([...n,...r]);return u.size/d.size}function se(o){if(!o)return null;let e=o.match(/S(\d+)E(\d+)/i);return e?{season:parseInt(e[1]),episode:parseInt(e[2])}:null}function re(o){if(!o)return null;let e={languages:[],hasSubtitles:!1,audioType:null};if(/ESub|Subtitle|Sub/i.test(o)&&(e.hasSubtitles=!0),/Multi\s*Audio/i.test(o))e.audioType="Multi Audio",e.languages=["Hindi","English","Japanese"];else if(/Dual\s*Audio/i.test(o)){e.audioType="Dual Audio";let t=o.match(/\b(Hindi|Tamil|Telugu|English|Eng|Japanese|Korean|Chinese)\b/gi);t&&(e.languages=[...new Set(t.map(s=>s.toLowerCase()==="eng"?"English":s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()))])}else{let t=o.match(/\b(Hindi|Tamil|Telugu|English|Eng|Japanese|Korean|Chinese)\b/gi);t&&(e.languages=[...new Set(t.map(s=>s.toLowerCase()==="eng"?"English":s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()))])}return e}function ie(o,e,t,s,n=""){let r=e.quality||"Unknown",u=ne(o.title||"Unknown"),d=o.year?` (${o.year})`:"",i="";t&&t.season&&t.episode?i=` - S${String(t.season).padStart(2,"0")}E${String(t.episode).padStart(2,"0")}`:e.label&&(i=` - ${e.label}`);let f="\u{1F310}: HINDI/ENGLISH";if(s&&s.languages.length>0){let p=s.languages.join("/"),m=s.hasSubtitles?" + ESub":"";f=`\u{1F3A7}: ${p}${m}`}let h=n?` | ${n}`:"";return`ToonHub (${r})
\u{1F4F9}: ${u}${d}${i}
${f}${h}`}function ae(o){if(!o)return"";let e=[];/x265|hevc|h265|10?bit/i.test(o)?e.push("H.265"):/x264|h264/i.test(o)&&e.push("H.264"),/aac/i.test(o)&&e.push("AAC");let t=o.match(/\.(mkv|mp4|m3u8|avi|webm)(?:\?|$)/i);return t&&e.push(t[1].toUpperCase()),e.join("/")}function ce(o){if(!o)return"";let e=o.split(",").map(s=>s.trim().toLowerCase()),t=[];for(let s of e)s.startsWith("avc")?t.push("H.264"):s.startsWith("hev")||s.startsWith("hvc")?t.push("H.265"):s.startsWith("mp4a")&&t.push("AAC");return t.join("/")}function le(o){return w(this,null,function*(){try{let e=yield $(o,{headers:T},5e3);if(!e.ok)return"";let s=(yield e.text()).match(/CODECS="([^"]+)"/i);return s?ce(s[1]):"M3U8"}catch(e){return"M3U8"}})}function ue(o,e){return w(this,null,function*(){let s=`${J}/${e==="movie"?"movie":"tv"}/${o}?api_key=${G}`;try{let n=yield $(s,{},8e3);if(!n.ok)throw new Error(`HTTP ${n.status}`);let r=yield n.json();return{title:r.title||r.name,year:(r.release_date||r.first_air_date||"").split("-")[0]}}catch(n){throw console.warn("[ToonHub] TMDB details fetch failed:",n.message),n}})}function he(o,e){return w(this,null,function*(){let s=`${J}/search/${e==="movie"?"movie":"tv"}?api_key=${G}&query=${encodeURIComponent(o)}`;try{let n=yield $(s,{},8e3);if(!n.ok)return null;let r=yield n.json();if(r.results&&r.results.length>0){let u=["vigilantes","vigilante","gaiden","ova","special","recap"],i=r.results.find(f=>{let h=(f.title||f.name||"").toLowerCase();return!u.some(p=>h.includes(p))})||r.results[0];return{title:i.title||i.name,year:(i.release_date||i.first_air_date||"").split("-")[0]}}}catch(n){console.warn("[ToonHub] TMDB search failed:",n.message)}return null})}function fe(o){return w(this,null,function*(){console.log(`[ToonHub] Searching for: "${o}"`);let e=[o.split(":")[0].trim(),o.split(" ")[0],o];for(let t of e)if(!(!t||t.length<3))try{let s=`${L}/?s=${encodeURIComponent(t)}`,n=yield $(s,{headers:T},8e3);if(!n.ok)continue;let r=yield n.text(),u=F.load(r),d=[];if(u("li.post-item").each((i,f)=>{let h=u(f).find("h2.post-title a"),p=h.text().trim().split("[")[0].trim(),m=h.attr("href");m&&d.push({title:p,href:m})}),d.length>0)return console.log(`[ToonHub] Found ${d.length} results with query: "${t}"`),d}catch(s){console.warn(`[ToonHub] Search error for "${t}":`,s.message)}return console.log("[ToonHub] No results found for any search query"),[]})}function de(o){return w(this,null,function*(){console.log(`[ToonHub] Searching ToonStream for: "${o}"`);try{let e=`https://toonstream.one/home/?s=${encodeURIComponent(o)}`,t=yield $(e,{headers:T},1e4);if(!t.ok)return[];let s=yield t.text(),n=F.load(s),r=[];return n("article.post").each((u,d)=>{let i=n(d).find("a.lnk-blk"),f=n(d).find(".entry-title").text().trim(),h=i.attr("href");if(h){let p="unknown";h.includes("/series/")||h.includes("/anime/")?p="series":h.includes("/movies/")||h.includes("/movie/")?p="movie":h.includes("/episode/")&&(p="episode"),r.push({title:f,href:h,type:p})}}),console.log(`[ToonHub] Found ${r.length} results on ToonStream`),r}catch(e){return console.error("[ToonHub] ToonStream search error:",e.message),[]}})}function pe(o,e){return w(this,null,function*(){console.log(`[ToonHub] Getting episode ${e} from ToonStream: ${o}`);try{let t=yield $(o,{headers:T},1e4);if(!t.ok)return null;let s=yield t.text(),n=F.load(s),r=null,u=e.toString().padStart(2,"0"),d=new RegExp(`(?:Episode|Ep)\\s*(${e}|${u})\\b`,"i");return n("article.post.episodes").each((i,f)=>{let h=n(f).text();if(d.test(h))return r=n(f).find("a.lnk-blk").attr("href"),!1}),r||n('a[href*="/episode/"]').each((i,f)=>{let h=n(f).attr("href");if(h.includes(`-${e}/`)||h.includes(`-ep-${e}/`)||h.endsWith(`-${e}`)||h.endsWith(`-ep-${e}`))return r=h,!1}),r}catch(t){return console.error("[ToonHub] ToonStream episode fetch error:",t.message),null}})}function me(o){return w(this,null,function*(){console.log(`[ToonHub] Extracting direct stream from: ${o}`);try{let e=o.replace(/&#038;/g,"&");if(e.includes("redirect/main")&&e.includes(".php?url=")){let t=e.split("url=")[1].split("&")[0];try{e=Buffer.from(t,"base64").toString("utf8"),console.log(`[ToonHub] Decoded redirect URL: ${e}`)}catch(s){console.log("[ToonHub] Base64 decode failed for URL")}}if(e.includes("toonstream.")&&e.includes("/episode/")){console.log(`[ToonHub] Resolving ToonStream episode page: ${e}`);let n=(yield(yield $(e,{headers:T},1e4)).text()).match(/https?:\/\/toonstream\.[^/]+\/home\/\?trembed=[^"']+/i);n&&(e=n[0].replace(/&#038;/g,"&"),console.log(`[ToonHub] Found Embed URL: ${e}`))}if(e.includes("toonstream.")&&e.includes("/home/")){console.log(`[ToonHub] Resolving ToonStream embed: ${e}`);let n=(yield(yield $(e,{headers:T},1e4)).text()).match(/<iframe[^>]+src="([^"]+)"/i);n&&n[1]&&(e=n[1].replace(/&#038;/g,"&"),console.log(`[ToonHub] Found internal host: ${e}`))}if(e.includes("short.icu")||e.includes("as-cdn21.top")||e.includes("abyss.to")){console.log(`[ToonHub] Extracting via Host API: ${e}`);let t=e.match(/\/(?:video|v)\/([a-zA-Z0-9]+)/)||e.match(/[\?&]v=([a-zA-Z0-9]+)/);if(t&&t[1]){let i=t[1],h=`${e.split("/video/")[0].split("/v/")[0]}/player/index.php?data=${i}&do=getVideo`;console.log(`[ToonHub] Calling Host API for ID: ${i}`);try{let p=yield $(h,{method:"POST",headers:R(v({},T),{Referer:"https://toonstream.one/","X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}),body:`hash=${i}&r=https://toonstream.one/`},1e4);if(p.ok){let m=yield p.json();if(m&&m.videoSource)return console.log(`[ToonHub] Successfully retrieved signed stream: ${m.videoSource}`),m.videoSource}}catch(p){console.warn(`[ToonHub] Host API call failed: ${p.message}`)}}let s=R(v({},T),{Referer:"https://toonstream.one/"}),r=yield(yield $(e,{headers:s},1e4)).text(),u=r.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(u)return u[0].replace(/&#038;/g,"&");let d=r.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);if(d)return d[0].replace(/&#038;/g,"&")}if(e.includes("gdmirrorbot.nl")){console.log(`[ToonHub] Extracting from gdmirrorbot.nl: ${e}`);try{let n=(yield(yield $(e,{headers:R(v({},T),{Referer:"https://toonhub4u.co/"})},1e4)).text()).match(/const\s+fileurl\s*=\s*"([^"]+)"/);if(n&&n[1]){let r=n[1].replace(/\\/g,"");return console.log(`[ToonHub] Found direct URL from gdmirrorbot: ${r}`),r}}catch(t){console.warn(`[ToonHub] gdmirrorbot extraction failed: ${t.message}`)}}if(e.includes("/file/")||e.includes("/embed/")){let t=e.replace("/file/","/embed/"),n=yield(yield $(t,{headers:R(v({},T),{Referer:L})},1e4)).text(),r=n.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(r)return r[0].replace(/&#038;/g,"&");let u=n.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);if(u)return u[0].replace(/&#038;/g,"&")}return e}catch(e){return console.error(`[ToonHub] Extraction failed for ${o}:`,e.message),o}})}function K(o,e,t,s){return w(this,null,function*(){e==="movie"&&(t=null,s=null),console.log(`[ToonHub] Processing ${e} ${o} (S:${t}, E:${s})`);try{let n;if(/^\d+$/.test(o))try{n=yield ue(o,e)}catch(a){n={title:o,year:null}}else try{n=(yield he(o,e))||{title:o,year:null}}catch(a){n={title:o,year:null}}let[r,u]=yield Promise.all([fe(n.title),de(n.title)]),d=r,i=null,f=0;for(let a of d){let c=j(n.title,a.title);if(e==="tv"&&t){let l=a.title.match(/Season\s*(\d+)/i);l?parseInt(l[1])===t?(c+=.2,console.log(`[ToonHub] Comparing "${n.title}" vs "${a.title}" - Score: ${(c-.2).toFixed(2)} + 0.2 (season match) = ${c.toFixed(2)}`)):(c-=.1,console.log(`[ToonHub] Comparing "${n.title}" vs "${a.title}" - Score: ${(c+.1).toFixed(2)} - 0.1 (wrong season) = ${c.toFixed(2)}`)):console.log(`[ToonHub] Comparing "${n.title}" vs "${a.title}" - Score: ${c.toFixed(2)}`)}else console.log(`[ToonHub] Comparing "${n.title}" vs "${a.title}" - Score: ${c.toFixed(2)}`);c>f&&(f=c,i=a)}if(!i||f<.4)return console.warn("[ToonHub] No good match found on ToonHub"),[];if(e==="tv"&&t){let a=i.title.match(/Season\s*(\d+)/i);if(a){let c=parseInt(a[1]);if(c!==t)return console.warn(`[ToonHub] Requested season ${t} not found. Best match only has season ${c}.`),[]}else return console.warn(`[ToonHub] Requested season ${t} but best match "${i.title}" has no season number.`),[]}console.log(`[ToonHub] Best match: "${i.title}" (score: ${f.toFixed(2)})`);let p=yield(yield $(i.href,{headers:T},8e3)).text(),m=F.load(p),B=m(".entry-content"),y=[];if(e==="tv"&&s){let a=s.toString().padStart(2,"0"),c=new RegExp(`Episode\\s*(${s}|${a})`,"i");B.find("p, strong, span, h3").each((l,g)=>{let x=m(g).text();if(c.test(x)){let b=m(g),S=!1,E=0;for(;b.length&&E<5&&(b.find("a[href]").each((X,A)=>{var P;let H=m(A).attr("href"),Z=((P=m(A).text().match(/\d+p/i))==null?void 0:P[0])||ge(b.text())||"HD";if(H&&!H.includes("ads")&&!H.endsWith(".co/")&&!H.endsWith(".co")){if(H.includes("toonstream.net")||H.includes("redirect/main")){console.log(`[ToonHub] Skipping dead/unreliable redirect link: ${H}`);return}y.push({url:H,quality:Z,label:`Episode ${s}`}),S=!0}}),b=b.next(),!(b.length&&/Episode\s*(\d+)/i.test(b.text())&&!c.test(b.text())));)E++}})}else B.find("a[href]").each((a,c)=>{var x;let l=m(c).attr("href"),g=m(c).text();if(l&&(l.includes("/file/")||l.includes("/embed/")||l.includes("drive.google.com")||l.includes("toonstream.")||l.includes("redirect/"))){if(l.includes("toonstream.net")||l.includes("redirect/main"))return;let b=((x=g.match(/\d+p/i))==null?void 0:x[0])||"HD";y.push({url:l,quality:b})}});console.log(`[ToonHub] Found ${y.length} links on ToonHub page`);let k=null,D=0;for(let a of u){let l=j((i==null?void 0:i.title)||n.title,a.title)+(a.type==="series"?.1:0);l>D&&(D=l,k=a)}if(k&&D>.45&&y.length<5){console.log(`[ToonHub] Adding ToonStream result as additional candidate: ${k.title}`);let a=k.type==="episode"?k.href:yield pe(k.href,s||1);a&&y.push({url:a,quality:"HD",label:`Episode ${s}`})}y.sort((a,c)=>{let l=g=>g.includes("gdmirrorbot")||g.includes("as-cdn21.top")?1:g.includes("google.com/drive")?2:g.includes("toonstream")?3:4;return l(a.url)-l(c.url)});let I=[],W=new Set,C=0,O=10,M=5,$e=[],Q=a=>w(this,null,function*(){if(W.has(a.url)||C>=M)return null;W.add(a.url);try{let c=yield me(a.url);if(!c||C>=M)return null;let l=c.match(/name=([^&]+)/),g=null,x=null,b=!0;if(l){let S=decodeURIComponent(l[1].replace(/\+/g," "));g=e==="tv"?se(S):null,x=re(S),e==="tv"&&t&&s&&g&&(g.season!==t||g.episode!==s)&&(b=!1)}if(b&&C<M){let S="";if(l){let A=decodeURIComponent(l[1].replace(/\+/g," "));S=ae(A)}else c.includes(".m3u8")&&(S=yield le(c));let E={name:"ToonHub",title:ie(n,a,g,x,S),url:c,quality:a.quality,headers:{Referer:L,"User-Agent":T["User-Agent"]},provider:"ToonHub"};if((yield oe(E.url,E.headers))&&C<M)return C++,E}return null}catch(c){return null}}),U=new Set;for(let a of y){if(C>=M)break;let c=Q(a).then(l=>{l&&I.push(l),U.delete(c)});U.add(c),U.size>=O&&(yield Promise.race(U))}return yield Promise.all(U),I}catch(n){return console.error("[ToonHub] getStreams error:",n),[]}})}function ge(o){return o.includes("1080p")?"1080p":o.includes("720p")?"720p":o.includes("480p")?"480p":null}typeof module!="undefined"&&module.exports?module.exports={getStreams:K}:global.getStreams={getStreams:K};
