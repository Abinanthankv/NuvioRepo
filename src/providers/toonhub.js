/**
 * toonhub - Built from src/toonhub/
 * Generated: 2026-01-13T01:38:19.932Z
 */
var G=Object.defineProperty,J=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var _=(n,e,t)=>e in n?G(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,x=(n,e)=>{for(var t in e||(e={}))X.call(e,t)&&_(n,t,e[t]);if(q)for(var t of q(e))Z.call(e,t)&&_(n,t,e[t]);return n},v=(n,e)=>J(n,Q(e));var H=(n,e,t)=>new Promise((s,o)=>{var r=l=>{try{u(t.next(l))}catch(f){o(f)}},i=l=>{try{u(t.throw(l))}catch(f){o(f)}},u=l=>l.done?s(l.value):Promise.resolve(l.value).then(r,i);u((t=t.apply(n,e)).next())});var M=require("cheerio-without-node-native"),W="1b3113663c9004682ed61086cf967c44",j="https://api.themoviedb.org/3",k="https://toonhub4u.co",w={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${k}/`};function T(s){return H(this,arguments,function*(n,e={},t=1e4){let o=new AbortController,r=setTimeout(()=>o.abort(),t);try{let i=yield fetch(n,v(x({},e),{signal:o.signal,redirect:"follow"}));return clearTimeout(r),i}catch(i){throw clearTimeout(r),i.name==="AbortError"?new Error(`Request timeout after ${t}ms`):i}})}function I(n){return n?n.toLowerCase().replace(/[-:]/g," ").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function N(n){return n?n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function A(n,e){let t=I(n),s=I(e);if(t===s)return 1;if(t.length>5&&s.length>5&&(s.includes(t)||t.includes(s)))return .9;let o=new Set(t.split(/\s+/).filter(l=>l.length>2)),r=new Set(s.split(/\s+/).filter(l=>l.length>2));if(o.size===0||r.size===0)return 0;let i=new Set([...o].filter(l=>r.has(l))),u=new Set([...o,...r]);return i.size/u.size}function O(n){if(!n)return null;let e=n.match(/S(\d+)E(\d+)/i);return e?{season:parseInt(e[1]),episode:parseInt(e[2])}:null}function V(n){if(!n)return null;let e={languages:[],hasSubtitles:!1,audioType:null};if(/ESub|Subtitle|Sub/i.test(n)&&(e.hasSubtitles=!0),/Multi\s*Audio/i.test(n))e.audioType="Multi Audio",e.languages=["Hindi","English","Japanese"];else if(/Dual\s*Audio/i.test(n)){e.audioType="Dual Audio";let t=n.match(/\b(Hindi|Tamil|Telugu|English|Eng|Japanese|Korean|Chinese)\b/gi);t&&(e.languages=[...new Set(t.map(s=>s.toLowerCase()==="eng"?"English":s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()))])}else{let t=n.match(/\b(Hindi|Tamil|Telugu|English|Eng|Japanese|Korean|Chinese)\b/gi);t&&(e.languages=[...new Set(t.map(s=>s.toLowerCase()==="eng"?"English":s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()))])}return e}function Y(n,e,t,s){let o=e.quality||"Unknown",r=N(n.title||"Unknown"),i=n.year?` (${n.year})`:"",u="";t&&t.season&&t.episode?u=` - S${String(t.season).padStart(2,"0")}E${String(t.episode).padStart(2,"0")}`:e.label&&(u=` - ${e.label}`);let l="\u{1F310}: HINDI/ENGLISH";if(s&&s.languages.length>0){let f=s.languages.join("/"),a=s.hasSubtitles?" + ESub":"";l=`\u{1F3A7}: ${f}${a}`}return`ToonHub (${o})
\u{1F4F9}: ${r}${i}${u}
\u{1F69C}: toonhub | ${l}`}function ee(n,e){return H(this,null,function*(){let s=`${j}/${e==="movie"?"movie":"tv"}/${n}?api_key=${W}`;try{let o=yield T(s,{},8e3);if(!o.ok)throw new Error(`HTTP ${o.status}`);let r=yield o.json();return{title:r.title||r.name,year:(r.release_date||r.first_air_date||"").split("-")[0]}}catch(o){throw console.warn("[ToonHub] TMDB details fetch failed:",o.message),o}})}function te(n,e){return H(this,null,function*(){let s=`${j}/search/${e==="movie"?"movie":"tv"}?api_key=${W}&query=${encodeURIComponent(n)}`;try{let o=yield T(s,{},8e3);if(!o.ok)return null;let r=yield o.json();if(r.results&&r.results.length>0){let i=["vigilantes","vigilante","gaiden","ova","special","recap"],l=r.results.find(f=>{let a=(f.title||f.name||"").toLowerCase();return!i.some(m=>a.includes(m))})||r.results[0];return{title:l.title||l.name,year:(l.release_date||l.first_air_date||"").split("-")[0]}}}catch(o){console.warn("[ToonHub] TMDB search failed:",o.message)}return null})}function oe(n){return H(this,null,function*(){console.log(`[ToonHub] Searching for: "${n}"`);let e=[n.split(":")[0].trim(),n.split(" ")[0],n];for(let t of e)if(!(!t||t.length<3))try{let s=`${k}/?s=${encodeURIComponent(t)}`,o=yield T(s,{headers:w},8e3);if(!o.ok)continue;let r=yield o.text(),i=M.load(r),u=[];if(i("li.post-item").each((l,f)=>{let a=i(f).find("h2.post-title a"),m=a.text().trim().split("[")[0].trim(),$=a.attr("href");$&&u.push({title:m,href:$})}),u.length>0)return console.log(`[ToonHub] Found ${u.length} results with query: "${t}"`),u}catch(s){console.warn(`[ToonHub] Search error for "${t}":`,s.message)}return console.log("[ToonHub] No results found for any search query"),[]})}function z(n){return H(this,null,function*(){console.log(`[ToonHub] Searching ToonStream for: "${n}"`);try{let e=`https://toonstream.one/home/?s=${encodeURIComponent(n)}`,t=yield T(e,{headers:w},1e4);if(!t.ok)return[];let s=yield t.text(),o=M.load(s),r=[];return o("article.post").each((i,u)=>{let l=o(u).find("a.lnk-blk"),f=o(u).find(".entry-title").text().trim(),a=l.attr("href");if(a){let m="unknown";a.includes("/series/")||a.includes("/anime/")?m="series":a.includes("/movies/")||a.includes("/movie/")?m="movie":a.includes("/episode/")&&(m="episode"),r.push({title:f,href:a,type:m})}}),console.log(`[ToonHub] Found ${r.length} results on ToonStream`),r}catch(e){return console.error("[ToonHub] ToonStream search error:",e.message),[]}})}function ne(n,e){return H(this,null,function*(){console.log(`[ToonHub] Getting episode ${e} from ToonStream: ${n}`);try{let t=yield T(n,{headers:w},1e4);if(!t.ok)return null;let s=yield t.text(),o=M.load(s),r=null,i=e.toString().padStart(2,"0"),u=new RegExp(`(?:Episode|Ep)\\s*(${e}|${i})\\b`,"i");return o("article.post.episodes").each((l,f)=>{let a=o(f).text();if(u.test(a))return r=o(f).find("a.lnk-blk").attr("href"),!1}),r||o('a[href*="/episode/"]').each((l,f)=>{let a=o(f).attr("href");if(a.includes(`-${e}/`)||a.includes(`-ep-${e}/`)||a.endsWith(`-${e}`)||a.endsWith(`-ep-${e}`))return r=a,!1}),r}catch(t){return console.error("[ToonHub] ToonStream episode fetch error:",t.message),null}})}function se(n){return H(this,null,function*(){console.log(`[ToonHub] Extracting direct stream from: ${n}`);try{let e=n.replace(/&#038;/g,"&");if(e.includes("redirect/main")&&e.includes(".php?url=")){let t=e.split("url=")[1].split("&")[0];try{e=Buffer.from(t,"base64").toString("utf8"),console.log(`[ToonHub] Decoded redirect URL: ${e}`)}catch(s){console.log("[ToonHub] Base64 decode failed for URL")}}if(e.includes("toonstream.")&&e.includes("/episode/")){console.log(`[ToonHub] Resolving ToonStream episode page: ${e}`);let o=(yield(yield T(e,{headers:w},1e4)).text()).match(/https?:\/\/toonstream\.[^/]+\/home\/\?trembed=[^"']+/i);o&&(e=o[0].replace(/&#038;/g,"&"),console.log(`[ToonHub] Found Embed URL: ${e}`))}if(e.includes("toonstream.")&&e.includes("/home/")){console.log(`[ToonHub] Resolving ToonStream embed: ${e}`);let o=(yield(yield T(e,{headers:w},1e4)).text()).match(/<iframe[^>]+src="([^"]+)"/i);o&&o[1]&&(e=o[1].replace(/&#038;/g,"&"),console.log(`[ToonHub] Found internal host: ${e}`))}if(e.includes("short.icu")||e.includes("as-cdn21.top")||e.includes("abyss.to")){console.log(`[ToonHub] Extracting via Host API: ${e}`);let t=e.match(/\/(?:video|v)\/([a-zA-Z0-9]+)/)||e.match(/[\?&]v=([a-zA-Z0-9]+)/);if(t&&t[1]){let l=t[1],a=`${e.split("/video/")[0].split("/v/")[0]}/player/index.php?data=${l}&do=getVideo`;console.log(`[ToonHub] Calling Host API for ID: ${l}`);try{let m=yield T(a,{method:"POST",headers:v(x({},w),{Referer:"https://toonstream.one/","X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}),body:`hash=${l}&r=https://toonstream.one/`},1e4);if(m.ok){let $=yield m.json();if($&&$.videoSource)return console.log(`[ToonHub] Successfully retrieved signed stream: ${$.videoSource}`),$.videoSource}}catch(m){console.warn(`[ToonHub] Host API call failed: ${m.message}`)}}let s=v(x({},w),{Referer:"https://toonstream.one/"}),r=yield(yield T(e,{headers:s},1e4)).text(),i=r.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(i)return i[0].replace(/&#038;/g,"&");let u=r.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);if(u)return u[0].replace(/&#038;/g,"&")}if(e.includes("gdmirrorbot.nl")){console.log(`[ToonHub] Extracting from gdmirrorbot.nl: ${e}`);try{let o=(yield(yield T(e,{headers:v(x({},w),{Referer:"https://toonhub4u.co/"})},1e4)).text()).match(/const\s+fileurl\s*=\s*"([^"]+)"/);if(o&&o[1]){let r=o[1].replace(/\\/g,"");return console.log(`[ToonHub] Found direct URL from gdmirrorbot: ${r}`),r}}catch(t){console.warn(`[ToonHub] gdmirrorbot extraction failed: ${t.message}`)}}if(e.includes("/file/")||e.includes("/embed/")){let t=e.replace("/file/","/embed/"),o=yield(yield T(t,{headers:v(x({},w),{Referer:k})},1e4)).text(),r=o.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(r)return r[0].replace(/&#038;/g,"&");let i=o.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);if(i)return i[0].replace(/&#038;/g,"&")}return e}catch(e){return console.error(`[ToonHub] Extraction failed for ${n}:`,e.message),n}})}function P(n,e,t,s){return H(this,null,function*(){e==="movie"&&(t=null,s=null),console.log(`[ToonHub] Processing ${e} ${n} (S:${t}, E:${s})`);try{let o;if(/^\d+$/.test(n))try{o=yield ee(n,e)}catch(d){o={title:n,year:null}}else try{o=(yield te(n,e))||{title:n,year:null}}catch(d){o={title:n,year:null}}let r=yield oe(o.title),i=null,u=0;for(let d of r){let c=A(o.title,d.title);if(e==="tv"&&t){let p=d.title.match(/Season\s*(\d+)/i);p?parseInt(p[1])===t?(c+=.2,console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${(c-.2).toFixed(2)} + 0.2 (season match) = ${c.toFixed(2)}`)):(c-=.1,console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${(c+.1).toFixed(2)} - 0.1 (wrong season) = ${c.toFixed(2)}`)):console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${c.toFixed(2)}`)}else console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${c.toFixed(2)}`);c>u&&(u=c,i=d)}if(!i||u<.4)return console.warn("[ToonHub] No good match found on ToonHub"),[];if(e==="tv"&&t){let d=i.title.match(/Season\s*(\d+)/i);if(d){let c=parseInt(d[1]);if(c!==t)return console.warn(`[ToonHub] Requested season ${t} not found. Best match only has season ${c}.`),[]}else return console.warn(`[ToonHub] Requested season ${t} but best match "${i.title}" has no season number.`),[]}console.log(`[ToonHub] Best match: "${i.title}" (score: ${u.toFixed(2)})`);let f=yield(yield T(i.href,{headers:w},8e3)).text(),a=M.load(f),m=a(".entry-content"),$=[];if(e==="tv"&&s){let d=s.toString().padStart(2,"0"),c=new RegExp(`Episode\\s*(${s}|${d})`,"i");m.find("p, strong, span, h3").each((p,h)=>{let S=a(h).text();if(c.test(S)){let b=a(h),g=!1,E=0;for(;b.length&&E<5&&(b.find("a[href]").each((F,R)=>{var B;let y=a(R).attr("href"),K=((B=a(R).text().match(/\d+p/i))==null?void 0:B[0])||re(b.text())||"HD";if(y&&!y.includes("ads")&&!y.endsWith(".co/")&&!y.endsWith(".co")){if(y.includes("toonstream.net")||y.includes("redirect/main")){console.log(`[ToonHub] Skipping dead/unreliable redirect link: ${y}`);return}$.push({url:y,quality:K,label:`Episode ${s}`}),g=!0}}),b=b.next(),!(b.length&&/Episode\s*(\d+)/i.test(b.text())&&!c.test(b.text())));)E++}})}else m.find("a[href]").each((d,c)=>{var S;let p=a(c).attr("href"),h=a(c).text();if(p&&(p.includes("/file/")||p.includes("/embed/")||p.includes("drive.google.com")||p.includes("toonstream.")||p.includes("redirect/"))){if(p.includes("toonstream.net")||p.includes("redirect/main"))return;let b=((S=h.match(/\d+p/i))==null?void 0:S[0])||"HD";$.push({url:p,quality:b})}});if($.length===0){console.log("[ToonHub] No links found on ToonHub page, searching ToonStream as fallback...");let d=yield z(i.title);d.length===0&&o.title!==i.title&&(d=yield z(o.title));let c=null,p=0;for(let h of d){let S=A(i.title,h.title),b=A(o.title,h.title),g=Math.max(S,b);h.type==="series"&&(g+=.1),console.log(`[ToonHub] ToonStream Compare: "${i.title}" vs "${h.title}" (${h.type}) - Score: ${g.toFixed(2)}`),g>p&&(p=g,c=h)}if(c&&p>.45){console.log(`[ToonHub] Found matching series on ToonStream: ${c.title} (${c.type}, score: ${p.toFixed(2)})`);let h=c.type==="episode"?c.href:yield ne(c.href,s||1);h&&(console.log(`[ToonHub] Found direct ToonStream episode link: ${h}`),$.push({url:h,quality:"HD",label:`Episode ${s}`}))}}else console.log(`[ToonHub] Found ${$.length} links on ToonHub page, skipping ToonStream search`);let C=[],L=new Set,U=0,D=5;for(let d=0;d<$.length;d+=D){let c=$.slice(d,d+D),p=yield Promise.all(c.map(h=>H(this,null,function*(){if(L.has(h.url))return null;L.add(h.url);try{let S=yield se(h.url);if(!S)return null;let b=S.match(/name=([^&]+)/),g=null,E=null,F=!0;if(b){let R=decodeURIComponent(b[1].replace(/\+/g," "));g=e==="tv"?O(R):null,E=V(R),e==="tv"&&t&&s&&g&&(g.season!==t||g.episode!==s)&&(console.log(`[ToonHub] Filtering out S${String(g.season).padStart(2,"0")}E${String(g.episode).padStart(2,"0")} (requested S${String(t).padStart(2,"0")}E${String(s).padStart(2,"0")})`),F=!1)}return F?{name:"ToonHub",title:Y(o,h,g,E),url:S,quality:h.quality,headers:{Referer:k,"User-Agent":w["User-Agent"]},provider:"ToonHub",isMatch:g&&g.season===t&&g.episode===s}:null}catch(S){return console.warn(`[ToonHub] Error processing stream: ${S.message}`),null}})));for(let h of p)h&&(C.push(h),h.isMatch&&U++,delete h.isMatch);if(e==="tv"&&U>=3){console.log(`[ToonHub] Found ${U} streams for requested episode, stopping early`);break}if(C.length>=10)break}return C}catch(o){return console.error("[ToonHub] getStreams error:",o),[]}})}function re(n){return n.includes("1080p")?"1080p":n.includes("720p")?"720p":n.includes("480p")?"480p":null}typeof module!="undefined"&&module.exports?module.exports={getStreams:P}:global.getStreams={getStreams:P};
