/**
 * toonhub - Built from src/toonhub/
 * Generated: 2026-01-12T12:56:35.333Z
 */
var G=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var q=(n,e,t)=>e in n?G(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,x=(n,e)=>{for(var t in e||(e={}))Z.call(e,t)&&q(n,t,e[t]);if(_)for(var t of _(e))O.call(e,t)&&q(n,t,e[t]);return n},v=(n,e)=>J(n,X(e));var H=(n,e,t)=>new Promise((s,o)=>{var r=l=>{try{h(t.next(l))}catch(p){o(p)}},i=l=>{try{h(t.throw(l))}catch(p){o(p)}},h=l=>l.done?s(l.value):Promise.resolve(l.value).then(r,i);h((t=t.apply(n,e)).next())});var k=require("cheerio-without-node-native"),W="1b3113663c9004682ed61086cf967c44",j="https://api.themoviedb.org/3",M="https://toonhub4u.co",w={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Referer:`${M}/`};function T(s){return H(this,arguments,function*(n,e={},t=1e4){let o=new AbortController,r=setTimeout(()=>o.abort(),t);try{let i=yield fetch(n,v(x({},e),{signal:o.signal,redirect:"follow"}));return clearTimeout(r),i}catch(i){throw clearTimeout(r),i.name==="AbortError"?new Error(`Request timeout after ${t}ms`):i}})}function I(n){return n?n.toLowerCase().replace(/[-:]/g," ").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function Q(n){return n?n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function A(n,e){let t=I(n),s=I(e);if(t===s)return 1;if(t.length>5&&s.length>5&&(s.includes(t)||t.includes(s)))return .9;let o=new Set(t.split(/\s+/).filter(l=>l.length>2)),r=new Set(s.split(/\s+/).filter(l=>l.length>2));if(o.size===0||r.size===0)return 0;let i=new Set([...o].filter(l=>r.has(l))),h=new Set([...o,...r]);return i.size/h.size}function V(n){if(!n)return null;let e=n.match(/S(\d+)E(\d+)/i);return e?{season:parseInt(e[1]),episode:parseInt(e[2])}:null}function Y(n){if(!n)return null;let e={languages:[],hasSubtitles:!1,audioType:null};if(/ESub|Subtitle|Sub/i.test(n)&&(e.hasSubtitles=!0),/Multi\s*Audio/i.test(n))e.audioType="Multi Audio",e.languages=["Hindi","English","Japanese"];else if(/Dual\s*Audio/i.test(n)){e.audioType="Dual Audio";let t=n.match(/\b(Hindi|Tamil|Telugu|English|Eng|Japanese|Korean|Chinese)\b/gi);t&&(e.languages=[...new Set(t.map(s=>s.toLowerCase()==="eng"?"English":s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()))])}else{let t=n.match(/\b(Hindi|Tamil|Telugu|English|Eng|Japanese|Korean|Chinese)\b/gi);t&&(e.languages=[...new Set(t.map(s=>s.toLowerCase()==="eng"?"English":s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()))])}return e}function N(n,e,t,s){let o=e.quality||"Unknown",r=Q(n.title||"Unknown"),i=n.year?` (${n.year})`:"",h="";t&&t.season&&t.episode?h=` - S${String(t.season).padStart(2,"0")}E${String(t.episode).padStart(2,"0")}`:e.label&&(h=` - ${e.label}`);let l="\u{1F310}: HINDI/ENGLISH";if(s&&s.languages.length>0){let p=s.languages.join("/"),a=s.hasSubtitles?" + ESub":"";l=`\u{1F3A7}: ${p}${a}`}return`ToonHub (${o})
\u{1F4F9}: ${r}${i}${h}
\u{1F69C}: toonhub | ${l}`}function ee(n,e){return H(this,null,function*(){let s=`${j}/${e==="movie"?"movie":"tv"}/${n}?api_key=${W}`;try{let o=yield T(s,{},8e3);if(!o.ok)throw new Error(`HTTP ${o.status}`);let r=yield o.json();return{title:r.title||r.name,year:(r.release_date||r.first_air_date||"").split("-")[0]}}catch(o){throw console.warn("[ToonHub] TMDB details fetch failed:",o.message),o}})}function te(n,e){return H(this,null,function*(){let s=`${j}/search/${e==="movie"?"movie":"tv"}?api_key=${W}&query=${encodeURIComponent(n)}`;try{let o=yield T(s,{},8e3);if(!o.ok)return null;let r=yield o.json();if(r.results&&r.results.length>0){let i=r.results[0];return{title:i.title||i.name,year:(i.release_date||i.first_air_date||"").split("-")[0]}}}catch(o){console.warn("[ToonHub] TMDB search failed:",o.message)}return null})}function oe(n){return H(this,null,function*(){console.log(`[ToonHub] Searching for: "${n}"`);try{let e=`${M}/?s=${encodeURIComponent(n)}`,t=yield T(e,{headers:w},8e3);if(!t.ok)return[];let s=yield t.text(),o=k.load(s),r=[];return o("li.post-item").each((i,h)=>{let l=o(h).find("h2.post-title a"),p=l.text().trim().split("[")[0].trim(),a=l.attr("href");a&&r.push({title:p,href:a})}),console.log(`[ToonHub] Found ${r.length} results`),r}catch(e){return console.error("[ToonHub] Search error:",e.message),[]}})}function z(n){return H(this,null,function*(){console.log(`[ToonHub] Searching ToonStream for: "${n}"`);try{let e=`https://toonstream.one/home/?s=${encodeURIComponent(n)}`,t=yield T(e,{headers:w},1e4);if(!t.ok)return[];let s=yield t.text(),o=k.load(s),r=[];return o("article.post").each((i,h)=>{let l=o(h).find("a.lnk-blk"),p=o(h).find(".entry-title").text().trim(),a=l.attr("href");if(a){let $="unknown";a.includes("/series/")||a.includes("/anime/")?$="series":a.includes("/movies/")||a.includes("/movie/")?$="movie":a.includes("/episode/")&&($="episode"),r.push({title:p,href:a,type:$})}}),console.log(`[ToonHub] Found ${r.length} results on ToonStream`),r}catch(e){return console.error("[ToonHub] ToonStream search error:",e.message),[]}})}function ne(n,e){return H(this,null,function*(){console.log(`[ToonHub] Getting episode ${e} from ToonStream: ${n}`);try{let t=yield T(n,{headers:w},1e4);if(!t.ok)return null;let s=yield t.text(),o=k.load(s),r=null,i=e.toString().padStart(2,"0"),h=new RegExp(`(?:Episode|Ep)\\s*(${e}|${i})\\b`,"i");return o("article.post.episodes").each((l,p)=>{let a=o(p).text();if(h.test(a))return r=o(p).find("a.lnk-blk").attr("href"),!1}),r||o('a[href*="/episode/"]').each((l,p)=>{let a=o(p).attr("href");if(a.includes(`-${e}/`)||a.includes(`-ep-${e}/`)||a.endsWith(`-${e}`)||a.endsWith(`-ep-${e}`))return r=a,!1}),r}catch(t){return console.error("[ToonHub] ToonStream episode fetch error:",t.message),null}})}function se(n){return H(this,null,function*(){console.log(`[ToonHub] Extracting direct stream from: ${n}`);try{let e=n.replace(/&#038;/g,"&");if(e.includes("redirect/main")&&e.includes(".php?url=")){let t=e.split("url=")[1].split("&")[0];try{e=Buffer.from(t,"base64").toString("utf8"),console.log(`[ToonHub] Decoded redirect URL: ${e}`)}catch(s){console.log("[ToonHub] Base64 decode failed for URL")}}if(e.includes("toonstream.")&&e.includes("/episode/")){console.log(`[ToonHub] Resolving ToonStream episode page: ${e}`);let o=(yield(yield T(e,{headers:w},1e4)).text()).match(/https?:\/\/toonstream\.[^/]+\/home\/\?trembed=[^"']+/i);o&&(e=o[0].replace(/&#038;/g,"&"),console.log(`[ToonHub] Found Embed URL: ${e}`))}if(e.includes("toonstream.")&&e.includes("/home/")){console.log(`[ToonHub] Resolving ToonStream embed: ${e}`);let o=(yield(yield T(e,{headers:w},1e4)).text()).match(/<iframe[^>]+src="([^"]+)"/i);o&&o[1]&&(e=o[1].replace(/&#038;/g,"&"),console.log(`[ToonHub] Found internal host: ${e}`))}if(e.includes("short.icu")||e.includes("as-cdn21.top")||e.includes("abyss.to")){console.log(`[ToonHub] Extracting via Host API: ${e}`);let t=e.match(/\/(?:video|v)\/([a-zA-Z0-9]+)/)||e.match(/[\?&]v=([a-zA-Z0-9]+)/);if(t&&t[1]){let l=t[1],a=`${e.split("/video/")[0].split("/v/")[0]}/player/index.php?data=${l}&do=getVideo`;console.log(`[ToonHub] Calling Host API for ID: ${l}`);try{let $=yield T(a,{method:"POST",headers:v(x({},w),{Referer:"https://toonstream.one/","X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}),body:`hash=${l}&r=https://toonstream.one/`},1e4);if($.ok){let b=yield $.json();if(b&&b.videoSource)return console.log(`[ToonHub] Successfully retrieved signed stream: ${b.videoSource}`),b.videoSource}}catch($){console.warn(`[ToonHub] Host API call failed: ${$.message}`)}}let s=v(x({},w),{Referer:"https://toonstream.one/"}),r=yield(yield T(e,{headers:s},1e4)).text(),i=r.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(i)return i[0].replace(/&#038;/g,"&");let h=r.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);if(h)return h[0].replace(/&#038;/g,"&")}if(e.includes("gdmirrorbot.nl")){console.log(`[ToonHub] Extracting from gdmirrorbot.nl: ${e}`);try{let o=(yield(yield T(e,{headers:v(x({},w),{Referer:"https://toonhub4u.co/"})},1e4)).text()).match(/const\s+fileurl\s*=\s*"([^"]+)"/);if(o&&o[1]){let r=o[1].replace(/\\/g,"");return console.log(`[ToonHub] Found direct URL from gdmirrorbot: ${r}`),r}}catch(t){console.warn(`[ToonHub] gdmirrorbot extraction failed: ${t.message}`)}}if(e.includes("/file/")||e.includes("/embed/")){let t=e.replace("/file/","/embed/"),o=yield(yield T(t,{headers:v(x({},w),{Referer:M})},1e4)).text(),r=o.match(/https?:\/\/[^\s"']+\.m3u8[^\s"']*/i);if(r)return r[0].replace(/&#038;/g,"&");let i=o.match(/https?:\/\/[^\s"']+\.mp4[^\s"']*/i);if(i)return i[0].replace(/&#038;/g,"&")}return e}catch(e){return console.error(`[ToonHub] Extraction failed for ${n}:`,e.message),n}})}function P(n,e,t,s){return H(this,null,function*(){e==="movie"&&(t=null,s=null),console.log(`[ToonHub] Processing ${e} ${n} (S:${t}, E:${s})`);try{let o;if(/^\d+$/.test(n))try{o=yield ee(n,e)}catch(d){o={title:n,year:null}}else try{o=(yield te(n,e))||{title:n,year:null}}catch(d){o={title:n,year:null}}let r=yield oe(o.title),i=null,h=0;for(let d of r){let u=A(o.title,d.title);if(e==="tv"&&t){let f=d.title.match(/Season\s*(\d+)/i);f?parseInt(f[1])===t?(u+=.2,console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${(u-.2).toFixed(2)} + 0.2 (season match) = ${u.toFixed(2)}`)):(u-=.1,console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${(u+.1).toFixed(2)} - 0.1 (wrong season) = ${u.toFixed(2)}`)):console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${u.toFixed(2)}`)}else console.log(`[ToonHub] Comparing "${o.title}" vs "${d.title}" - Score: ${u.toFixed(2)}`);u>h&&(h=u,i=d)}if(!i||h<.4)return console.warn("[ToonHub] No good match found on ToonHub"),[];console.log(`[ToonHub] Best match: "${i.title}" (score: ${h.toFixed(2)})`);let p=yield(yield T(i.href,{headers:w},8e3)).text(),a=k.load(p),$=a(".entry-content"),b=[];if(e==="tv"&&s){let d=s.toString().padStart(2,"0"),u=new RegExp(`Episode\\s*(${s}|${d})`,"i");$.find("p, strong, span, h3").each((f,c)=>{let S=a(c).text();if(u.test(S)){let m=a(c),g=!1,E=0;for(;m.length&&E<5&&(m.find("a[href]").each((F,R)=>{var B;let y=a(R).attr("href"),K=((B=a(R).text().match(/\d+p/i))==null?void 0:B[0])||re(m.text())||"HD";if(y&&!y.includes("ads")&&!y.endsWith(".co/")&&!y.endsWith(".co")){if(y.includes("toonstream.net")||y.includes("redirect/main")){console.log(`[ToonHub] Skipping dead/unreliable redirect link: ${y}`);return}b.push({url:y,quality:K,label:`Episode ${s}`}),g=!0}}),m=m.next(),!(m.length&&/Episode\s*(\d+)/i.test(m.text())&&!u.test(m.text())));)E++}})}else $.find("a[href]").each((d,u)=>{var S;let f=a(u).attr("href"),c=a(u).text();if(f&&(f.includes("/file/")||f.includes("/embed/")||f.includes("drive.google.com")||f.includes("toonstream.")||f.includes("redirect/"))){if(f.includes("toonstream.net")||f.includes("redirect/main"))return;let m=((S=c.match(/\d+p/i))==null?void 0:S[0])||"HD";b.push({url:f,quality:m})}});if(b.length===0){console.log("[ToonHub] No links found on ToonHub page, searching ToonStream as fallback...");let d=yield z(i.title);d.length===0&&o.title!==i.title&&(d=yield z(o.title));let u=null,f=0;for(let c of d){let S=A(i.title,c.title),m=A(o.title,c.title),g=Math.max(S,m);c.type==="series"&&(g+=.1),console.log(`[ToonHub] ToonStream Compare: "${i.title}" vs "${c.title}" (${c.type}) - Score: ${g.toFixed(2)}`),g>f&&(f=g,u=c)}if(u&&f>.45){console.log(`[ToonHub] Found matching series on ToonStream: ${u.title} (${u.type}, score: ${f.toFixed(2)})`);let c=u.type==="episode"?u.href:yield ne(u.href,s||1);c&&(console.log(`[ToonHub] Found direct ToonStream episode link: ${c}`),b.push({url:c,quality:"HD",label:`Episode ${s}`}))}}else console.log(`[ToonHub] Found ${b.length} links on ToonHub page, skipping ToonStream search`);let C=[],L=new Set,U=0,D=5;for(let d=0;d<b.length;d+=D){let u=b.slice(d,d+D),f=yield Promise.all(u.map(c=>H(this,null,function*(){if(L.has(c.url))return null;L.add(c.url);try{let S=yield se(c.url);if(!S)return null;let m=S.match(/name=([^&]+)/),g=null,E=null,F=!0;if(m){let R=decodeURIComponent(m[1].replace(/\+/g," "));g=e==="tv"?V(R):null,E=Y(R),e==="tv"&&t&&s&&g&&(g.season!==t||g.episode!==s)&&(console.log(`[ToonHub] Filtering out S${String(g.season).padStart(2,"0")}E${String(g.episode).padStart(2,"0")} (requested S${String(t).padStart(2,"0")}E${String(s).padStart(2,"0")})`),F=!1)}return F?{name:"ToonHub",title:N(o,c,g,E),url:S,quality:c.quality,headers:{Referer:M,"User-Agent":w["User-Agent"]},provider:"ToonHub",isMatch:g&&g.season===t&&g.episode===s}:null}catch(S){return console.warn(`[ToonHub] Error processing stream: ${S.message}`),null}})));for(let c of f)c&&(C.push(c),c.isMatch&&U++,delete c.isMatch);if(e==="tv"&&U>=3){console.log(`[ToonHub] Found ${U} streams for requested episode, stopping early`);break}if(C.length>=10)break}return C}catch(o){return console.error("[ToonHub] getStreams error:",o),[]}})}function re(n){return n.includes("1080p")?"1080p":n.includes("720p")?"720p":n.includes("480p")?"480p":null}typeof module!="undefined"&&module.exports?module.exports={getStreams:P}:global.getStreams={getStreams:P};
