/**
 * animelok - Built from src/animelok/
 * Generated: 2026-01-18T03:56:59.007Z
 */
var R=Object.defineProperty,b=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var x=(e,n,t)=>n in e?R(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,v=(e,n)=>{for(var t in n||(n={}))I.call(n,t)&&x(e,t,n[t]);if(E)for(var t of E(n))D.call(n,t)&&x(e,t,n[t]);return e},W=(e,n)=>b(e,q(n));var w=(e,n,t)=>new Promise((r,o)=>{var h=f=>{try{l(t.next(f))}catch(a){o(a)}},s=f=>{try{l(t.throw(f))}catch(a){o(a)}},l=f=>f.done?r(f.value):Promise.resolve(f.value).then(h,s);l((t=t.apply(e,n)).next())});var N=require("cheerio-without-node-native"),T="https://animelok.to",C="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function U(r){return w(this,arguments,function*(e,n={},t=1e4){let o=new AbortController,h=setTimeout(()=>o.abort(),t);try{let s=yield fetch(e,W(v({},n),{signal:o.signal}));return clearTimeout(h),s}catch(s){throw clearTimeout(h),s}})}function L(e){return w(this,null,function*(){console.log(`[Animelok] Searching for: ${e}`);try{let n=`${T}/search?keyword=${encodeURIComponent(e)}`,r=yield(yield U(n,{headers:{"User-Agent":C}})).text(),o=N.load(r),h=[];return o("a.group.relative").each((s,l)=>{let f=o(l).find("h3").text().trim(),a=o(l).attr("href"),m=o(l).find("img").attr("src");if(a&&f){let i=a.includes("/anime/")?a.split("/anime/")[1].split("?")[0].split("/")[0]:a.split("/").pop();h.push({title:f,id:i,poster:m,type:"tv"})}}),h}catch(n){return console.error("[Animelok] Search error:",n.message),[]}})}var H="1b3113663c9004682ed61086cf967c44";function F(e,n,t=3){return w(this,null,function*(){let r=`https://api.themoviedb.org/3/${n}/${e}?api_key=${H}`;for(let o=0;o<t;o++)try{let h=yield U(r,{},8e3);if(!h.ok)throw new Error(`Status ${h.status}`);let s=yield h.json();return{title:s.name||s.title,year:(s.release_date||s.first_air_date||"").split("-")[0]}}catch(h){if(console.error(`[Animelok] TMDB fetch attempt ${o+1} failed:`,h.message),o===t-1)return null;yield new Promise(s=>setTimeout(s,1e3*(o+1)))}return null})}function O(e,n,t,r){return w(this,null,function*(){let o=e;if(/^\d+$/.test(e)){console.log(`[Animelok] numeric ID detected (${e}), fetching TMDB details...`);let s=yield F(e,n);if(s){console.log(`[Animelok] TMDB Title trace: ${s.title}. Searching on Animelok...`);let l=yield L(s.title);if(l.length>0){let f=l[0];if(t>1){let a=l.find(m=>m.title.toLowerCase().includes(`season ${t}`)||m.title.toLowerCase().includes(` s${t}`));a&&(f=a)}o=f.id,console.log(`[Animelok] Found matching slug: ${o} for season ${t}`)}else return console.warn(`[Animelok] No search results found for: ${s.title}`),[]}else return[]}let h=`${T}/api/anime/${o}/episodes/${r}`;console.log(`Fetching streams for ${o} episode ${r} from ${h}...`);try{let l=yield(yield U(h,{headers:{Referer:`${T}/watch/${o}?ep=${r}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"}})).json(),f=l.episode;if(!f||!f.servers)return[];let a=[],m=(f.subtitles||[]).map(i=>({url:i.url,label:i.name,lang:i.name,language:i.name,format:i.url.endsWith(".vtt")?"vtt":"srt"}));for(let i of f.servers){let g=i.name||"Unknown",A=i.languages||[],y=m.length>0,k={Referer:`${T}/watch/${o}?ep=${r}`,"User-Agent":C};if(i.url.includes("zephyrflick.top")||i.url.includes("as-cdn")){let d=i.url.match(/\/video\/([a-f0-9]{32})/);if(d){let p=d[1],c=yield X(p,g,l.anime||l.movie,t,r,A,y);if(c){let u=c.quality||"Auto";c.quality=u,c.name=`AnimeLok - ${g} - ${u}`,c.subtitles=m,c.headers=W(v({},k),{Referer:`https://as-cdn21.top/video/${p}`}),a.push(c)}}}else if(i.url.startsWith("[")&&i.url.includes(".m3u8"))try{let d=JSON.parse(i.url);for(let p of d){let c=p.url,u=p.quality||"Auto",$=v({},k);c.includes("owocdn.top")&&($.Referer="https://kwik.cx/"),a.push({name:`AnimeLok - ${g} - ${u}`,quality:u,title:M(l.anime||l.movie,u,t,r,A,y),url:c,type:"hls",headers:$,subtitles:m})}}catch(d){console.error("Failed to parse direct HLS sources:",d.message)}else if(i.url.includes(".m3u8")){let d=i.url,p=v({},k);d.includes("owocdn.top")&&(p.Referer="https://kwik.cx/"),a.push({name:`AnimeLok - ${g} - Auto`,quality:"Auto",title:M(l.anime||l.movie,"Auto",t,r,A,y),url:d,type:"hls",headers:p,subtitles:m});try{let c=yield _(i.url,p);if(c&&c.variants&&c.variants.length>0)for(let u of c.variants){let $=u.url,S=u.extraInfo?` | ${u.extraInfo}`:"";a.push({name:`AnimeLok - ${g} - ${u.quality}`,quality:u.quality,title:M(l.anime||l.movie,u.quality,t,r,A,y,S),url:$,type:"hls",headers:p,subtitles:m})}}catch(c){console.error("HLS resolution failed:",c.message)}}}return a}catch(s){return console.error("getStreams failed:",s.message),[]}})}function X(e,n,t,r,o,h,s){return w(this,null,function*(){let l=`https://as-cdn21.top/video/${e}`,f=`https://as-cdn21.top/player/index.php?data=${e}&do=getVideo`;try{let m=yield(yield U(f,{method:"POST",body:`hash=${e}&r=${encodeURIComponent(T)}/`,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:l,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}})).json();if(m&&m.videoSource)return{name:`AnimeLok - ${n} - Auto`,quality:"Auto",title:M(t,"Auto",r,o,h,s),url:m.videoSource,type:"hls"}}catch(a){console.error(`Failed to extract from as-cdn (${e}):`,a.message)}return null})}function M(e,n,t,r,o,h,s=""){let l=e&&e.title?e.title:"Unknown",f=String(t||1).padStart(2,"0"),a=String(r||1).padStart(2,"0"),m=` - S${f} E${a}`,i=o.join("/")||"Unknown";return h&&(i+=" + ESub"),`Animelok (${n})
\u{1F4F9}: ${l}${m}
\u{1F3A7}: ${i}${s}`}function K(e){if(!e)return"";let n=e.split(",").map(r=>r.trim().toLowerCase()),t=[];for(let r of n)r.startsWith("avc")?t.push("H.264"):r.startsWith("hev")||r.startsWith("hvc")?t.push("H.265"):r.startsWith("mp4a")?t.push("AAC"):r.startsWith("ec-3")?t.push("E-AC3"):r.startsWith("ac-3")&&t.push("AC3");return t.join("/")}function _(t){return w(this,arguments,function*(e,n={}){try{let r=yield U(e,{headers:n},5e3);if(!r.ok)return null;let o=yield r.text();if(!o.includes("#EXTM3U")||!o.includes("#EXT-X-STREAM-INF"))return null;let h=[],s=o.split(`
`),l={},f=o.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="([^"]+)",NAME="([^"]+)"/g);for(let a of f)l[a[1]]=a[2];for(let a=0;a<s.length;a++){let m=s[a].trim();if(m.includes("#EXT-X-STREAM-INF")){let i="Unknown",g=m.match(/RESOLUTION=(\d+)x(\d+)/i);if(g){let u=parseInt(g[2]);u>=2160?i="4K":u>=1080?i="1080p":u>=720?i="720p":u>=480?i="480p":i=`${u}p`}if(i==="Unknown"){let u=m.match(/NAME="([^"]+)"/i);u&&(i=u[1])}let A=m.match(/CODECS="([^"]+)"/i),y=A?K(A[1]):"",k=m.match(/AUDIO="([^"]+)"/i),d=k?l[k[1]]:"",p=y;d&&(p+=p?` | ${d}`:d);let c=a+1;for(;c<s.length&&(s[c].trim().startsWith("#")||!s[c].trim());)c++;if(c<s.length){let u=s[c].trim();if(u){let $=u;if(!$.startsWith("http")){let S=e.lastIndexOf("/");$=e.substring(0,S+1)+$}h.some(S=>S.url===$)||h.push({url:$,quality:i,extraInfo:p})}}a=c}}return{variants:h}}catch(r){return null}})}module.exports={search:L,getStreams:O};
