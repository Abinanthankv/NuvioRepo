/**
 * animelok - Built from src/animelok/
 * Generated: 2026-01-14T07:39:23.156Z
 */
var I=Object.defineProperty,R=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var C=(e,n,t)=>n in e?I(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,M=(e,n)=>{for(var t in n||(n={}))D.call(n,t)&&C(e,t,n[t]);if(E)for(var t of E(n))N.call(n,t)&&C(e,t,n[t]);return e},W=(e,n)=>R(e,L(n));var S=(e,n,t)=>new Promise((r,o)=>{var c=u=>{try{l(t.next(u))}catch(a){o(a)}},s=u=>{try{l(t.throw(u))}catch(a){o(a)}},l=u=>u.done?r(u.value):Promise.resolve(u.value).then(c,s);l((t=t.apply(e,n)).next())});var F=require("cheerio-without-node-native"),k="https://animelok.to",x="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function y(r){return S(this,arguments,function*(e,n={},t=1e4){let o=new AbortController,c=setTimeout(()=>o.abort(),t);try{let s=yield fetch(e,W(M({},n),{signal:o.signal}));return clearTimeout(c),s}catch(s){throw clearTimeout(c),s}})}function b(e){return S(this,null,function*(){console.log(`[Animelok] Searching for: ${e}`);try{let n=`${k}/search?keyword=${encodeURIComponent(e)}`,r=yield(yield y(n,{headers:{"User-Agent":x}})).text(),o=F.load(r),c=[];return o("a.group.relative").each((s,l)=>{let u=o(l).find("h3").text().trim(),a=o(l).attr("href"),h=o(l).find("img").attr("src");if(a&&u){let i=a.includes("/anime/")?a.split("/anime/")[1].split("?")[0].split("/")[0]:a.split("/").pop();c.push({title:u,id:i,poster:h,type:"tv"})}}),c}catch(n){return console.error("[Animelok] Search error:",n.message),[]}})}var H="1b3113663c9004682ed61086cf967c44";function O(e,n,t=3){return S(this,null,function*(){let r=`https://api.themoviedb.org/3/${n}/${e}?api_key=${H}`;for(let o=0;o<t;o++)try{let c=yield y(r,{},8e3);if(!c.ok)throw new Error(`Status ${c.status}`);let s=yield c.json();return{title:s.name||s.title,year:(s.release_date||s.first_air_date||"").split("-")[0]}}catch(c){if(console.error(`[Animelok] TMDB fetch attempt ${o+1} failed:`,c.message),o===t-1)return null;yield new Promise(s=>setTimeout(s,1e3*(o+1)))}return null})}function X(e,n,t,r){return S(this,null,function*(){let o=e;if(/^\d+$/.test(e)){console.log(`[Animelok] numeric ID detected (${e}), fetching TMDB details...`);let s=yield O(e,n);if(s){console.log(`[Animelok] TMDB Title trace: ${s.title}. Searching on Animelok...`);let l=yield b(s.title);if(l.length>0){let u=l[0];if(t>1){let a=l.find(h=>h.title.toLowerCase().includes(`season ${t}`)||h.title.toLowerCase().includes(` s${t}`));a&&(u=a)}o=u.id,console.log(`[Animelok] Found matching slug: ${o} for season ${t}`)}else return console.warn(`[Animelok] No search results found for: ${s.title}`),[]}else return[]}let c=`${k}/api/anime/${o}/episodes/${r}`;console.log(`Fetching streams for ${o} episode ${r} from ${c}...`);try{let l=yield(yield y(c,{headers:{Referer:`${k}/watch/${o}?ep=${r}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"}})).json(),u=l.episode;if(!u||!u.servers)return[];let a=[],h=(u.subtitles||[]).map(i=>({url:i.url,label:i.name,lang:i.name,language:i.name,format:i.url.endsWith(".vtt")?"vtt":"srt"}));for(let i of u.servers){let g=i.name||"Unknown",w=i.languages||[],v=h.length>0,$={Referer:`${k}/watch/${o}?ep=${r}`,"User-Agent":x};if(i.url.includes("zephyrflick.top")||i.url.includes("as-cdn")){let d=i.url.match(/\/video\/([a-f0-9]{32})/);if(d){let m=d[1],f=yield K(m,g,l.anime||l.movie,t,r,w,v);f&&(f.subtitles=h,f.headers=W(M({},$),{Referer:`https://as-cdn21.top/video/${m}`}),a.push(f))}}else if(i.url.startsWith("[")&&i.url.includes(".m3u8"))try{let d=JSON.parse(i.url);for(let m of d){let f=m.url;a.push({title:T(l.anime||l.movie,g,m.quality||"Auto",t,r,w,v),url:f,type:"hls",headers:$,subtitles:h})}}catch(d){console.error("Failed to parse direct HLS sources:",d.message)}else if(i.url.includes(".m3u8")){let d=i.url;a.push({name:"AnimeLok",title:T(l.anime||l.movie,g,"Auto",t,r,w,v),url:d,type:"hls",headers:$,subtitles:h});try{let m=yield j(i.url,$);if(m&&m.variants&&m.variants.length>0)for(let f of m.variants){let p=f.url,A=f.extraInfo?` | ${f.extraInfo}`:"";a.push({name:"AnimeLok",title:T(l.anime||l.movie,g,f.quality,t,r,w,v,A),url:p,type:"hls",headers:$,subtitles:h})}}catch(m){console.error("HLS resolution failed:",m.message)}}}return a}catch(s){return console.error("getStreams failed:",s.message),[]}})}function K(e,n,t,r,o,c,s){return S(this,null,function*(){let l=`https://as-cdn21.top/video/${e}`,u=`https://as-cdn21.top/player/index.php?data=${e}&do=getVideo`;try{let h=yield(yield y(u,{method:"POST",body:`hash=${e}&r=${encodeURIComponent(k)}/`,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:l,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}})).json();if(h&&h.videoSource)return{title:T(t,n,"Auto",r,o,c,s),url:h.videoSource,type:"hls"}}catch(a){console.error(`Failed to extract from as-cdn (${e}):`,a.message)}return null})}function T(e,n,t,r,o,c,s,l=""){let u=e&&e.title?e.title:"Unknown",a=String(r||1).padStart(2,"0"),h=String(o||1).padStart(2,"0"),i=` - S${a} E${h}`,g=c.join("/")||"Unknown";return s&&(g+=" + ESub"),`Animelok (${t}) [${n}]
\u{1F4F9}: ${u}${i}
\u{1F69C}: animelok | \u{1F3A7}: ${g}${l}`}function _(e){if(!e)return"";let n=e.split(",").map(r=>r.trim().toLowerCase()),t=[];for(let r of n)r.startsWith("avc")?t.push("H.264"):r.startsWith("hev")||r.startsWith("hvc")?t.push("H.265"):r.startsWith("mp4a")?t.push("AAC"):r.startsWith("ec-3")?t.push("E-AC3"):r.startsWith("ac-3")&&t.push("AC3");return t.join("/")}function j(t){return S(this,arguments,function*(e,n={}){try{let r=yield y(e,{headers:n},5e3);if(!r.ok)return null;let o=yield r.text();if(!o.includes("#EXTM3U")||!o.includes("#EXT-X-STREAM-INF"))return null;let c=[],s=o.split(`
`),l={},u=o.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="([^"]+)",NAME="([^"]+)"/g);for(let a of u)l[a[1]]=a[2];for(let a=0;a<s.length;a++){let h=s[a].trim();if(h.includes("#EXT-X-STREAM-INF")){let i="Unknown",g=h.match(/RESOLUTION=(\d+)x(\d+)/i);if(g){let p=parseInt(g[2]);p>=2160?i="4K":p>=1080?i="1080p":p>=720?i="720p":p>=480?i="480p":i=`${p}p`}if(i==="Unknown"){let p=h.match(/NAME="([^"]+)"/i);p&&(i=p[1])}let w=h.match(/CODECS="([^"]+)"/i),v=w?_(w[1]):"",$=h.match(/AUDIO="([^"]+)"/i),d=$?l[$[1]]:"",m=v;d&&(m+=m?` | ${d}`:d);let f=a+1;for(;f<s.length&&(s[f].trim().startsWith("#")||!s[f].trim());)f++;if(f<s.length){let p=s[f].trim();if(p){let A=p;if(!A.startsWith("http")){let U=e.lastIndexOf("/");A=e.substring(0,U+1)+A}c.some(U=>U.url===A)||c.push({url:A,quality:i,extraInfo:m})}}a=f}}return{variants:c}}catch(r){return null}})}module.exports={search:b,getStreams:X};
