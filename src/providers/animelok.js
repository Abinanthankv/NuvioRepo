/**
 * animelok - Built from src/animelok/
 * Generated: 2026-01-18T03:38:55.975Z
 */
var b=Object.defineProperty,q=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var x=(e,n,t)=>n in e?b(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,M=(e,n)=>{for(var t in n||(n={}))R.call(n,t)&&x(e,t,n[t]);if(E)for(var t of E(n))D.call(n,t)&&x(e,t,n[t]);return e},W=(e,n)=>q(e,I(n));var y=(e,n,t)=>new Promise((r,o)=>{var c=u=>{try{l(t.next(u))}catch(a){o(a)}},s=u=>{try{l(t.throw(u))}catch(a){o(a)}},l=u=>u.done?r(u.value):Promise.resolve(u.value).then(c,s);l((t=t.apply(e,n)).next())});var N=require("cheerio-without-node-native"),k="https://animelok.to",C="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function v(r){return y(this,arguments,function*(e,n={},t=1e4){let o=new AbortController,c=setTimeout(()=>o.abort(),t);try{let s=yield fetch(e,W(M({},n),{signal:o.signal}));return clearTimeout(c),s}catch(s){throw clearTimeout(c),s}})}function L(e){return y(this,null,function*(){console.log(`[Animelok] Searching for: ${e}`);try{let n=`${k}/search?keyword=${encodeURIComponent(e)}`,r=yield(yield v(n,{headers:{"User-Agent":C}})).text(),o=N.load(r),c=[];return o("a.group.relative").each((s,l)=>{let u=o(l).find("h3").text().trim(),a=o(l).attr("href"),f=o(l).find("img").attr("src");if(a&&u){let i=a.includes("/anime/")?a.split("/anime/")[1].split("?")[0].split("/")[0]:a.split("/").pop();c.push({title:u,id:i,poster:f,type:"tv"})}}),c}catch(n){return console.error("[Animelok] Search error:",n.message),[]}})}var H="1b3113663c9004682ed61086cf967c44";function F(e,n,t=3){return y(this,null,function*(){let r=`https://api.themoviedb.org/3/${n}/${e}?api_key=${H}`;for(let o=0;o<t;o++)try{let c=yield v(r,{},8e3);if(!c.ok)throw new Error(`Status ${c.status}`);let s=yield c.json();return{title:s.name||s.title,year:(s.release_date||s.first_air_date||"").split("-")[0]}}catch(c){if(console.error(`[Animelok] TMDB fetch attempt ${o+1} failed:`,c.message),o===t-1)return null;yield new Promise(s=>setTimeout(s,1e3*(o+1)))}return null})}function O(e,n,t,r){return y(this,null,function*(){let o=e;if(/^\d+$/.test(e)){console.log(`[Animelok] numeric ID detected (${e}), fetching TMDB details...`);let s=yield F(e,n);if(s){console.log(`[Animelok] TMDB Title trace: ${s.title}. Searching on Animelok...`);let l=yield L(s.title);if(l.length>0){let u=l[0];if(t>1){let a=l.find(f=>f.title.toLowerCase().includes(`season ${t}`)||f.title.toLowerCase().includes(` s${t}`));a&&(u=a)}o=u.id,console.log(`[Animelok] Found matching slug: ${o} for season ${t}`)}else return console.warn(`[Animelok] No search results found for: ${s.title}`),[]}else return[]}let c=`${k}/api/anime/${o}/episodes/${r}`;console.log(`Fetching streams for ${o} episode ${r} from ${c}...`);try{let l=yield(yield v(c,{headers:{Referer:`${k}/watch/${o}?ep=${r}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"}})).json(),u=l.episode;if(!u||!u.servers)return[];let a=[],f=(u.subtitles||[]).map(i=>({url:i.url,label:i.name,lang:i.name,language:i.name,format:i.url.endsWith(".vtt")?"vtt":"srt"}));for(let i of u.servers){let $=i.name||"Unknown",A=i.languages||[],S=f.length>0,g={Referer:`${k}/watch/${o}?ep=${r}`,"User-Agent":C};if(i.url.includes("zephyrflick.top")||i.url.includes("as-cdn")){let d=i.url.match(/\/video\/([a-f0-9]{32})/);if(d){let p=d[1],h=yield X(p,$,l.anime||l.movie,t,r,A,S);if(h){let m=h.quality||"Auto";h.quality=m,h.name=`AnimeLok - ${$} - ${m}`,h.subtitles=f,h.headers=W(M({},g),{Referer:`https://as-cdn21.top/video/${p}`}),a.push(h)}}}else if(i.url.startsWith("[")&&i.url.includes(".m3u8"))try{let d=JSON.parse(i.url);for(let p of d){let h=p.url,m=p.quality||"Auto";a.push({name:`AnimeLok - ${$} - ${m}`,quality:m,title:T(l.anime||l.movie,m,t,r,A,S),url:h,type:"hls",headers:g,subtitles:f})}}catch(d){console.error("Failed to parse direct HLS sources:",d.message)}else if(i.url.includes(".m3u8")){let d=i.url;a.push({name:`AnimeLok - ${$} - Auto`,quality:"Auto",title:T(l.anime||l.movie,"Auto",t,r,A,S),url:d,type:"hls",headers:g,subtitles:f});try{let p=yield _(i.url,g);if(p&&p.variants&&p.variants.length>0)for(let h of p.variants){let m=h.url,w=h.extraInfo?` | ${h.extraInfo}`:"";a.push({name:`AnimeLok - ${$} - ${h.quality}`,quality:h.quality,title:T(l.anime||l.movie,h.quality,t,r,A,S,w),url:m,type:"hls",headers:g,subtitles:f})}}catch(p){console.error("HLS resolution failed:",p.message)}}}return a}catch(s){return console.error("getStreams failed:",s.message),[]}})}function X(e,n,t,r,o,c,s){return y(this,null,function*(){let l=`https://as-cdn21.top/video/${e}`,u=`https://as-cdn21.top/player/index.php?data=${e}&do=getVideo`;try{let f=yield(yield v(u,{method:"POST",body:`hash=${e}&r=${encodeURIComponent(k)}/`,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:l,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}})).json();if(f&&f.videoSource)return{name:`AnimeLok - ${n} - Auto`,quality:"Auto",title:T(t,"Auto",r,o,c,s),url:f.videoSource,type:"hls"}}catch(a){console.error(`Failed to extract from as-cdn (${e}):`,a.message)}return null})}function T(e,n,t,r,o,c,s=""){let l=e&&e.title?e.title:"Unknown",u=String(t||1).padStart(2,"0"),a=String(r||1).padStart(2,"0"),f=` - S${u} E${a}`,i=o.join("/")||"Unknown";return c&&(i+=" + ESub"),`Animelok (${n})
\u{1F4F9}: ${l}${f}
\u{1F3A7}: ${i}${s}`}function K(e){if(!e)return"";let n=e.split(",").map(r=>r.trim().toLowerCase()),t=[];for(let r of n)r.startsWith("avc")?t.push("H.264"):r.startsWith("hev")||r.startsWith("hvc")?t.push("H.265"):r.startsWith("mp4a")?t.push("AAC"):r.startsWith("ec-3")?t.push("E-AC3"):r.startsWith("ac-3")&&t.push("AC3");return t.join("/")}function _(t){return y(this,arguments,function*(e,n={}){try{let r=yield v(e,{headers:n},5e3);if(!r.ok)return null;let o=yield r.text();if(!o.includes("#EXTM3U")||!o.includes("#EXT-X-STREAM-INF"))return null;let c=[],s=o.split(`
`),l={},u=o.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="([^"]+)",NAME="([^"]+)"/g);for(let a of u)l[a[1]]=a[2];for(let a=0;a<s.length;a++){let f=s[a].trim();if(f.includes("#EXT-X-STREAM-INF")){let i="Unknown",$=f.match(/RESOLUTION=(\d+)x(\d+)/i);if($){let m=parseInt($[2]);m>=2160?i="4K":m>=1080?i="1080p":m>=720?i="720p":m>=480?i="480p":i=`${m}p`}if(i==="Unknown"){let m=f.match(/NAME="([^"]+)"/i);m&&(i=m[1])}let A=f.match(/CODECS="([^"]+)"/i),S=A?K(A[1]):"",g=f.match(/AUDIO="([^"]+)"/i),d=g?l[g[1]]:"",p=S;d&&(p+=p?` | ${d}`:d);let h=a+1;for(;h<s.length&&(s[h].trim().startsWith("#")||!s[h].trim());)h++;if(h<s.length){let m=s[h].trim();if(m){let w=m;if(!w.startsWith("http")){let U=e.lastIndexOf("/");w=e.substring(0,U+1)+w}c.some(U=>U.url===w)||c.push({url:w,quality:i,extraInfo:p})}}a=h}}return{variants:c}}catch(r){return null}})}module.exports={search:L,getStreams:O};
