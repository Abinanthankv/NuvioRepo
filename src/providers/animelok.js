/**
 * animelok - Built from src/animelok/
 * Generated: 2026-01-18T07:45:15.341Z
 */
var q=Object.defineProperty,I=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var x=(e,r,t)=>r in e?q(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,T=(e,r)=>{for(var t in r||(r={}))N.call(r,t)&&x(e,t,r[t]);if(W)for(var t of W(r))H.call(r,t)&&x(e,t,r[t]);return e},C=(e,r)=>I(e,D(r));var A=(e,r,t)=>new Promise((n,o)=>{var u=c=>{try{l(t.next(c))}catch(a){o(a)}},s=c=>{try{l(t.throw(c))}catch(a){o(a)}},l=c=>c.done?n(c.value):Promise.resolve(c.value).then(u,s);l((t=t.apply(e,r)).next())});var z=require("cheerio-without-node-native"),v="https://animelok.to",R="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function M(n){return A(this,arguments,function*(e,r={},t=1e4){let o=new AbortController,u=setTimeout(()=>o.abort(),t);try{let s=yield fetch(e,C(T({},r),{signal:o.signal}));return clearTimeout(u),s}catch(s){throw clearTimeout(u),s}})}function E(e){return(e||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function L(e,r){let t=E(e),n=E(r);if(t===n)return 1;if(t.includes(n)||n.includes(t))return .9;let o=new Set(t.split(/\s+/).filter(c=>c.length>2)),u=new Set(n.split(/\s+/).filter(c=>c.length>2));if(o.size===0||u.size===0)return 0;let s=new Set([...o].filter(c=>u.has(c))),l=new Set([...o,...u]);return s.size/l.size}function b(e){return A(this,null,function*(){console.log(`[Animelok] Searching for: ${e}`);try{let r=`${v}/search?keyword=${encodeURIComponent(e)}`,n=yield(yield M(r,{headers:{"User-Agent":R}})).text(),o=z.load(n),u=[];return o("a.group.relative").each((s,l)=>{let c=o(l).find("h3").text().trim(),a=o(l).attr("href"),m=o(l).find("img").attr("src");if(a&&c){let i=a.includes("/anime/")?a.split("/anime/")[1].split("?")[0].split("/")[0]:a.split("/").pop();u.push({title:c,id:i,poster:m,type:"tv"})}}),u}catch(r){return console.error("[Animelok] Search error:",r.message),[]}})}var F="1b3113663c9004682ed61086cf967c44";function O(e,r,t=3){return A(this,null,function*(){let n=`https://api.themoviedb.org/3/${r}/${e}?api_key=${F}`;for(let o=0;o<t;o++)try{let u=yield M(n,{},8e3);if(!u.ok)throw new Error(`Status ${u.status}`);let s=yield u.json();return{title:s.name||s.title,year:(s.release_date||s.first_air_date||"").split("-")[0]}}catch(u){if(console.error(`[Animelok] TMDB fetch attempt ${o+1} failed:`,u.message),o===t-1)return null;yield new Promise(s=>setTimeout(s,1e3*(o+1)))}return null})}function X(e,r,t,n){return A(this,null,function*(){let o=e;if(/^\d+$/.test(e)){console.log(`[Animelok] numeric ID detected (${e}), fetching TMDB details...`);let s=yield O(e,r);if(s){console.log(`[Animelok] TMDB Title trace: ${s.title}. Searching on Animelok...`);let l=yield b(s.title),c=l.find(a=>L(s.title,a.title)>=.4);if(c){let a=c,m=l.filter(i=>L(s.title,i.title)>=.4);if(t>1){let i=m.find(d=>d.title.toLowerCase().includes(`season ${t}`)||d.title.toLowerCase().includes(` s${t}`)||d.title.toLowerCase().includes(` ${t}nd season`)||d.title.toLowerCase().includes(` ${t}rd season`)||d.title.toLowerCase().includes(` ${t}th season`));i&&(a=i)}o=a.id,console.log(`[Animelok] Found matching slug: ${o} (Title: ${a.title})`)}else return console.warn(`[Animelok] No good match found for: ${s.title}`),l.length>0&&console.log(`[Animelok] Closest found was: ${l[0].title} (Score: ${L(s.title,l[0].title).toFixed(2)})`),[]}else return[]}let u=`${v}/api/anime/${o}/episodes/${n}`;console.log(`Fetching streams for ${o} episode ${n} from ${u}...`);try{let l=yield(yield M(u,{headers:{Referer:`${v}/watch/${o}?ep=${n}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"}})).json(),c=l.episode;if(!c||!c.servers)return[];let a=[],m=(c.subtitles||[]).map(i=>({url:i.url,label:i.name,lang:i.name,language:i.name,format:i.url.endsWith(".vtt")?"vtt":"srt"}));for(let i of c.servers){let d=i.name||"Unknown",w=i.languages||[],y=m.length>0,S={Referer:`${v}/watch/${o}?ep=${n}`,"User-Agent":R};if(i.url.includes("zephyrflick.top")||i.url.includes("as-cdn")){let $=i.url.match(/\/video\/([a-f0-9]{32})/);if($){let p=$[1],h=yield K(p,d,l.anime||l.movie,t,n,w,y);if(h){let f=h.quality||"Auto";h.quality=f,h.name=`AnimeLok - ${d} - ${f}`,h.subtitles=m,h.headers=C(T({},S),{Referer:`https://as-cdn21.top/video/${p}`}),a.push(h)}}}else if(i.url.startsWith("[")&&i.url.includes(".m3u8"))try{let $=JSON.parse(i.url);for(let p of $){let h=p.url,f=p.quality||"Auto",g=T({},S);h.includes("owocdn.top")&&(g.Referer="https://kwik.cx/"),a.push({name:`AnimeLok - ${d} - ${f}`,quality:f,title:U(l.anime||l.movie,f,t,n,w,y),url:h,type:"hls",headers:g,subtitles:m})}}catch($){console.error("Failed to parse direct HLS sources:",$.message)}else if(i.url.includes(".m3u8")){let $=i.url,p=T({},S);$.includes("owocdn.top")&&(p.Referer="https://kwik.cx/"),a.push({name:`AnimeLok - ${d} - Auto`,quality:"Auto",title:U(l.anime||l.movie,"Auto",t,n,w,y),url:$,type:"hls",headers:p,subtitles:m});try{let h=yield j(i.url,p);if(h&&h.variants&&h.variants.length>0)for(let f of h.variants){let g=f.url,k=f.extraInfo?` | ${f.extraInfo}`:"";a.push({name:`AnimeLok - ${d} - ${f.quality}`,quality:f.quality,title:U(l.anime||l.movie,f.quality,t,n,w,y,k),url:g,type:"hls",headers:p,subtitles:m})}}catch(h){console.error("HLS resolution failed:",h.message)}}}return a}catch(s){return console.error("getStreams failed:",s.message),[]}})}function K(e,r,t,n,o,u,s){return A(this,null,function*(){let l=`https://as-cdn21.top/video/${e}`,c=`https://as-cdn21.top/player/index.php?data=${e}&do=getVideo`;try{let m=yield(yield M(c,{method:"POST",body:`hash=${e}&r=${encodeURIComponent(v)}/`,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:l,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}})).json();if(m&&m.videoSource)return{name:`AnimeLok - ${r} - Auto`,quality:"Auto",title:U(t,"Auto",n,o,u,s),url:m.videoSource,type:"hls"}}catch(a){console.error(`Failed to extract from as-cdn (${e}):`,a.message)}return null})}function U(e,r,t,n,o,u,s=""){let l=e&&e.title?e.title:"Unknown",c=String(t||1).padStart(2,"0"),a=String(n||1).padStart(2,"0"),m=` - S${c} E${a}`,i=o.join("/")||"Unknown";return u&&(i+=" + ESub"),`Animelok (${r})
\u{1F4F9}: ${l}${m}
\u{1F3A7}: ${i}${s}`}function _(e){if(!e)return"";let r=e.split(",").map(n=>n.trim().toLowerCase()),t=[];for(let n of r)n.startsWith("avc")?t.push("H.264"):n.startsWith("hev")||n.startsWith("hvc")?t.push("H.265"):n.startsWith("mp4a")?t.push("AAC"):n.startsWith("ec-3")?t.push("E-AC3"):n.startsWith("ac-3")&&t.push("AC3");return t.join("/")}function j(t){return A(this,arguments,function*(e,r={}){try{let n=yield M(e,{headers:r},5e3);if(!n.ok)return null;let o=yield n.text();if(!o.includes("#EXTM3U")||!o.includes("#EXT-X-STREAM-INF"))return null;let u=[],s=o.split(`
`),l={},c=o.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="([^"]+)",NAME="([^"]+)"/g);for(let a of c)l[a[1]]=a[2];for(let a=0;a<s.length;a++){let m=s[a].trim();if(m.includes("#EXT-X-STREAM-INF")){let i="Unknown",d=m.match(/RESOLUTION=(\d+)x(\d+)/i);if(d){let f=parseInt(d[2]);f>=2160?i="4K":f>=1080?i="1080p":f>=720?i="720p":f>=480?i="480p":i=`${f}p`}if(i==="Unknown"){let f=m.match(/NAME="([^"]+)"/i);f&&(i=f[1])}let w=m.match(/CODECS="([^"]+)"/i),y=w?_(w[1]):"",S=m.match(/AUDIO="([^"]+)"/i),$=S?l[S[1]]:"",p=y;$&&(p+=p?` | ${$}`:$);let h=a+1;for(;h<s.length&&(s[h].trim().startsWith("#")||!s[h].trim());)h++;if(h<s.length){let f=s[h].trim();if(f){let g=f;if(!g.startsWith("http")){let k=e.lastIndexOf("/");g=e.substring(0,k+1)+g}u.some(k=>k.url===g)||u.push({url:g,quality:i,extraInfo:p})}}a=h}}return{variants:u}}catch(n){return null}})}module.exports={search:b,getStreams:X};
