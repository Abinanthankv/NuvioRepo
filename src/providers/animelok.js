/**
 * animelok - Built from src/animelok/
 * Generated: 2026-01-12T16:44:16.630Z
 */
var v=Object.defineProperty,b=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var T=(t,r,e)=>r in t?v(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,U=(t,r)=>{for(var e in r||(r={}))C.call(r,e)&&T(t,e,r[e]);if(k)for(var e of k(r))M.call(r,e)&&T(t,e,r[e]);return t},W=(t,r)=>b(t,x(r));var m=(t,r,e)=>new Promise((i,s)=>{var l=o=>{try{a(e.next(o))}catch(c){s(c)}},u=o=>{try{a(e.throw(o))}catch(c){s(c)}},a=o=>o.done?i(o.value):Promise.resolve(o.value).then(l,u);a((e=e.apply(t,r)).next())});var R=require("cheerio-without-node-native"),f="https://animelok.to",F="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function A(i){return m(this,arguments,function*(t,r={},e=1e4){let s=new AbortController,l=setTimeout(()=>s.abort(),e);try{let u=yield fetch(t,W(U({},r),{signal:s.signal}));return clearTimeout(l),u}catch(u){throw clearTimeout(l),u}})}function L(t){return m(this,null,function*(){console.log(`[Animelok] Searching for: ${t}`);try{let r=`${f}/search?keyword=${encodeURIComponent(t)}`,i=yield(yield A(r,{headers:{"User-Agent":F}})).text(),s=R.load(i),l=[];return s("a.group.relative").each((u,a)=>{let o=s(a).find("h3").text().trim(),c=s(a).attr("href"),p=s(a).find("img").attr("src");c&&o&&l.push({title:o,id:c.replace("/anime/",""),poster:p,type:"tv"})}),l}catch(r){return console.error("[Animelok] Search error:",r.message),[]}})}function N(t,r,e,i){return m(this,null,function*(){let s=t,l=`${f}/api/anime/${s}/episodes/${i}`;console.log(`Fetching streams for ${s} episode ${i} from ${l}...`);try{let a=yield(yield A(l,{headers:{Referer:`${f}/watch/${s}?ep=${i}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"}})).json(),o=a.episode;if(!o||!o.servers)return[];let c=[],p=(o.subtitles||[]).map(n=>({url:n.url,language:n.name,format:n.url.endsWith(".vtt")?"vtt":"srt"}));for(let n of o.servers){let g=n.name||"Unknown",S=n.languages||[],$=p.length>0;if(n.url.includes("zephyrflick.top")||n.url.includes("as-cdn")){let h=n.url.match(/\/video\/([a-f0-9]{32})/);if(h){let d=h[1],w=yield K(d,g,a.anime,e,i,S,$);w&&(w.subtitles=p,c.push(w))}}else if(n.url.startsWith("[")&&n.url.includes(".m3u8"))try{let h=JSON.parse(n.url);for(let d of h)c.push({title:y(a.anime,g,d.quality||"Auto",e,i,S,$),url:d.url,type:"hls",subtitles:p})}catch(h){console.error("Failed to parse direct HLS sources:",h.message)}else n.url.includes(".m3u8")&&c.push({title:y(a.anime,g,"Auto",e,i,S,$),url:n.url,type:"hls",subtitles:p})}return c}catch(u){return console.error("getStreams failed:",u.message),[]}})}function K(t,r,e,i,s,l,u){return m(this,null,function*(){let a=`https://as-cdn21.top/video/${t}`,o=`https://as-cdn21.top/player/index.php?data=${t}&do=getVideo`;try{let p=yield(yield A(o,{method:"POST",body:`hash=${t}&r=${encodeURIComponent(f)}/`,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:a,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}})).json();if(p&&p.videoSource)return{title:y(e,r,"Auto",i,s,l,u),url:p.videoSource,type:"hls"}}catch(c){console.error(`Failed to extract from as-cdn (${t}):`,c.message)}return null})}function y(t,r,e,i,s,l,u){let a=t.title||"Unknown",o=String(i||1).padStart(2,"0"),c=String(s||1).padStart(2,"0"),p=` - S${o} E${c}`,n=l.join("/")||"Unknown";return u&&(n+=" + ESub"),`Animelok (${e||"Auto"})
\u{1F4F9}: ${a}${p}
\u{1F69C}: animelok | \u{1F3A7}: ${n}`}module.exports={search:L,getStreams:N};
