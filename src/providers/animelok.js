/**
 * animelok - Built from src/animelok/
 * Generated: 2026-01-13T03:18:05.689Z
 */
var I=Object.defineProperty,R=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var C=(e,n,t)=>n in e?I(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,M=(e,n)=>{for(var t in n||(n={}))N.call(n,t)&&C(e,t,n[t]);if(E)for(var t of E(n))L.call(n,t)&&C(e,t,n[t]);return e},W=(e,n)=>R(e,D(n));var S=(e,n,t)=>new Promise((o,r)=>{var c=u=>{try{l(t.next(u))}catch(a){r(a)}},s=u=>{try{l(t.throw(u))}catch(a){r(a)}},l=u=>u.done?o(u.value):Promise.resolve(u.value).then(c,s);l((t=t.apply(e,n)).next())});var F=require("cheerio-without-node-native"),y="https://animelok.to",x="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function T(o){return S(this,arguments,function*(e,n={},t=1e4){let r=new AbortController,c=setTimeout(()=>r.abort(),t);try{let s=yield fetch(e,W(M({},n),{signal:r.signal}));return clearTimeout(c),s}catch(s){throw clearTimeout(c),s}})}function b(e){return S(this,null,function*(){console.log(`[Animelok] Searching for: ${e}`);try{let n=`${y}/search?keyword=${encodeURIComponent(e)}`,o=yield(yield T(n,{headers:{"User-Agent":x}})).text(),r=F.load(o),c=[];return r("a.group.relative").each((s,l)=>{let u=r(l).find("h3").text().trim(),a=r(l).attr("href"),h=r(l).find("img").attr("src");if(a&&u){let i=a.includes("/anime/")?a.split("/anime/")[1].split("?")[0].split("/")[0]:a.split("/").pop();c.push({title:u,id:i,poster:h,type:"tv"})}}),c}catch(n){return console.error("[Animelok] Search error:",n.message),[]}})}var H="1b3113663c9004682ed61086cf967c44";function O(e,n,t=3){return S(this,null,function*(){let o=`https://api.themoviedb.org/3/${n}/${e}?api_key=${H}`;for(let r=0;r<t;r++)try{let c=yield T(o,{},8e3);if(!c.ok)throw new Error(`Status ${c.status}`);let s=yield c.json();return{title:s.name||s.title,year:(s.release_date||s.first_air_date||"").split("-")[0]}}catch(c){if(console.error(`[Animelok] TMDB fetch attempt ${r+1} failed:`,c.message),r===t-1)return null;yield new Promise(s=>setTimeout(s,1e3*(r+1)))}return null})}function X(e,n,t,o){return S(this,null,function*(){let r=e;if(/^\d+$/.test(e)){console.log(`[Animelok] numeric ID detected (${e}), fetching TMDB details...`);let s=yield O(e,n);if(s){console.log(`[Animelok] TMDB Title trace: ${s.title}. Searching on Animelok...`);let l=yield b(s.title);if(l.length>0){let u=l[0];if(t>1){let a=l.find(h=>h.title.toLowerCase().includes(`season ${t}`)||h.title.toLowerCase().includes(` s${t}`));a&&(u=a)}r=u.id,console.log(`[Animelok] Found matching slug: ${r} for season ${t}`)}else return console.warn(`[Animelok] No search results found for: ${s.title}`),[]}else return[]}let c=`${y}/api/anime/${r}/episodes/${o}`;console.log(`Fetching streams for ${r} episode ${o} from ${c}...`);try{let l=yield(yield T(c,{headers:{Referer:`${y}/watch/${r}?ep=${o}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"}})).json(),u=l.episode;if(!u||!u.servers)return[];let a=[],h=(u.subtitles||[]).map(i=>({url:i.url,label:i.name,lang:i.name,language:i.name,format:i.url.endsWith(".vtt")?"vtt":"srt"}));for(let i of u.servers){let g=i.name||"Unknown",w=i.languages||[],v=h.length>0,$={Referer:`${y}/watch/${r}?ep=${o}`,"User-Agent":x};if(i.url.includes("zephyrflick.top")||i.url.includes("as-cdn")){let d=i.url.match(/\/video\/([a-f0-9]{32})/);if(d){let m=d[1],f=yield K(m,g,l.anime||l.movie,t,o,w,v);f&&(f.subtitles=h,f.headers=W(M({},$),{Referer:`https://as-cdn21.top/video/${m}`}),a.push(f))}}else if(i.url.startsWith("[")&&i.url.includes(".m3u8"))try{let d=JSON.parse(i.url);for(let m of d){let f=m.url;a.push({title:k(l.anime||l.movie,g,m.quality||"Auto",t,o,w,v),url:f,type:"hls",headers:$,subtitles:h})}}catch(d){console.error("Failed to parse direct HLS sources:",d.message)}else if(i.url.includes(".m3u8")){let d=i.url;a.push({title:k(l.anime||l.movie,g,"Auto",t,o,w,v),url:d,type:"hls",headers:$,subtitles:h});try{let m=yield j(i.url,$);if(m&&m.variants&&m.variants.length>0)for(let f of m.variants){let p=f.url,A=f.extraInfo?` | ${f.extraInfo}`:"";a.push({title:k(l.anime||l.movie,g,f.quality,t,o,w,v,A),url:p,type:"hls",headers:$,subtitles:h})}}catch(m){console.error("HLS resolution failed:",m.message)}}}return a}catch(s){return console.error("getStreams failed:",s.message),[]}})}function K(e,n,t,o,r,c,s){return S(this,null,function*(){let l=`https://as-cdn21.top/video/${e}`,u=`https://as-cdn21.top/player/index.php?data=${e}&do=getVideo`;try{let h=yield(yield T(u,{method:"POST",body:`hash=${e}&r=${encodeURIComponent(y)}/`,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:l,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}})).json();if(h&&h.videoSource)return{title:k(t,n,"Auto",o,r,c,s),url:h.videoSource,type:"hls"}}catch(a){console.error(`Failed to extract from as-cdn (${e}):`,a.message)}return null})}function k(e,n,t,o,r,c,s,l=""){let u=e&&e.title?e.title:"Unknown",a=String(o||1).padStart(2,"0"),h=String(r||1).padStart(2,"0"),i=` - S${a} E${h}`,g=c.join("/")||"Unknown";return s&&(g+=" + ESub"),`Animelok [${n}] (${t||"Auto"})
\u{1F4F9}: ${u}${i}
\u{1F69C}: animelok | \u{1F3A7}: ${g}${l}`}function _(e){if(!e)return"";let n=e.split(",").map(o=>o.trim().toLowerCase()),t=[];for(let o of n)o.startsWith("avc")?t.push("H.264"):o.startsWith("hev")||o.startsWith("hvc")?t.push("H.265"):o.startsWith("mp4a")?t.push("AAC"):o.startsWith("ec-3")?t.push("E-AC3"):o.startsWith("ac-3")&&t.push("AC3");return t.join("/")}function j(t){return S(this,arguments,function*(e,n={}){try{let o=yield T(e,{headers:n},5e3);if(!o.ok)return null;let r=yield o.text();if(!r.includes("#EXTM3U")||!r.includes("#EXT-X-STREAM-INF"))return null;let c=[],s=r.split(`
`),l={},u=r.matchAll(/#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="([^"]+)",NAME="([^"]+)"/g);for(let a of u)l[a[1]]=a[2];for(let a=0;a<s.length;a++){let h=s[a].trim();if(h.includes("#EXT-X-STREAM-INF")){let i="Unknown",g=h.match(/RESOLUTION=(\d+)x(\d+)/i);if(g){let p=parseInt(g[2]);p>=2160?i="4K":p>=1080?i="1080p":p>=720?i="720p":p>=480?i="480p":i=`${p}p`}if(i==="Unknown"){let p=h.match(/NAME="([^"]+)"/i);p&&(i=p[1])}let w=h.match(/CODECS="([^"]+)"/i),v=w?_(w[1]):"",$=h.match(/AUDIO="([^"]+)"/i),d=$?l[$[1]]:"",m=v;d&&(m+=m?` | ${d}`:d);let f=a+1;for(;f<s.length&&(s[f].trim().startsWith("#")||!s[f].trim());)f++;if(f<s.length){let p=s[f].trim();if(p){let A=p;if(!A.startsWith("http")){let U=e.lastIndexOf("/");A=e.substring(0,U+1)+A}c.some(U=>U.url===A)||c.push({url:A,quality:i,extraInfo:m})}}a=f}}return{variants:c}}catch(o){return null}})}module.exports={search:b,getStreams:X};
