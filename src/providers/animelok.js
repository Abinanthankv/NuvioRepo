/**
 * animelok - Built from src/animelok/
 * Generated: 2026-01-13T01:38:19.904Z
 */
var M=Object.defineProperty,W=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var T=(t,o,e)=>o in t?M(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,v=(t,o)=>{for(var e in o||(o={}))x.call(o,e)&&T(t,e,o[e]);if(y)for(var e of y(o))L.call(o,e)&&T(t,e,o[e]);return t},U=(t,o)=>W(t,C(o));var p=(t,o,e)=>new Promise((u,r)=>{var l=n=>{try{a(e.next(n))}catch(i){r(i)}},s=n=>{try{a(e.throw(n))}catch(i){r(i)}},a=n=>n.done?u(n.value):Promise.resolve(n.value).then(l,s);a((e=e.apply(t,o)).next())});var R=require("cheerio-without-node-native"),f="https://animelok.to",D="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function g(u){return p(this,arguments,function*(t,o={},e=1e4){let r=new AbortController,l=setTimeout(()=>r.abort(),e);try{let s=yield fetch(t,U(v({},o),{signal:r.signal}));return clearTimeout(l),s}catch(s){throw clearTimeout(l),s}})}function b(t){return p(this,null,function*(){console.log(`[Animelok] Searching for: ${t}`);try{let o=`${f}/search?keyword=${encodeURIComponent(t)}`,u=yield(yield g(o,{headers:{"User-Agent":D}})).text(),r=R.load(u),l=[];return r("a.group.relative").each((s,a)=>{let n=r(a).find("h3").text().trim(),i=r(a).attr("href"),m=r(a).find("img").attr("src");if(i&&n){let c=i.includes("/anime/")?i.split("/anime/")[1].split("?")[0].split("/")[0]:i.split("/").pop();l.push({title:n,id:c,poster:m,type:"tv"})}}),l}catch(o){return console.error("[Animelok] Search error:",o.message),[]}})}var F="1b3113663c9004682ed61086cf967c44";function N(t,o,e=3){return p(this,null,function*(){let u=`https://api.themoviedb.org/3/${o}/${t}?api_key=${F}`;for(let r=0;r<e;r++)try{let l=yield g(u,{},8e3);if(!l.ok)throw new Error(`Status ${l.status}`);let s=yield l.json();return{title:s.name||s.title,year:(s.release_date||s.first_air_date||"").split("-")[0]}}catch(l){if(console.error(`[Animelok] TMDB fetch attempt ${r+1} failed:`,l.message),r===e-1)return null;yield new Promise(s=>setTimeout(s,1e3*(r+1)))}return null})}function _(t,o,e,u){return p(this,null,function*(){let r=t;if(/^\d+$/.test(t)){console.log(`[Animelok] numeric ID detected (${t}), fetching TMDB details...`);let s=yield N(t,o);if(s){console.log(`[Animelok] TMDB Title trace: ${s.title}. Searching on Animelok...`);let a=yield b(s.title);if(a.length>0){let n=a[0];if(e>1){let i=a.find(m=>m.title.toLowerCase().includes(`season ${e}`)||m.title.toLowerCase().includes(` s${e}`));i&&(n=i)}r=n.id,console.log(`[Animelok] Found matching slug: ${r} for season ${e}`)}else return console.warn(`[Animelok] No search results found for: ${s.title}`),[]}else return[]}let l=`${f}/api/anime/${r}/episodes/${u}`;console.log(`Fetching streams for ${r} episode ${u} from ${l}...`);try{let a=yield(yield g(l,{headers:{Referer:`${f}/watch/${r}?ep=${u}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"}})).json(),n=a.episode;if(!n||!n.servers)return[];let i=[],m=(n.subtitles||[]).map(c=>({url:c.url,language:c.name,format:c.url.endsWith(".vtt")?"vtt":"srt"}));for(let c of n.servers){let $=c.name||"Unknown",w=c.languages||[],S=m.length>0;if(c.url.includes("zephyrflick.top")||c.url.includes("as-cdn")){let h=c.url.match(/\/video\/([a-f0-9]{32})/);if(h){let d=h[1],A=yield E(d,$,a.anime,e,u,w,S);A&&(A.subtitles=m,i.push(A))}}else if(c.url.startsWith("[")&&c.url.includes(".m3u8"))try{let h=JSON.parse(c.url);for(let d of h)i.push({title:k(a.anime,$,d.quality||"Auto",e,u,w,S),url:d.url,type:"hls",subtitles:m})}catch(h){console.error("Failed to parse direct HLS sources:",h.message)}else c.url.includes(".m3u8")&&i.push({title:k(a.anime||a.movie,$,"Auto",e,u,w,S),url:c.url,type:"hls",subtitles:m})}return i}catch(s){return console.error("getStreams failed:",s.message),[]}})}function E(t,o,e,u,r,l,s){return p(this,null,function*(){let a=`https://as-cdn21.top/video/${t}`,n=`https://as-cdn21.top/player/index.php?data=${t}&do=getVideo`;try{let m=yield(yield g(n,{method:"POST",body:`hash=${t}&r=${encodeURIComponent(f)}/`,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:a,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}})).json();if(m&&m.videoSource)return{title:k(e,o,"Auto",u,r,l,s),url:m.videoSource,type:"hls"}}catch(i){console.error(`Failed to extract from as-cdn (${t}):`,i.message)}return null})}function k(t,o,e,u,r,l,s){let a=t.title||"Unknown",n=String(u||1).padStart(2,"0"),i=String(r||1).padStart(2,"0"),m=` - S${n} E${i}`,c=l.join("/")||"Unknown";return s&&(c+=" + ESub"),`Animelok (${e||"Auto"})
\u{1F4F9}: ${a}${m}
\u{1F69C}: animelok | \u{1F3A7}: ${c}`}module.exports={search:b,getStreams:_};
